Imports MySql.Data.MySqlClient
Imports System.Configuration
Imports System.Windows.Forms.DataVisualization.Charting


Public Class MainWindow

    'Database connection management
    'Dim connect As New DataBaseManipulation()

    Dim dateDepart As Date
    Dim dateArrivee As Date

    Dim nombreDejour As Integer

    Private Sub MainWindow_Load(sender As Object, e As EventArgs) Handles MyBase.Load

        'TimerToRefreshClock.Start()

        Dim notifications As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR"), "notification", "CODE_PROFIL", 0, "ETAT_NOTIFCATION")

        If notifications.Rows.Count > 0 Then
            GunaLabelNotification.Text = "(" & notifications.Rows.Count & ")"
        End If

        GunaLabelSymboleMonnaie.Visible = True

        Dim menuAccess As New AccessRight()

        menuAccess.accesAuxModules(GlobalVariable.DroitAccesDeUtilisateurConnect, ReceptionToolStripMenuItem, RESERVATIONToolStripMenuItem, SERVICEDETAGEToolStripMenuItem, BarRestaurationToolStripMenuItem, ComptabilitéToolStripMenuItem, ECONOMATToolStripMenuItem, TECHNIQUEToolStripMenuItem)

        menuAccess.administrationDuModule(GlobalVariable.DroitAccesDeUtilisateurConnect, ToolStripMenuItemSession, ToolStripMenuItemConfig, ToolStripMenuItemServTech, ToolStripMenuItemSecurite, ClôturerToolStripMenuItem, ToolStripSeparatorCloture, OuvrirCaisseToolStripMenuItem, ToolStripSeparator2)

        'elementsDesChambres()

        'StatistiquesDesChambres()

        ''Le statut ne doit être visible que en cas de modification

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            LabelNatureReservation.Visible = True
        Else
            LabelNatureReservation.Visible = False
        End If
        'RAPPORT RECEPTION 
        '--------------------------------------------------------------------

        GunaComboBoxStatutReservation.SelectedIndex = 2 'Business
        'Raison reservation business ou loisirs
        GunaComboBoxTypeReservation.SelectedIndex = 0 'Non confirmée

        'ReservationList()

        '----------------------------------------------------------------------------------------
        PanelGraphiques.BringToFront()
        PanelGraphiques.Visible = True

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        'GESTION DES GRAPHIQUES
        elementsDesChambres()
        'GESTION DES STATS DU PANNEAU LATERAL DROIT
        contenuStatistique()

        StatistiquesDesChambres()
        'GESTION DU PANNEAU DU MILIEU
        StatusDesChambres() 'Icon des chambres au niveau du dashboard


        'On Reinitialise les dates en plus de la date de travail
        ReinitialisationDesDates()

        'GunaTextBoxNumeroChambre.visible = True
        'Initialisation du nombre de personne
        GunaTextBoxNbreAdulte.Text = 1
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

        'GlobalVariable.typeChambreOuSalle = "chambre"

        GlobalVariable.typeChambreOuSalle = "chambre"

        'GESTION DU FORMULAIRE DES CHAMBRES
        GunaRadioButtonChambre.Checked = True

        'We hide the tab of salle de fete of the left tab
        'TabControlGestionReservation.TabPages.Remove(SalleDeFeteRight)

        setTableUsedForAutocompletionToFalse()

        '--------------------------------------------- FRONT OFFICE PANNEL MANEGEMNT -------------------------------------------
        'We charge all the information concerning the agency into a variable that will be used trough out the programme
        'GlobalVariable.AgenceActuelle = Functions.getElementByCode(GlobalVariable.ConnectedUser.Rows(0)("NUM_AGENCE"), "agence", "CODE_AGENCE")

        'TITRE DE LA FENETRE
        GunaLabelTitreDeLaFenetre.Text = GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR")

        'Theme color
        If GlobalVariable.AgenceActuelle.Rows.Count > 0 Then

            GlobalVariable.codeAgence = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")

            If Not GlobalVariable.AgenceActuelle.Rows(0)("VILLE") = "" Then
                GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")
                GunaTextBoxVenantDe.Text = ""
            End If

        End If

        contenuStatistique()

        If GlobalVariable.affichageDuStatutsDesCahmbresOuPas Then

            elementsDesChambres()
            StatistiquesDesChambres()
            contenuStatistique()
            StatusDesChambres()
            GlobalVariable.affichageDuStatutsDesCahmbresOuPas = False

        End If

        'AutoLoad Room for routing
        'AutoLoadRoomForRouting()

        'Auload room source
        'AutoLoadRoomReservationSource()

        'Refreshing the rooms
        'refreshChambre()

        'Refresh Client
        'AutoCompleteClient()

        'Displaying the the number of days to stay
        'CalculatingRestDaysOrHours()

        '--------------------------------------------- PLANNING PANNEL MANEGEMNT ----------------------------------------------

    End Sub

    '------------------------------------- GESTION DU PLANNING----------------------------------
    Public Sub gestionDuPlanning()

        Dim moi As Integer = 0
        Dim annee As Integer = 0
        Integer.TryParse(Month(Now), moi)
        Integer.TryParse(Year(Now), annee)

        nombreDejour = GetDaysInAMonth(annee, moi)

        'GunaDataGridViewPlanning.ColumnCount = nombreDeJour
        Dim halfCalendar As Integer = Math.Ceiling(nombreDejour / 2)

        dateDepart = Now().AddDays(-14)
        dateArrivee = Now().AddDays(nombreDejour - 15)

        LabelDateDepart.Text = Format(dateDepart.AddDays(1), "dd/MM/yyyy")
        LabelDateArrivee.Text = Format(dateArrivee, "dd/MM/yyyy")

        Dim chambres As DataTable = Functions.allTableFields("chambre")

        For k As Integer = 0 To nombreDejour - 1

            If k = 0 Then
                Me.GunaDataGridViewPlanning.Columns.Add("Chambres", "CODE")
                Me.GunaDataGridViewPlanning.Columns.Add("Chambres", "ETAT")
            Else
                Me.GunaDataGridViewPlanning.Columns.Add("JanWin", "12H")
                Me.GunaDataGridViewPlanning.Columns.Add("JanLoss", "12H")
            End If

        Next

        'Columns of the days to display
        Me.GunaDataGridViewPlanning.Rows.Add("")
        Me.GunaDataGridViewPlanning.Rows(0).Height = 2

        Dim m As Integer
        For m = 0 To chambres.Rows.Count - 1
            Me.GunaDataGridViewPlanning.Rows.Add(chambres.Rows(m)("CODE_CHAMBRE"), chambres.Rows(m)("ETAT_CHAMBRE_NOTE")) 'Equals the number of columns
        Next

        'Chaning the size - height of the datdgrid 
        For t = 0 To GunaDataGridViewPlanning.Rows.Count - 1

            Dim row As DataGridViewRow = GunaDataGridViewPlanning.Rows(t)
            If t = 0 Then
                row.Height = 1
            Else
                row.Height = 40
            End If

        Next

        Me.GunaDataGridViewPlanning.Rows.Add("")

        For j As Integer = 0 To Me.GunaDataGridViewPlanning.ColumnCount - 1
            Me.GunaDataGridViewPlanning.Columns(j).Width = 40
        Next
        Me.GunaDataGridViewPlanning.ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode.EnableResizing
        Me.GunaDataGridViewPlanning.ColumnHeadersHeight = Me.GunaDataGridViewPlanning.ColumnHeadersHeight * 2
        Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.Alignment = DataGridViewContentAlignment.BottomCenter


    End Sub

    Public Sub AutoLoadRoomForRouting()

        If GlobalVariable.typeChambreOuSalle = "chambre" Then

            'Loading other 'article families cureently called article type into a combobox
            Dim existQuery As String = "SELECT * From chambre ORDER BY CODE_CHAMBRE ASC"

            Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaComboBoxChambreRoutage.DataSource = table
                'GunaComboBoxChambreRoutage.ValueMember = "CODE_FAMILLE"
                GunaComboBoxChambreRoutage.ValueMember = "CODE_CHAMBRE"
                GunaComboBoxChambreRoutage.DisplayMember = "CODE_CHAMBRE"

            End If

        End If

    End Sub

    Public Sub AutoLoadRoomReservationSource()

        If GlobalVariable.typeChambreOuSalle = "chambre" Then

            'Loading other 'article families cureently called article type into a combobox
            Dim existQuery As String = "SELECT * From source_reservation ORDER BY SOURCE_RESERVATION ASC"

            Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaComboBoxSourceRéservation.DataSource = table
                'GunaComboBoxChambreRoutage.ValueMember = "CODE_FAMILLE"
                GunaComboBoxSourceRéservation.ValueMember = "CODE_SOURCE_RESERVATION"
                GunaComboBoxSourceRéservation.DisplayMember = "SOURCE_RESERVATION"

            End If

        End If

    End Sub

    Public Sub ReinitialisationDesDates()

        GlobalVariable.DateDeTravail = Convert.ToDateTime(Functions.ObtenirDateDeTravail())
        'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.selectedItem
        GunaComboBoxHeureArrivee.SelectedItem = "12:00:00"
        GunaComboBoxHeureDepart.SelectedItem = "12:00:00"

        NumericUpDownHeureArrivee.Value = 12
        NumericUpDownDepartHeure.Value = 12

        NumericUpDownArriveeMin.Value = 0
        NumericUpDownDepartMin.Value = 0

        'NumericUpDownDepartHeure.Value += 1
        ' NumericUpDownDepartHeure.Value -= 1

        'NumericUpDownDepartMin.Value += 1
        'NumericUpDownDepartMin.Value -= 1
        '
        'NumericUpDownArriveeMin.Value += 1
        'NumericUpDownArriveeMin.Value -= 1

        'NumericUpDownHeureArrivee.Value += 1
        'NumericUpDownHeureArrivee.Value -= 1

        'GunaLabelNumReservation.Visible = True

        'GunaLabelNumReservation.Text = GunaComboBoxHeureDepart.selectedItem(0) & "" & GunaComboBoxHeureDepart.selectedItem(1)
        'GunaLabelNumReservation.Text = Now().ToLongTimeString.
        'GunaLabelNumReservation.Text = Trim(GunaLabelNumReservation.Text.Replace("PM", ""))
        'Date d'arrive champ de recherche reservation 
        GunaDateTimePickerParDateArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerParDateDepart.Value = GlobalVariable.DateDeTravail

        GunaLabelDateDeTravail.Text = GlobalVariable.DateDeTravail.ToShortDateString

        'Initializing the date of the tab depart
        GunaDateTimePickerArriveeDepart.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepartDepert.Value = GlobalVariable.DateDeTravail

        GunaLabelDateDepartFin.Text = GunaDateTimePickerDepartDepert.Value.ToShortDateString()
        GunaLabelDateDepartDebut.Text = GunaDateTimePickerArriveeDepart.Value.ToShortDateString()


        'Initializing the date of the tab en chambres
        GunaDateTimePickerDebutEnChambre.Value = GlobalVariable.DateDeTravail
        GunaLabel50.Text = GunaDateTimePickerDebutEnChambre.Value.ToShortDateString()


        'Initializing the dates of the tab attendus
        GunaDateTimePickerDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerFin.Value = GlobalVariable.DateDeTravail

        GunaLabel53.Text = GunaDateTimePickerFin.Value.ToShortDateString()
        GunaLabel54.Text = GunaDateTimePickerDebut.Value.ToShortDateString()

        'Initializing the arrival and departure date to todays date

        GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)

        'GunaDateTimeHeureArrive.Value = Now().ToShortTimeString
        'GunaDateTimePickerHeureDepart.Value = GlobalVariable.DateDeTravail

        'Initializing the time of attendu tab
        GunaDateTimePickerDebut.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerFin.Value = GlobalVariable.DateDeTravail

    End Sub

    'Managing the selection of the dataagrid cells

    Public Class PlanningDataGrid

        Inherits DataGridView

        Protected Overrides Sub OnCellMouseDown(e As DataGridViewCellMouseEventArgs)
            MyBase.OnCellMouseDown(e)
        End Sub

    End Class

    Private Sub DataGridView1_CellPainting(sender As Object, e As System.Windows.Forms.DataGridViewCellPaintingEventArgs) Handles GunaDataGridViewPlanning.CellPainting
        If e.RowIndex = -1 AndAlso e.ColumnIndex > -1 Then
            Dim r2 As Rectangle = e.CellBounds
            r2.Y += e.CellBounds.Height / 2
            r2.Height = e.CellBounds.Height / 2
            e.PaintBackground(r2, True)
            e.PaintContent(r2)
            e.Handled = True
        End If
    End Sub

    Private Sub DataGridView1_ColumnWidthChanged(sender As Object, e As System.Windows.Forms.DataGridViewColumnEventArgs) Handles GunaDataGridViewPlanning.ColumnWidthChanged
        Dim rtHeader As Rectangle = Me.GunaDataGridViewPlanning.DisplayRectangle
        rtHeader.Height = Me.GunaDataGridViewPlanning.ColumnHeadersHeight / 2
        Me.GunaDataGridViewPlanning.Invalidate(rtHeader)
    End Sub

    Private Sub GunaDataGridViewPlanning_Paint(sender As Object, e As System.Windows.Forms.PaintEventArgs) Handles GunaDataGridViewPlanning.Paint
        'Dim days As String() ' The days to display
        'Dim Monthes As String() = {"CHAMBRES", "Janvier", "Fervrier", "Mars", "Avril", "Mai"}
        Dim Monthes(nombreDejour) As String

        For l = 0 To nombreDejour - 1
            If l = 0 Then
                Monthes(l) = "CHAMBRES"
            Else
                Monthes(l) = Format(dateDepart.AddDays(l), "dd-MM-yyyy")
            End If

        Next

        'MessageBox.Show(days.Length)

        Dim j As Integer = 0
        While j < nombreDejour * 2 - 1
            Dim r1 As Rectangle = Me.GunaDataGridViewPlanning.GetCellDisplayRectangle(j, -1, True)
            Dim w2 As Integer = Me.GunaDataGridViewPlanning.GetCellDisplayRectangle(j + 1, -1, True).Width
            r1.X += 1
            r1.Y += 1
            r1.Width = r1.Width + w2 - 2
            r1.Height = r1.Height / 2 - 2
            e.Graphics.FillRectangle(New SolidBrush(Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.BackColor), r1)
            Dim format As New StringFormat()
            format.Alignment = StringAlignment.Center
            format.LineAlignment = StringAlignment.Center
            e.Graphics.DrawString(Monthes(j \ 2), Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.Font, New SolidBrush(Me.GunaDataGridViewPlanning.ColumnHeadersDefaultCellStyle.ForeColor), r1, format)
            j += 2
        End While
    End Sub

    Private Sub GunaDataGridViewPlanning_Scroll(sender As Object, e As System.Windows.Forms.ScrollEventArgs) Handles GunaDataGridViewPlanning.Scroll
        Dim rtHeader As Rectangle = Me.GunaDataGridViewPlanning.DisplayRectangle
        rtHeader.Height = Me.GunaDataGridViewPlanning.ColumnHeadersHeight / 2
        Me.GunaDataGridViewPlanning.Invalidate(rtHeader)
    End Sub




    'Count the number of days in a month so as to know how many columns to create in our datagrid
    Private Function GetDaysInAMonth(ByVal year As Int16, ByVal month As Int16) As Int16

        Dim days As Int16 = 0

        Dim i As Integer = 0

        days += DateTime.DaysInMonth(year, month)

        Return days

    End Function

    Private Sub GunaImageButton1_Click(sender As Object, e As EventArgs) Handles GunaImageButton1.Click

        'Functions.ClosingOpenedConnection()

        'Dim dialog As DialogResult

        'Using form = New Form() With {.TopMost = True}
        'dialog = MessageBox.Show("Voulez-vous vraiment fermer?", "Fermer BarclesHSoft", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
        'End Using

        'If dialog = DialogResult.No Then
        'e.Cancel = True
        'Else

        GlobalVariable.connect.CloseAsync()

        Application.ExitThread()

        Me.Close()


        'End If

    End Sub

    Private Sub GunaImageButton2_Click(sender As Object, e As EventArgs) Handles GunaImageButton2.Click
        Me.WindowState = FormWindowState.Minimized
    End Sub

    '----------------------------------------------------------------------------------------------------------------------
    'We we clck on an element of the menu with icons

    Private Sub GunaAdvenceButton17_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonNouvelleReservation.Click
        GunaDataGridViewCLientDashBoard.Columns.Clear()
        VidageDesChampsPourNouvelleReservation()
        TabControlHbergement.SelectedIndex = 0
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
    End Sub

    Private Sub GunaAdvenceButtonDashBoard_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonDashBoard.Click

        GunaDataGridViewCLientDashBoard.Columns.Clear()

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        ReinitialisationDesDates()

        Me.Activate()

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        elementsDesChambres()
        contenuStatistique()
        StatistiquesDesChambres()
        StatusDesChambres()

        PanelTableauDeBords.Show()
        PanelTableauDeBords.BringToFront()

        PanelEnregistrement.Hide()
        PanelPlanning.Hide()
    End Sub

    Private Sub GunaAdvenceButtonEnregistrement_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonEnregistrement.Click
        PanelTableauDeBords.Hide()
        TabControlHbergement.SelectedIndex = 4
        PanelEnregistrement.Show()
        PanelPlanning.Hide()
    End Sub

    Private Sub GunaAdvenceButtonPlanning_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonPlanning.Click
        PanelPlanning.Show()
        PanelPlanning.BringToFront()
    End Sub

    '----------------------------------------------------------------------------------------------------------------------

    Private Sub ModèleDroitDaccèsToolStripMenuItem_Click(sender As Object, e As EventArgs)
        'AccessRightForm.Show()
    End Sub

    Private Sub OpérationDeCaisseToolStripMenuItem_Click(sender As Object, e As EventArgs)
        'CashierOperationForm.Show()
    End Sub

    Private Sub BanquesToolStripMenuItem_Click(sender As Object, e As EventArgs)
        BankForm.Show()
    End Sub

    Private Sub OpérationsDeBanqueToolStripMenuItem_Click(sender As Object, e As EventArgs)
        BankOperationsForm.Show()
    End Sub

    Private Sub ConditionnementsToolStripMenuItem_Click(sender As Object, e As EventArgs)
        ConditionningForm.Show()
    End Sub


    Private Sub MagasinToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem91.Click
        MAgasinForm.Show()
    End Sub

    Private Sub TypesDePanneToolStripMenuItem_Click(sender As Object, e As EventArgs)
        PannesForm.Show()
    End Sub

    Private Sub LocalisationToolStripMenuItem_Click(sender As Object, e As EventArgs)
        LocationForm.Show()
    End Sub

    '--------------------------------------

    Private Sub ToolStripMenuItem3_Click(sender As Object, e As EventArgs)
        CommercialForm.Show()
    End Sub

    '---------------------------------MAIN COURANTE RECEPTION 
    Private Sub MainCouranteRéceptionToolStripMenuItem1_Click(sender As Object, e As EventArgs)

        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub AncienneMainCouranteToolStripMenuItem_Click(sender As Object, e As EventArgs)

        GlobalVariable.AncienneMainCourante = True
        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub MainCouranteGénéraleToolStripMenuItem_Click(sender As Object, e As EventArgs)
        MainCouranteGenerale.Show()
    End Sub

    'Reglmement Form management
    Private Sub RèglementToolStripMenuItem_Click(sender As Object, e As EventArgs)
        ReglementForm.Show()
    End Sub

    '----------------------------SERVICES D'ETAGES -----------------------------------------------------------------
    Private Sub PlanningHebdoDuPersonnelToolStripMenuItem_Click(sender As Object, e As EventArgs)
        PlanningHebdomadaireDuPersonnelForm.Show()
    End Sub
    '------------------------------------------- FILL OF FORM FOR RESERVATION ------------------------------------------------------

    'PERSONNAL AUTOCOMPLETE OF ROOM TYPE

    Private Sub GunaTextBoxCodeType_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxCodeTypeDeChambre.TextChanged

        'Si code de chambre n'existe pas alors on efface toute les informations le concernant
        If Trim(GunaTextBoxCodeTypeDeChambre.Text).Equals("") Then
            'On desactive les informations liéa à la chambre tant que le type de chambre n'est pas rempli
            GunaTextBoxNumeroChambre.Enabled = False
            GunaButtonRoomSearchButton.Enabled = False

            GunaTextBoxLibelleTYpe.Clear()
            GunaTextBoxpPrixAffiche.Text = 0
            GunaTextBoxMontantAccorde.Text = 0
            GunaTextBoxprixRepas.Text = 0
            GunaTextBoxServiceEtProduitSup.Text = 0
            'GunaTextBoxCapacite.Clear()
            'GunaTextBoxSuperficie.Clear()

            If GlobalVariable.typeChambreOuSalle = "salle" Then
                GunaTextBoxSuperficie.Clear()
                GunaTextBoxCapacite.Clear()
            End If

            GunaTextBoxNumeroChambre.Clear()
            GunaTextBoxLibelleChambre.Clear()

            GunaDataGridViewRoom.Visible = False
        Else
            'On active les informations lié à la chambre car le type de chambre est rempli
            GunaTextBoxNumeroChambre.Enabled = True
            GunaButtonRoomSearchButton.Enabled = True
        End If

        GunaDataGridViewRoomType.Visible = True

        Dim query As String = "Select CODE_TYPE_CHAMBRE, LIBELLE_TYPE_CHAMBRE , PRIX From type_chambre WHERE CODE_TYPE_CHAMBRE Like '%" & Trim(GunaTextBoxCodeTypeDeChambre.Text) & "%' AND CODE_AGENCE=@CODE_AGENCE AND TYPE=@TYPE"
        Dim command As New MySqlCommand(query, GlobalVariable.connect)

        command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()

        adapter.Fill(table)

        If (table.Rows.Count > 0) Then
            GunaDataGridViewRoomType.DataSource = table
        Else
            GunaDataGridViewRoomType.Columns.Clear()
            GunaDataGridViewRoomType.Visible = False
        End If

        If GunaTextBoxCodeTypeDeChambre.Text.Trim().Equals("") Then
            GunaDataGridViewRoomType.Columns.Clear()
            GunaDataGridViewRoomType.Visible = False
        End If

        'connect.closeConnection()

    End Sub

    'Filling the other fields concerning the room type when the click on the cusom Datagrid - Filling of room type at front desk
    Private Sub GunaDataGridViewRoomType_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewRoomType.CellClick

        GunaDataGridViewRoom.Visible = False

        If e.RowIndex >= 0 Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewRoomType.Rows(e.RowIndex)

            GunaTextBoxLibelleTYpe.Text = row.Cells("LIBELLE_TYPE_CHAMBRE").Value.ToString
            GunaTextBoxCodeTypeDeChambre.Text = row.Cells("CODE_TYPE_CHAMBRE").Value.ToString

            Dim TypeChambre As DataTable = Functions.getElementByCode(Trim(GunaTextBoxCodeTypeDeChambre.Text), "type_chambre", "CODE_TYPE_CHAMBRE")

            If GunaRadioButtonChambre.Checked Then
                Dim prix As Double = 0
                Double.TryParse(TypeChambre.Rows(0)("PRIX"), prix)
                GunaTextBoxpPrixAffiche.Text = Format(prix, "#,##0")
                GunaTextBoxMontantAccorde.Text = Format(prix, "#,##0")

            ElseIf GunaRadioButtonSalleFete.Checked Then

                Dim prix As Double = 0
                Dim superficie As Double = 0
                Dim capacite As Double = 0
                Double.TryParse(TypeChambre.Rows(0)("PRIX"), prix)
                Double.TryParse(TypeChambre.Rows(0)("SUPERFICIE"), superficie)
                Double.TryParse(TypeChambre.Rows(0)("CAPACITE"), capacite)
                GunaTextBoxMontantAfficherSalle.Text = Format(prix, "#,##0")
                GunaTextBoxMontantReelSalle.Text = Format(prix, "#,##0")
                GunaTextBoxSuperficie.Text = Format(superficie, "#,##0")
                GunaTextBoxCapacite.Text = Format(capacite, "#,##0")

                Dim montant As Double = 0

                Double.TryParse(GunaTextBoxMontantReelSalle.Text.Trim(), montant)
                GunaTextBoxGrandTotal.Text = Format(montant * CType(GunaTextBoxTempsAFaire.Text, Int32), "#,##0")

            End If

            GunaDataGridViewRoomType.Visible = False

            'We make sure it is possible to Choose a room if a room type is choosen first
            'We set back the diasbled values after checkin or save
            GunaTextBoxNumeroChambre.BaseColor = Color.White
            GunaTextBoxNumeroChambre.Enabled = True

            'connect.closeConnection()

        End If


    End Sub

    'PERSONNAL AUTOCOMPLETE OF ROOM
    Private Sub GunaTextBoxNumeroChambre_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNumeroChambre.TextChanged

        'Si code de chambre n'existe pas alors on efface toute les informations le concernant
        If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Then

            GunaTextBoxLibelleChambre.Clear()

            GunaDataGridViewRoom.Visible = False

        End If

        GunaDataGridViewRoom.Visible = True

        'We select all the rooms that are not occupied
        Dim query As String = "Select CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre WHERE ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE OR ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE2 AND TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

        command.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
        command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"
        command.Parameters.Add("@ETAT_CHAMBRE_NOTE2", MySqlDbType.VarChar).Value = "Libre sale"
        command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()

        adapter.Fill(table)

        '------------------------------------------------------------

        'We select the rooms that are found in reservation
        'Dim query1 As String = "Select CODE_CHAMBRE,LIBELLE_CHAMBRE, ETAT_CHAMBRE_NOTE From chambre INNER JOIN reservation WHERE reservation.CHAMBRE_ID = chambre.CODE_CHAMBRE AND ETAT_RESERVATION = 0 AND DATE_SORTIE < @DATE_ENTREE AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & GunaTextBoxNumeroChambre.Text & "%' AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
        Dim query1 As String = "Select CODE_CHAMBRE, ETAT_CHAMBRE_NOTE, LIBELLE_CHAMBRE From chambre,reservation WHERE DATE_ENTTRE >= @DATE_SORTIE AND ETAT_CHAMBRE = 0 AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND  chambre.CODE_CHAMBRE=reservation.CHAMBRE_ID AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & Trim(GunaTextBoxNumeroChambre.Text) & "%' AND ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
        'OR DATE_SORTIE <= @DATE_ENTREE
        Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
        'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

        command1.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
        command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
        command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Occupée propre"
        command1.Parameters.Add("@ETAT_CHAMBRE_NOTE2", MySqlDbType.VarChar).Value = "Occupée sale"
        command1.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
        command1.Parameters.Add("@DATE_SORTIE", MySqlDbType.Date).Value = GunaDateTimePickerDepart.Value.ToShortDateString
        command1.Parameters.Add("@DATE_ENTREE", MySqlDbType.Date).Value = GunaDateTimePickerArrivee.Value.ToShortDateString

        Dim adapter1 As New MySqlDataAdapter(command1)
        Dim table1 As New DataTable()

        adapter1.Fill(table1)

        If Not table1.Rows.Count > 0 Then
            'We have no  room found in the reservation table

            'We select the rooms that are found in reserve_conf
            Dim query2 As String = "Select CODE_CHAMBRE,LIBELLE_CHAMBRE, ETAT_CHAMBRE_NOTE From chambre INNER JOIN reserve_conf WHERE reservation.CHAMBRE_ID = chambre.CODE_CHAMBRE AND ETAT_RESERVATION = 1 AND DATE_SORTIE < @DATE_ENTREE AND CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_AGENCE= @CODE_AGENCE AND CODE_CHAMBRE LIKE'%" & GunaTextBoxNumeroChambre.Text & "%' AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"

            Dim command2 As New MySqlCommand(query2, GlobalVariable.connect)
            'command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre propre"

            command2.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(GunaTextBoxCodeTypeDeChambre.Text)
            command2.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            command2.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
            command2.Parameters.Add("@DATE_ENTREE", MySqlDbType.Date).Value = GunaDateTimePickerArrivee.Value.ToShortDateString

            Dim adapter2 As New MySqlDataAdapter(command2)
            Dim table2 As New DataTable()

            'We don't have a room in reservation so we search into reserve_conf
            If table2.Rows.Count > 0 Then

                table.Merge(table2)

            End If

        Else

            table.Merge(table1)

        End If

        GunaDataGridViewRoom.DataSource = table

        If (table.Rows.Count > 0) Then

            GunaDataGridViewRoom.Visible = True

            GunaDataGridViewRoom.DataSource = table

        Else

            GunaDataGridViewRoom.Columns.Clear()
            GunaDataGridViewRoom.Visible = False

        End If

        '-------------------------------------------------------------

        If Trim(GunaTextBoxNumeroChambre.Text).Equals("") Then
            GunaDataGridViewRoom.Visible = False
        End If

        'connect.closeConnection()

    End Sub

    'Refresh Room information
    Sub refreshChambre()

        Dim Query As String = "SELECT * From chambre WHERE ETAT_CHAMBRE=@ETAT_CHAMBRE AND TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(table)

        Dim col As New AutoCompleteStringCollection
        Dim i As Integer

        For i = 0 To table.Rows.Count - 1
            col.Add(table.Rows(i)("CODE_CHAMBRE").ToString())
        Next

        'connect.closeConnection()

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    'Filling the other fields concerning the room when the value of th room changes
    Private Sub GunaDataGridViewRoom_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewRoom.CellClick

        GunaDataGridViewRoom.Visible = False

        If e.RowIndex >= 0 Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewRoom.Rows(e.RowIndex)

            Dim query As String = "SELECT * FROM chambre INNER JOIN type_chambre WHERE chambre.CODE_TYPE_CHAMBRE = type_chambre.CODE_TYPE_CHAMBRE AND CODE_CHAMBRE=@CODE_CHAMBRE AND chambre.TYPE=@TYPE ORDER BY CODE_CHAMBRE ASC"
            Dim adapter As New MySqlDataAdapter
            Dim table As New DataTable
            Dim command As New MySqlCommand(query, GlobalVariable.connect)

            command.Parameters.Add("@CODE_CHAMBRE", MySqlDbType.VarChar).Value = Trim(row.Cells("CODE_CHAMBRE").Value.ToString)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            adapter.SelectCommand = command
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                Dim chambreId As Integer = 0
                Integer.TryParse(table.Rows(0)("ID_CHAMBRE"), chambreId)
                GlobalVariable.idChambre = chambreId
                GlobalVariable.codeChambre = row.Cells("CODE_CHAMBRE").Value.ToString
                GunaTextBoxNumeroChambre.Text = row.Cells("CODE_CHAMBRE").Value.ToString
                GunaTextBoxLibelleChambre.Text = table.Rows(0)("LOCALISATION").ToString
                'Dim superficie As Double
                'Double.TryParse()
                GunaTextBoxSuperficie.Text = table.Rows(0)("SUPERFICIE")
                GunaTextBoxCapacite.Text = table.Rows(0)("CAPACITE")

                GunaDataGridViewRoom.Visible = False

            Else

                GunaTextBoxSuperficie.Clear()
                GunaTextBoxLibelleTYpe.Clear()
                GunaTextBoxNumeroChambre.Clear()
                GunaTextBoxLibelleChambre.Clear()
                GunaTextBoxpPrixAffiche.Text = 0
                GunaTextBoxCodeTypeDeChambre.Clear()
                GunaTextBoxMontantAccorde.Text = 0
                GunaTextBoxprixRepas.Text = 0
                GunaTextBoxServiceEtProduitSup.Text = 0

            End If

            'connect.closeConnection()

        End If

    End Sub

    'We empty all the filed of the form after registration

    Private Sub emtptyRegistrationFields()

        'Refreshing the database of the rooms to select
        refreshChambre()

        '---------------------- Room field -----------------------
        GunaTextBoxLibelleChambre.Text = ""
        GunaTextBoxCodeTypeDeChambre.Text = ""
        GunaTextBoxLibelleTYpe.Text = ""
        GunaTextBoxNumeroChambre.Text = ""

        '----------------------periode field
        GunaTextBoxTempsAFaire.Text = 0
        GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
        GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail

        '---------------- calculation field
        GunaTextBoxpPrixAffiche.Text = 0
        GunaTextBoxMontantAccorde.Text = 0
        GunaTextBoxNbreAdulte.Text = 1
        GunaTextBoxNbreEnfant.Text = 0
        GunaTextBoxNbrePersonne.Text = 1


        GunaTextBoxPrixParNuitee.Text = 0
        GunaTextBoxNombreDeJourTotal.Text = 0
        GunaTextBoxprixRepas.Text = 0
        GunaTextBoxServiceEtProduitSup.Text = 0
        GunaTextBoxMontantARegler.Text = 0
        GunaTextBoxAvance.Text = 0
        GunaTextBoxMontantCaution.Text = 0

        GunaTextBoxPrixSejour.Text = 0

        GunaTextBoxTotal.Text = 0

        GunaTextBoxMontantARegler.Text = 0
        GunaLabelSolde.Text = 0

        '--------------------- Client field
        GunaTextBoxNomPrenom.Text = ""
        GunaTextBoxTelClient.Text = ""
        GunaTextBoxClientEmail.Text = ""
        GunaTextBoxCNI.Text = ""
        GunaTextBoxRefClient.Text = ""
        GunaTextBoxSiteWeb.Text = ""

        GunaLabelNumReservation.Text = ""

        'Routage
        GunaCheckBoxPetitDejRoutage.Checked = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False
        GunaCheckBoxChambreRoutage.Checked = False
        GunaTextBoxPrixChambreRoutage.Visible = False


    End Sub

    'Affecting values to the field when coming from main_courante_reception to front office

    Sub affectingValuesToFields()

        'GESTION DE L'EMPLACEMENT DE LA RESERVATION
        '----------------------periode field -------------------------
        Dim reservation As DataTable
        reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

        If Not reservation.Rows.Count > 0 Then
            reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            If Not reservation.Rows.Count > 0 Then
                reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_temp", "CODE_RESERVATION")
            End If
        End If

        'Refresh rooms information
        refreshChambre()

        '---------------------- Room field -----------------------

        Dim room As DataTable = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

        Dim codeType As String = ""
        Dim roomType As DataTable

        codeType = GlobalVariable.MainCouranteJournaliereToUpdate.Rows(0)("TYPE_CHAMBRE")
        roomType = Functions.getElementByCode(codeType, "type_chambre", "CODE_TYPE_CHAMBRE")

        If room.Rows.Count > 0 Then

            'On n'a le numéro de chambre alors seulement on pourra remplir les inforamtion de la chambre
            If Not room.Rows(0)("CODE_CHAMBRE") = "-" Then

                GunaTextBoxNumeroChambre.Text = GlobalVariable.codeChambreToUpdate
                GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString
                GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")

            Else
                GunaTextBoxNumeroChambre.Text = ""
            End If

        Else

        End If

        If roomType.Rows.Count > 0 Then

            GunaTextBoxCodeTypeDeChambre.Text = roomType.Rows(0)("CODE_TYPE_CHAMBRE")
            GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")
        Else

            GunaTextBoxCodeTypeDeChambre.Text = "-"
            GunaTextBoxLibelleTYpe.Text = "-"

        End If

        'emtptyRegistrationFields()

        '---------------- calculation field -----------------------------
        Dim mainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeMainCouranteJournaliereToUpdate, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE")

        If GunaRadioButtonChambre.Checked Then

            If mainCouranteJournaliere.Rows.Count > 0 Then

                If roomType.Rows.Count > 0 Then

                    GunaTextBoxpPrixAffiche.Text = Format(roomType.Rows(0)("PRIX"), "#,##0")

                End If

                GunaTextBoxMontantAccorde.Text = Format(mainCouranteJournaliere.Rows(0)("MONTANT_ACCORDE"), "#,##0")

                GunaTextBoxPrixParNuitee.Text = Format(GunaTextBoxMontantAccorde.Text, "#,##0")

                'Pris des repase
                GunaTextBoxprixRepas.Text = 0
                GunaTextBoxServiceEtProduitSup.Text = 0
                GunaTextBoxMontantARegler.Text = 0

                GunaTextBoxNombreDeJourTotal.Text = CType(GunaTextBoxTempsAFaire.Text, Int32)

                'Dim derteminationDuTypeDeSejour As Integer = 

                'GESTION DES CHECKBOXES DE TAXE SEJOUR ET PETITE DEJEUNER

                If mainCouranteJournaliere.Rows(0)("SOUS_TOTAL1") > 0 Then 'Si le montant du petit dejeuner inclus et supérieur a 0

                    GunaCheckBoxPetitDejeuenerInclus.Checked = True
                    GunaTextBoxPetitDejeuner.Visible = True
                    GunaTextBoxPetitDejeuner.Text = Format(mainCouranteJournaliere.Rows(0)("SOUS_TOTAL1"), "#,##0")

                Else

                    GunaCheckBoxPetitDejeuenerInclus.Checked = False
                    GunaTextBoxPetitDejeuner.Clear()
                    GunaTextBoxPetitDejeuner.Visible = False

                End If

                Dim CODE_RESERVATION As String = mainCouranteJournaliere.Rows(0)("NUM_RESERVATION")
                Dim taxe_sejour As DataTable = Functions.getElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

                If taxe_sejour.Rows.Count > 0 Then
                    GunaCheckBoxTaxeSejour.Checked = True
                    GunaTextBoxTaxeSejour.Visible = True
                    GunaTextBoxTaxeSejour.Text = Format(taxe_sejour.Rows(0)("TAXE_SEJOUR_COLLECTEE"), "#,##0")
                Else
                    GunaCheckBoxTaxeSejour.Checked = False
                    GunaTextBoxTaxeSejour.Visible = False
                End If

            End If

        End If

        Dim TypeChambre As DataTable = Functions.getElementByCode(GunaTextBoxCodeTypeDeChambre.Text, "type_chambre", "CODE_TYPE_CHAMBRE")

        If GunaRadioButtonSalleFete.Checked Then

            If TypeChambre.Rows.Count > 0 Then

                GunaTextBoxMontantAfficherSalle.Text = Format(TypeChambre.Rows(0)("PRIX"), "#,##0")
                GunaTextBoxMontantReelSalle.Text = Format(CType(reservation.Rows(0)("MONTANT_ACCORDE"), Double), "#,##0")

            End If

        End If

        'In case the reservation is not found in reservation, it will be found in reserve_conf
        If reservation.Rows.Count > 0 Then

            GunaDateTimePickerArrivee.Value = Trim(reservation.Rows(0)("DATE_ENTTRE"))
            GunaDateTimePickerDepart.Value = reservation.Rows(0)("DATE_SORTIE")
            GunaComboBoxHeureArrivee.SelectedItem = Convert.ToDateTime(reservation.Rows(0)("HEURE_ENTREE")).ToLongTimeString
            GunaComboBoxHeureDepart.SelectedItem = Convert.ToDateTime(reservation.Rows(0)("HEURE_SORTIE")).ToLongTimeString

            If GunaRadioButtonChambre.Checked Then

                GunaTextBoxNbreAdulte.Text = CType(reservation.Rows(0)("ADULTES"), Int32)
                GunaTextBoxNbreEnfant.Text = CType(reservation.Rows(0)("ENFANTS"), Int32)
                GunaTextBoxNbrePersonne.Text = CType(reservation.Rows(0)("NB_PERSONNES"), Int32)

            End If

            If GunaRadioButtonSalleFete.Checked Then
                GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * CType(GunaTextBoxTempsAFaire.Text, Int32), "#,##0")

                'Gestion des forfaits

            End If

        Else

            reservation = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            GunaDateTimePickerArrivee.Value = Trim(reservation.Rows(0)("DATE_ENTTRE"))
            GunaDateTimePickerDepart.Value = reservation.Rows(0)("DATE_SORTIE")
            GunaComboBoxHeureArrivee.SelectedItem = Convert.ToDateTime(reservation.Rows(0)("HEURE_ENTREE")).ToLongTimeString
            GunaComboBoxHeureDepart.SelectedItem = Convert.ToDateTime(reservation.Rows(0)("HEURE_SORTIE")).ToLongTimeString

            If reservation.Rows.Count > 0 Then

                If GunaRadioButtonChambre.Checked Then

                    GunaTextBoxNbreAdulte.Text = CType(reservation.Rows(0)("ADULTES"), Int32)
                    GunaTextBoxNbreEnfant.Text = CType(reservation.Rows(0)("ENFANTS"), Int32)
                    GunaTextBoxNbrePersonne.Text = CType(reservation.Rows(0)("NB_PERSONNES"), Int32)

                End If

                If GunaRadioButtonSalleFete.Checked Then
                    GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * CType(GunaTextBoxTempsAFaire.Text, Int32), "#,##0")
                    'Gestion des forfaits

                End If

            End If

        End If

        'GESTION DU TEMPS A FAIRE DANS L'HOTEL
        If (GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value) Then
            'GESTION DES SIESTE
            GunaCheckBoxDayUse.Checked = True

            'GunaTextBoxTempsSieste.Visible = True

            GunaTextBoxTempsAFaire.Visible = True
            GunaTextBoxTempsAFaire.Text = 0

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.selectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.selectedItem

            'Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            'Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            'numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)
            numberOfHoursToSpend = CType((CDate(reservation.Rows(0)("HEURE_SORTIE")) - CDate(reservation.Rows(0)("HEURE_ENTREE"))).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            End If

            GunaLabelTempsAFaire.Text = "Total heures"

        Else
            'GESTION DES NUITES

            GunaCheckBoxDayUse.Checked = False

            'Calculate the number of days to stay
            'GunaTextBoxTempsSieste.Visible = False
            'GunaTextBoxTempsSieste.Text = 0

            GunaTextBoxTempsAFaire.Visible = True
            GunaTextBoxTempsAFaire.Text = CType((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays, Int32)

            GunaLabelTempsAFaire.Text = "Total nuitées"

        End If

        GunaTextBoxMontantCaution.Text = Format(reservation.Rows(0)("MONTANT_TOTAL_CAUTION"), "#,##0")

        GlobalVariable.reserveConfCheckInState = reservation.Rows(0)("CHECKIN")

        GlobalVariable.reserveConfCheckOutState = reservation.Rows(0)("ETAT_RESERVATION")

        Dim reglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReglementToUpdate, "reglement", "NUM_REGLEMENT")

        Dim nombreDeJourTotal As Integer
        Dim montantAccorde As Double
        Dim prixParNuitee As Double
        Dim prixRepas As Double
        Dim Total As Double
        Dim ServiceEtProduitSup As Double
        Dim montantARegler As Double
        Dim avance As Double
        Dim caution As Double

        'The price to take into consideration

        If GunaRadioButtonChambre.Checked Then

            If Not (Double.TryParse(GunaTextBoxMontantAccorde.Text.Trim(""), montantAccorde) = 0) Then
                prixParNuitee = montantAccorde
            Else

                Double.TryParse(GunaTextBoxpPrixAffiche.Text.Trim(""), montantAccorde)
                prixParNuitee = montantAccorde

            End If

            GunaTextBoxPrixParNuitee.Text = Format(prixParNuitee, "#,##0")

            Integer.TryParse(GunaTextBoxNombreDeJourTotal.Text.Trim(), nombreDeJourTotal)
            Double.TryParse(GunaTextBoxprixRepas.Text.Trim(), prixRepas)
            Double.TryParse(GunaTextBoxServiceEtProduitSup.Text.Trim(), ServiceEtProduitSup)
            Double.TryParse(GunaTextBoxMontantARegler.Text.Trim(), montantARegler)

            If (GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value) Then
                GunaTextBoxPrixSejour.Text = Format(montantAccorde, "#,##0")
                Total = (montantAccorde * nombreDeJourTotal) + prixRepas + ServiceEtProduitSup
            Else
                GunaTextBoxPrixSejour.Text = Format(montantAccorde * nombreDeJourTotal, "#,##0")
                Total = (montantAccorde * nombreDeJourTotal) + prixRepas + ServiceEtProduitSup
            End If

            GlobalVariable.avance = avance

            GunaTextBoxTotal.Text = Format(Total, "#,##0")

            GunaTextBoxMontantARegler.Text = Format(Total - avance, "#,##0")

        End If

        If GunaRadioButtonSalleFete.Checked Then

        End If

        Double.TryParse(GunaTextBoxAvance.Text.Trim(), avance)
        Double.TryParse(GunaTextBoxMontantCaution.Text.Trim(), caution)

        '--------------------- Client field ----------------------------
        Dim client As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

        If Not client.Rows.Count > 0 Then
            'En cas d'existence d'une réservation sans nom de client 
            If GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                client = Functions.getElementByCode(GlobalVariable.ReservationToUpdate.Rows(0)("NOM_CLIENT"), "client", "NOM_PRENOM")
            End If

        End If

        If client.Rows.Count > 0 Then

            GunaTextBoxNomPrenom.Text = client.Rows(0)("NOM_PRENOM")
            GunaTextBoxTelClient.Text = client.Rows(0)("TELEPHONE")
            GunaTextBoxClientEmail.Text = client.Rows(0)("EMAIL")
            GunaTextBoxCNI.Text = client.Rows(0)("CNI")
            'GunaTextBoxRefClient.Text = GlobalVariable.codeClientToUpdate
            GunaTextBoxRefClient.Text = client.Rows(0)("CODE_CLIENT")
            GunaTextBoxSiteWeb.Text = client.Rows(0)("SITE_INTERNET")
            'GunaTextBoxCodeDeGroupe.Text = client.Rows(0)("CODE_ENTREPRISE")
            GunaTextBoxNomJeuneFille.Text = client.Rows(0)("NOM_JEUNE_FILLE")
            GunaTextBoxTypeClient.Text = client.Rows(0)("TYPE_CLIENT")
            GunaDateTimePickerDateNaissance.Value = client.Rows(0)("DATE_DE_NAISSANCE")
            GunaTextBoxLieu.Text = client.Rows(0)("LIEU_DE_NAISSANCE")
            GunaTextBoxNationalite.Text = client.Rows(0)("NATIONALITE")
            GunaTextBoxPaysResidence.Text = client.Rows(0)("PAYS_RESIDENCE")
            GunaTextBoxProfession.Text = client.Rows(0)("PROFESSION")
            GunaTextBoxNumeroCompte.Text = client.Rows(0)("NUM_COMPTE")
            GunaTextBoxRue.Text = client.Rows(0)("ADRESSE")
            GunaTextBoxVilleDeResidence.Text = client.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = client.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = client.Rows(0)("NUM_VEHICULE")

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                If Not GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_NOTE_RESERVATION") = "" Then
                    GunaComboBoxStatutReservation.SelectedItem = GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_NOTE_RESERVATION")
                End If

                If Not GlobalVariable.ReservationToUpdate.Rows(0)("SOURCE_RESERVATION") = "" Then
                    GunaComboBoxSourceRéservation.SelectedValue = GlobalVariable.ReservationToUpdate.Rows(0)("SOURCE_RESERVATION")
                End If

            Else
                'Selection du statut de réservation par defaut
                GunaComboBoxStatutReservation.SelectedIndex = 2
            End If

            Dim Entreprise As DataTable = Functions.getElementByCode(client.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then
                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))
            End If

            GunaTextBoxVenantDe.Text = ""
            GunaTextBoxSerendantA.Text = ""

        Else

            MessageBox.Show("Aucun client associé a cette réservation")

        End If

        'We display buttons
        reservationButtonToDisplay()

        'Hiding the datagrid
        GunaDataGridViewClient.Visible = False
        GunaDataGridViewRoom.Visible = False
        GunaDataGridViewPhone.Visible = False

        'Initialisation de la ville de depart
        GunaTextBoxSerendantA.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")

        'Initialisation du nombre de personne
        GunaTextBoxNbreAdulte.Text = 1
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

        'GESTION DE L'ENSEMBLE DES REGLEMENTS ET FACTURE D'UNE RESERVATION

        If Not GlobalVariable.codeReservationToUpdate = "" Then

            ListeDesFacturesEtReglementPourUneReservation() 'Ligne 1051

        End If

        'GESTION DES TAXES SEJOURS COLLECTE ET PETIE DEJEUNER

        'GESTION DELA RESERVATION DE GROUPE
        If Not GlobalVariable.codeReservationToUpdate = "" And GlobalVariable.typeChambreOuSalle = "chambre" Then

            'Notre réservation existe alors on controle si elle est associé a un groupe si oui on active le bouton de gestion des groupes
            If Not Trim(reservation.Rows(0)("GROUPE")) = "" Then
                GunaCheckBoxReservationDeGroupe.Checked = True
                GunaTextBoxCodeDeGroupe.Visible = True
                GunaTextBoxCodeDeGroupe.Text = reservation.Rows(0)("GROUPE")
            Else
                GunaCheckBoxReservationDeGroupe.Checked = False
            End If

            'GESTION DES ROUTAGES - INSTRUCTIONS DE ROUTAGE

            'ROUTAGE PETIT DEJEUNER
            If Not Trim(reservation.Rows(0)("PETIT_DEJEUNER_ROUTAGE")) = 0 Then

                GunaCheckBoxPetitDejRoutage.Checked = True
                GunaTextBoxPetitDejeunerRoutage.Visible = True
                GunaTextBoxPetitDejeunerRoutage.Text = Format(reservation.Rows(0)("PETIT_DEJEUNER_ROUTAGE"), "#,##0")
            Else
                GunaCheckBoxPetitDejRoutage.Checked = False
                GunaTextBoxPetitDejeunerRoutage.Visible = False
                GunaTextBoxPetitDejeunerRoutage.Clear()
            End If

            'If reservation.Rows(0)("CHAMBRE_ROUTAGE") IsNot Nothing Then
            'reservation.Rows(0)("CHAMBRE_ROUTAGE") = ""
            'ElseIf reservation.Rows(0)("CHAMBRE_ROUTAGE") = DbNull.Value Then
            'reservation.Rows(0)("CHAMBRE_ROUTAGE") = ""
            'End If

            'ROUTAGE LOGEMENT
            If Not Trim(reservation.Rows(0)("CHAMBRE_ROUTAGE")) = "" Then
                GunaCheckBoxChambreRoutage.Checked = True
                GunaComboBoxChambreRoutage.SelectedValue = reservation.Rows(0)("CHAMBRE_ROUTAGE")
                GunaTextBoxPrixChambreRoutage.Visible = True
                GunaTextBoxPrixChambreRoutage.Text = Format(reservation.Rows(0)("MONTANT_ACCORDE"), "#,##0")
            Else
                GunaCheckBoxChambreRoutage.Checked = False
                GunaTextBoxPrixChambreRoutage.Visible = False
                GunaTextBoxPrixChambreRoutage.Clear()
            End If

        End If

        EtatDuBoutonDeGestionDesReservationDeGroupe()

        'GESTION DES DESTINATION ET PROVENANCE

        If reservation.Rows(0)("VENANT_DE") IsNot Nothing Then

            reservation.Rows(0)("VENANT_DE") = ""

        End If

        If reservation.Rows(0)("SE_RENDANT_A") IsNot Nothing Then

            reservation.Rows(0)("SE_RENDANT_A") = ""

        End If

        If reservation.Rows(0)("RAISON") IsNot Nothing Then
            reservation.Rows(0)("RAISON") = ""
        End If

        GunaTextBoxVenantDe.Text = reservation.Rows(0)("VENANT_DE")
        GunaTextBoxSerendantA.Text = reservation.Rows(0)("SE_RENDANT_A")
        GunaComboBoxTypeReservation.SelectedItem = reservation.Rows(0)("RAISON")

        'GESTION DES ENTREPRISE ASSOCIE A UN CLIENT
        GunaTextBoxEntrepriseDuclient.Text = reservation.Rows(0)("NOM_ENTREPRISE")
        GunaTextBoxCodeEntrepriseDuClient.Text = reservation.Rows(0)("CODE_ENTREPRISE")
        GunaDataGridViewEntrepriseDuClient.Visible = False

        'GESTION DES TARIFS ASSOCIE A LA RESERVATION

        Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
        Dim CODE_TYPE_CEHAMBRE As String = Trim(GunaTextBoxCodeTypeDeChambre.Text)

        'On recherche si l'entreprise associé au client a une tarification
        tarifToDisplay(CODE_ENTREPRISE, CODE_TYPE_CEHAMBRE)

        ActivationOuDesactivationDeToutLesBoutonsApresUnCheckOUt()

    End Sub

    Private Sub ListeDesFacturesEtReglementPourUneReservation()

        Dim listeDesFactureDelaReservation As New Facture
        Dim listeDesReglementsDelaReservation As New Reglement

        Dim ListeDesFactures As DataTable = listeDesFactureDelaReservation.ListeDesFactureDeLaReservationEncours(GlobalVariable.codeReservationToUpdate)
        Dim ListeDesReglements As DataTable = listeDesReglementsDelaReservation.ListeDesReglementDeLaReservationEncours(GlobalVariable.codeReservationToUpdate)

        'LISTE DES FACTURES
        If ListeDesFactures.Rows.Count > 0 Then
            GunaDataGridViewDesFactures.DataSource = ListeDesFactures
            GunaDataGridViewDesFactures.Columns(3).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewDesFactures.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
        End If

        'LISTE DES REGLEMENTS
        If ListeDesReglements.Rows.Count > 0 Then
            GunaDataGridViewListeDesReglement.DataSource = ListeDesReglements
            GunaDataGridViewListeDesReglement.Columns(3).DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewListeDesReglement.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
        Else
            GunaDataGridViewListeDesReglement.Columns.Clear()
        End If

    End Sub
    'When ever the number of resting days changes

    Private Sub GunaTextBoxTempsAFaire_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTempsAFaire.TextChanged

        Dim tempsAFaire As Integer = 1

        Integer.TryParse(GunaTextBoxTempsAFaire.Text, tempsAFaire)

        If GunaCheckBoxDayUse.Checked Then

            GunaLabelTypeDeSejour.Text = "DAY USE"

            '------------------- NEW WAY OF CALCULATING TIME --------------------------

            NumericUpDownHeureArrivee.Value = 12
            NumericUpDownDepartHeure.Value = 12

            NumericUpDownArriveeMin.Value = 0
            NumericUpDownDepartMin.Value = 0

            'NumericUpDownDepartHeure.Value += 1
            'NumericUpDownDepartHeure.Value -= 1

            'NumericUpDownDepartMin.Value += 1
            'NumericUpDownDepartMin.Value -= 1

            'NumericUpDownArriveeMin.Value += 1
            'NumericUpDownArriveeMin.Value -= 1

            'NumericUpDownHeureArrivee.Value += 1
            'NumericUpDownHeureArrivee.Value -= 1

            Dim ArriveeMinutes As String = ""
            Dim ArriveeHeure As String = ""

            Dim departMinutes As String = ""
            Dim departHeure As String = ""

            If NumericUpDownArriveeMin.Value = 0 Then
                ArriveeMinutes = ":00:00"
            ElseIf NumericUpDownArriveeMin.Value < 10 Then
                ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
            Else
                ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
            End If

            If NumericUpDownHeureArrivee.Value >= 10 Then
                ArriveeHeure = NumericUpDownHeureArrivee.Value
            Else
                ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
            End If

            If NumericUpDownDepartMin.Value = 0 Then
                departMinutes = ":00:00"
            ElseIf NumericUpDownDepartMin.Value < 10 Then
                departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
            Else
                departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
            End If

            If NumericUpDownDepartHeure.Value >= 10 Then
                departHeure = NumericUpDownDepartHeure.Value
            Else
                departHeure = ":0" & NumericUpDownDepartHeure.Value
            End If

            ' -------------------------------------------------------------------------

            'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.selectedItem

            'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.selectedItem

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            'Dim numberOfHoursToSpend As Integer

            'DateTimeArrivee = DateTimeArrivee.AddHours(tempsAFaire)

            NumericUpDownDepartHeure.Value += tempsAFaire


            'Dim departureTimeInString As String = DateTimeArrivee.ToLongTimeString

            'GunaComboBoxHeureDepart.SelectedItem = departureTimeInString

            ReservationMoneyCalculation()


        Else

            GunaDateTimePickerDepart.Value = DateAndTime.DateAdd("d", tempsAFaire, GunaDateTimePickerArrivee.Value)

            GlobalVariable.DATE_ENTTRE = GunaDateTimePickerArrivee.Value.ToShortDateString
            GlobalVariable.DATE_SORTIE = GunaDateTimePickerDepart.Value.ToShortDateString

            'Gestion des salles

            If tempsAFaire > 0 And 8 > tempsAFaire Then
                GunaLabelTypeDeSejour.Text = "COURT SEJOURS"
            ElseIf tempsAFaire > 7 Then
                GunaLabelTypeDeSejour.Text = "LONG SEJOURS"
            End If

        End If

        If Trim(GunaTextBoxTempsAFaire.Text) = "" Then
            GunaTextBoxTempsAFaire.Text = 0
        End If

        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * CType(GunaTextBoxTempsAFaire.Text, Int32), "#,##0")

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    ' -------------------------------- PERSONNAL AUTOCOMPLETION -------------------------------------
    'Autocompletion of client

    Sub AutoCompleteClient()

        'Dim Query As String = "SELECT * From client WHERE NOM_PRENOM LIKE '%'" & GunaTextBoxNomPrenom.Text & "'%'"
        Dim Query As String = "SELECT * From client"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(table)

        Dim col As New AutoCompleteStringCollection
        Dim i As Integer

        For i = 0 To table.Rows.Count - 1

            'col.Add(table.Rows(i)("NOM_PRENOM").ToString() + "-" + table.Rows(i)("EMAIL"))
            col.Add(table.Rows(i)("NOM_PRENOM").ToString())
        Next

        'connect.closeConnection()

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    'Custom Live search of client
    Private Sub GunaTextBoxNomPrenom_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNomPrenom.TextChanged

        If Trim(GunaTextBoxNomPrenom.Text).Equals("") Then

            GunaTextBoxRefClient.Text = ""
            GunaTextBoxTelClient.Text = ""
            GunaTextBoxClientEmail.Text = ""
            GunaTextBoxCodeDeGroupe.Clear()
            GunaTextBoxCNI.Text = ""

            GunaTextBoxRefClient.Text = ""

            GunaTextBoxSiteWeb.Text = ""

            GunaTextBoxNomPrenom.Text = ""
            GunaTextBoxTelClient.Clear()
            GunaTextBoxClientEmail.Text = ""
            GunaTextBoxCNI.Text = ""

            GunaTextBoxSiteWeb.Text = ""
            GunaTextBoxNomJeuneFille.Text = ""
            GunaTextBoxTypeClient.Text = ""
            GunaDateTimePickerDateNaissance.Value = Now()
            GunaTextBoxLieu.Text = ""
            GunaTextBoxNationalite.Text = ""
            GunaTextBoxPaysResidence.Text = ""
            GunaTextBoxProfession.Text = ""
            GunaTextBoxNumeroCompte.Text = ""
            GunaTextBoxRue.Text = ""
            GunaTextBoxVilleDeResidence.Text = ""
            GunaTextBoxModeTransport.Text = ""
            GunaTextBoxNumVehicule.Text = ""
            GunaTextBoxEntrepriseDuclient.Text = ""

            GunaTextBoxPaiement.Text = 0
            'GunaTextBoxAvance.Text = 0
            GunaTextBoxSubvention.Text = 0
            GunaTextBoxMontantCaution.Text = 0

            'Aucun tableau d'autocompletion ne doit être visible
            setTableUsedForAutocompletionToFalse()

            'On masque les tarifs associés aux clients
            GunaComboBoxCodeTarif.Visible = False
            GunaLabelCodeTarif.Visible = False

            GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text

        End If

        GunaDataGridViewClient.Visible = True

        Dim Query As String = "SELECT NOM_PRENOM, EMAIL From client WHERE NOM_PRENOM LIKE '%" & GunaTextBoxNomPrenom.Text & "%'"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)

        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            GunaDataGridViewClient.DataSource = table
        Else
            GunaDataGridViewClient.Columns.Clear()
            GunaDataGridViewClient.Visible = False
        End If

        If GunaTextBoxNomPrenom.Text = "" Then
            GunaDataGridViewClient.Visible = False
        End If

        'reservationButtonToDisplay()

    End Sub

    'Upponc clicking a row on the values of the datagrid used for custom search of client
    Private Sub GunaDataGridViewClient_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewClient.CellClick

        GunaDataGridViewClient.Visible = False

        Dim row As DataGridViewRow

        row = Me.GunaDataGridViewClient.Rows(e.RowIndex)

        Dim query As String = "SELECT * FROM client WHERE NOM_PRENOM = @NOM_PRENOM AND EMAIL=@EMAIL"
        Dim adapter As New MySqlDataAdapter

        Dim table As New DataTable()
        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@NOM_PRENOM", MySqlDbType.VarChar).Value = Trim(row.Cells("NOM_PRENOM").Value.ToString())
        command.Parameters.Add("@EMAIL", MySqlDbType.VarChar).Value = row.Cells("EMAIL").Value.ToString()

        adapter.SelectCommand = command
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            'Gathering of some information concernit the client to be use later

            GlobalVariable.idClient = table.Rows(0)("ID_CLIENT").ToString
            GlobalVariable.codeClient = Trim(table.Rows(0)("CODE_CLIENT").ToString)
            GlobalVariable.codeCompteClient = table.Rows(0)("NUM_COMPTE").ToString

            GunaTextBoxNomPrenom.Text = Trim(row.Cells("NOM_PRENOM").Value.ToString())
            GunaTextBoxTelClient.Text = Trim(table.Rows(0)("TELEPHONE").ToString)
            GunaTextBoxClientEmail.Text = Trim(table.Rows(0)("EMAIL").ToString)
            GunaTextBoxCNI.Text = Trim(table.Rows(0)("CNI").ToString)
            GunaTextBoxRefClient.Text = Trim(Trim(table.Rows(0)("CODE_CLIENT").ToString))
            GunaTextBoxSiteWeb.Text = Trim(table.Rows(0)("SITE_INTERNET").ToString)
            GunaTextBoxNomJeuneFille.Text = Trim(table.Rows(0)("NOM_JEUNE_FILLE"))
            GunaTextBoxTypeClient.Text = Trim(table.Rows(0)("TYPE_CLIENT"))
            GunaDateTimePickerDateNaissance.Value = Trim(table.Rows(0)("DATE_DE_NAISSANCE"))
            GunaTextBoxLieu.Text = Trim(table.Rows(0)("LIEU_DE_NAISSANCE"))
            GunaTextBoxNationalite.Text = Trim(table.Rows(0)("NATIONALITE"))
            GunaTextBoxPaysResidence.Text = Trim(table.Rows(0)("PAYS_RESIDENCE"))
            GunaTextBoxProfession.Text = Trim(table.Rows(0)("PROFESSION"))
            GunaTextBoxNumeroCompte.Text = Trim(table.Rows(0)("NUM_COMPTE"))
            GunaTextBoxRue.Text = Trim(table.Rows(0)("ADRESSE"))
            GunaTextBoxVilleDeResidence.Text = table.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = table.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = table.Rows(0)("NUM_VEHICULE")
            'GunaTextBoxCodeDeGroupe.Text = table.Rows(0)("CODE_ENTREPRISE")

            Dim Entreprise As DataTable = Functions.getElementByCode(table.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then
                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))
            End If

            GunaDataGridViewRoom.Visible = False

            'Initialisation de la ville de depart
            GunaTextBoxVenantDe.Text = GlobalVariable.AgenceActuelle.Rows(0)("VILLE")

            'Initialisation du nombre de personne

            GunaTextBoxNbreAdulte.Text = 1
            GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

            'reservationButtonToDisplay()

        Else

            GunaTextBoxNomPrenom.Clear()

        End If

        'connect.closeConnection()

        setTableUsedForAutocompletionToFalse()

        'Managing the buttons to print at the level of the main form 
        reservationButtonToDisplay()

    End Sub

    'Adding a customer that doesn't exist in database for reservation from front desk
    Private Sub GunaButtonAjouterClient_Click(sender As Object, e As EventArgs) Handles GunaButtonAjouterClient.Click

        GlobalVariable.addUserFromFrontOffice = True

        ClientForm.Show()

    End Sub

    'Calculating the number of time to spend in hotel when departure date changes
    Private Sub GunaDateTimePickerDepart_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDepart.ValueChanged

        'We calculate the resting days or hours
        CalculatingRestDaysOrHours()

        'Displaying the right buttons on on date changes
        reservationButtonToDisplay()

    End Sub

    'Calculating the number of time to spend in hotel when arrival date changes
    Private Sub GunaDateTimePickerArrivee_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerArrivee.ValueChanged

        'We calculate the resting days or hours
        CalculatingRestDaysOrHours()

        'Displaying the right buttons on on date changes
        reservationButtonToDisplay()

    End Sub

    'Calculating the days to spend in hotel
    Private Sub CalculatingRestDaysOrHours()

        'GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)

        'Le bouton gestion des heures n'etant pas cochet on ne peut pas permettre que la date d'arrivee = la date de sortie
        If GunaDateTimePickerDepart.Value.ToShortDateString() = GunaDateTimePickerArrivee.Value.ToShortDateString() Then

            If Not GunaCheckBoxDayUse.Checked Then
                GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value.AddDays(1)
            End If

            'GunaTextBoxTempsSieste.Visible = True

            'GunaTextBoxTempsAFaire.Visible = False
            GunaTextBoxTempsAFaire.Text = 1

            'Dim dateTempsArrivee As String = CType(GlobalVariable.DateDeTravail + " " + Now().ToLongTimeString, String)

            'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.selectedItem

            'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.selectedItem

            'Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss tt", Nothing)
            'Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss tt", Nothing)

            'GunaTextBoxLibelleTYpe.Text = DateTimeArrivee
            'GunaTextBoxLibelleChambre.Text = DateTimeDepart

            'Dim numberOfHoursToSpend As Integer = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            'On passe de nuitées a heures

            GunaLabelTotalHeure.Text = "Nombre d'heure(s)"
            GunaLabelPrixParNuitee.Text = "Prix par heure"

        Else

            GunaCheckBoxDayUse.Checked = False

            GunaLabelTotalHeure.Text = "Nombre de jour(s)"
            GunaLabelTempsAFaire.Text = "Total nuitée(s)"
            GunaLabelPrixParNuitee.Text = "Prix par nuitée"

            If GunaDateTimePickerDepart.Value < GunaDateTimePickerArrivee.Value Then

                GunaTextBoxTempsAFaire.Text = 0

            Else
                ' Calculate the number of days to stay
                GunaTextBoxTempsAFaire.Text = CType((GunaDateTimePickerDepart.Value - GunaDateTimePickerArrivee.Value).TotalDays, Int32)

                If (CType(GunaTextBoxTempsAFaire.Text, Int32) < 0) Then

                    GunaTextBoxTempsAFaire.Text = 1

                End If
            End If

        End If

        'Le nombre de jour total vaut le nombre de temps a faire calculé au niveau de la periode du séjour
        ReservationMoneyCalculation()

    End Sub

    'When ever the number of children or adulte changes we recalculate the number of people
    Private Sub GunaTextBoxNbreAdulte_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNbreAdulte.TextChanged

        Dim enfants As Integer = 0
        Dim adultes As Integer = 0
        Dim nombrePersonne As Integer = 0

        Integer.TryParse(GunaTextBoxNbreAdulte.Text, adultes)
        Integer.TryParse(GunaTextBoxNbreEnfant.Text, enfants)

        GunaTextBoxNbrePersonne.Text = adultes + enfants

    End Sub

    Private Sub GunaTextBoxNbreEnfant_TextChanged_1(sender As Object, e As EventArgs) Handles GunaTextBoxNbreEnfant.TextChanged

        Dim enfants As Integer = 0
        Dim adultes As Integer = 0
        Dim nombrePersonne As Integer = 0

        Integer.TryParse(GunaTextBoxNbreAdulte.Text, adultes)
        Integer.TryParse(GunaTextBoxNbreEnfant.Text, enfants)

        GunaTextBoxNbrePersonne.Text = adultes + enfants

    End Sub

    'A chaque changement de valeur du Cod client on rafraichi les calculs
    Private Sub GunaTextBoxRefClient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxRefClient.TextChanged
        'A CHAQUE FOIS QUE CETTE VALEUR CHANGE ON DOIT VERIFIER SI IL N'EST PAS ASSOCIE A UNE ENTREPRISE
        ReservationMoneyCalculation()

        'lorsque la référence du client se remplit on determine le bouton a afficher
        reservationButtonToDisplay()

    End Sub

    'calculation for the amount to pay and amount paid for reservation
    Sub ReservationMoneyCalculation()

        Dim nombreDeJourTotal As Integer
        Dim montantAccorde As Double
        Dim prixParNuitee As Double
        Dim prixRepas As Double
        Dim Total As Double
        Dim ServiceEtProduitSup As Double
        Dim montantARegler As Double
        Dim avance As Double
        Dim caution As Double

        'GESTION DES TARIFS
        'ON DETERMINE SI ON A AFFECTE DES PRIX AUX CLIENT (TARIFS) PUIS ON AGIT SELON LE CAS DE FIGURE
        'Faudrait impérativement avoir le code client et le code de type de chambre ou salle ou article
        If (Not Trim(GunaTextBoxRefClient.Text).Equals("")) And (Not Trim(GunaTextBoxCodeTypeDeChambre.Text).Equals("")) Then

            Dim tarif As New Tarifs

            'ON SELECTIONNE L'ENSEMBLE DES TARIFS
            Dim ListOftarif As DataTable = tarif.SelectDistinctTarif()

            GunaComboBoxCodeTarif.DataSource = ListOftarif
            GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
            GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

            Dim TarifDuclientActuel As DataTable = Functions.TarifAppliqueAuClient(Trim(GunaTextBoxRefClient.Text), Trim(GunaTextBoxCodeTypeDeChambre.Text))

            Dim prixDuTarif As Double = 0

            If TarifDuclientActuel.Rows.Count > 0 Then

                If TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS") = 0 Then

                    prixDuTarif = TarifDuclientActuel.Rows(0)("TARIF_PRIX1")

                Else

                    prixDuTarif = TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS")

                End If

            End If

            If TarifDuclientActuel.Rows.Count > 0 Then

                If GunaRadioButtonChambre.Checked Then

                    GunaTextBoxMontantAccorde.Text = Format(prixDuTarif, "#,##0")
                    prixParNuitee = GunaTextBoxMontantAccorde.Text

                    GunaComboBoxCodeTarif.Visible = True
                    GunaLabelCodeTarif.Visible = True

                    GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                End If

                If GunaRadioButtonSalleFete.Checked Then
                    GunaTextBoxMontantReelSalle.Text = Format(prixDuTarif, "#,##0")

                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False
                End If

            Else


            End If

        End If
        '----------------------------------------------------------------------------------

        If GunaRadioButtonChambre.Checked Then
            'CALCUL DU MONTANT LIE AUX CHAMBRES 

            Dim tempsAFaire As Integer = 0

            'Integer.TryParse(GunaTextBoxTempsSieste.Text, tempsAFaire)
            Integer.TryParse(GunaTextBoxTempsAFaire.Text, tempsAFaire)

            'GESTION DES NUITEES
            GunaTextBoxNombreDeJourTotal.Text = GunaTextBoxTempsAFaire.Text

            Integer.TryParse(GunaTextBoxNombreDeJourTotal.Text.Trim(), nombreDeJourTotal)

            'The price to take into consideration
            If Not (Double.TryParse(GunaTextBoxMontantAccorde.Text.Trim(), montantAccorde) = 0) Then
                prixParNuitee = Format(montantAccorde, "#,##0")
            Else

                Double.TryParse(GunaTextBoxpPrixAffiche.Text.Trim(), montantAccorde)
                prixParNuitee = Format(montantAccorde, "#,##0")

            End If

            GunaTextBoxPrixParNuitee.Text = Format(prixParNuitee, "#,##0")

            Double.TryParse(GunaTextBoxprixRepas.Text.Trim(), prixRepas)
            Double.TryParse(GunaTextBoxServiceEtProduitSup.Text.Trim(), ServiceEtProduitSup)
            Double.TryParse(GunaTextBoxMontantARegler.Text.Trim(), montantARegler)

            If tempsAFaire > 0 Then
                'GESTION DES NUITEES
                GunaTextBoxPrixSejour.Text = Format(montantAccorde * nombreDeJourTotal, "#,##0")
                Total = (montantAccorde * nombreDeJourTotal) + prixRepas + ServiceEtProduitSup
            Else
                'GESTION DES SIESTES
                GunaTextBoxPrixSejour.Text = Format(montantAccorde, "#,##0")
                Total = (montantAccorde * nombreDeJourTotal) + prixRepas + ServiceEtProduitSup
            End If

            GunaTextBoxTotal.Text = Format(Total, "#,##0")

        End If

        If GunaRadioButtonSalleFete.Checked Then
            'CALCUL DU MONTANT LIE AUX SALES

            If Not (Double.TryParse(GunaTextBoxMontantReelSalle.Text.Trim(), montantAccorde) = 0) Then
                Double.TryParse(GunaTextBoxMontantReelSalle.Text.Trim(), montantAccorde)
            Else
                Double.TryParse(GunaTextBoxMontantAfficherSalle.Text.Trim(), montantAccorde)
            End If

            Total = CType(GunaTextBoxTempsAFaire.Text, Int32) * montantAccorde

        End If

        'Block de paiment
        Double.TryParse(GunaTextBoxAvance.Text.Trim(), avance)
        Double.TryParse(GunaTextBoxMontantCaution.Text.Trim(), caution)

        'Derteminig the solde to display

        If Not GlobalVariable.codeReservationToUpdate = "" Then

            'Dim solde As Double = Double.Parse(Functions.SituationDuClient(GlobalVariable.codeClientToUpdate))
            Dim solde As Double = Double.Parse(Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate))
            GunaLabelSolde.Text = Format(solde, "#,##0")

            If 0 > solde Then
                GunaLabelSolde.ForeColor = Color.Red
            Else
                GunaLabelSolde.ForeColor = Color.Black
            End If

            If GunaRadioButtonChambre.Checked Then

                If 0 < GunaLabelSolde.Text Then
                    GunaTextBoxMontantARegler.Text = Format(GunaTextBoxTotal.Text - solde, "#,##0")
                Else

                End If

            End If

            If GunaRadioButtonSalleFete.Checked Then

                'GunaTextBoxGrandTotal.Text = GlobalVariable.codeReservationToUpdate.Rows(0)("")

            End If

        Else

            If GunaRadioButtonChambre.Checked Then

                GunaTextBoxMontantARegler.Text = Format(Total - avance, "#,##0")

            End If

            GunaLabelSolde.Text = 0

            'GunaTextBoxGrandTotal.Text = 0

        End If

        'Information to be inserted into database after clicking enregistrer reservation
        GlobalVariable.MONTANT_ACCORDE = montantAccorde

        GlobalVariable.MONTANT_TOTAL = Total

        GlobalVariable.MONTANT_TOTAL_CAUTION = caution

        GlobalVariable.avance = avance

    End Sub

    'Determining which buttons to display at the front office
    Sub reservationButtonToDisplay()

        Dim tempAFaire As Double = 0
        Double.TryParse(GunaTextBoxTempsAFaire.Text, tempAFaire)

        Dim tempsAFaireSieste As Integer = 0

        'Integer.TryParse(GunaTextBoxTempsSieste.Text, tempsAFaireSieste)

        'If the client field is not empty and resting time is different from 0, we show the buttons
        If (Not (GunaTextBoxNomPrenom.Text.Trim().Equals("")) And Not tempAFaire = 0) Then

            'Out putting the buttons Enregistrer, Checkin

            'GESTION DES HEURES
            If (GunaDateTimePickerDepart.Value = GunaDateTimePickerArrivee.Value) And GunaCheckBoxDayUse.Checked Then

                Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

                Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

                Dim HeureArriveInRightFormat As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
                Dim HeureDepartInRightFormat As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

                'Dim HeureArriveInRightFormat As DateTime = CDate(GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem)
                'Dim HeureDepartInRightFormat As DateTime = CDate(GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem)

                If (HeureDepartInRightFormat < HeureArriveInRightFormat) Then

                    GunaTextBoxTempsAFaire.Text = 0

                    GunaButtonReservation.Visible = True
                    'Le bouton annuler n'est visible que sin on n'a deja enresgitré une résrevation
                    If Not GlobalVariable.codeReservationToUpdate = "" Then

                        Dim ETAT_RESERVATION As Integer = 1

                        If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                            ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                        End If
                        If ETAT_RESERVATION = 0 Then
                            GunaButtonAnnulerReservation.Visible = True
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If
                    Else
                        GunaButtonAnnulerReservation.Visible = False
                    End If

                    GunaButtonCheckOut.Visible = False
                    GunaButtonCheckIn.Visible = True

                Else

                    If HeureDepartInRightFormat = HeureArriveInRightFormat Then

                        GunaButtonReservation.Visible = True
                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If
                        GunaButtonCheckOut.Visible = False
                        'we output the checkin button only it state is NON checkin not yet donne
                        If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                            GunaButtonCheckIn.Visible = False
                            'GunaButtonAnnulerReservation.Visible = True
                        Else
                            GunaButtonCheckIn.Visible = True
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        End If

                    ElseIf HeureArriveInRightFormat <= HeureDepartInRightFormat Then

                        'Gestion du checkout

                        Dim solde As Double = 0

                        Double.TryParse(GunaLabelSolde.Text, solde)

                        GunaButtonReservation.Visible = True
                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If
                        'If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 And solde >= 0 Then'
                        'GlobalVariable.reserveConfCheckOutState is ETAT_CONFIRMATION
                        'We can't checkout what has not been checked in and checkout what has already been checked out
                        If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                            GunaButtonCheckOut.Visible = True
                            GunaButtonCheckIn.Visible = False
                        Else
                            GunaButtonCheckOut.Visible = False
                            GunaButtonCheckIn.Visible = True
                        End If

                    Else

                        GunaButtonReservation.Visible = True

                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If

                        GunaButtonCheckOut.Visible = False
                        GunaButtonCheckIn.Visible = False

                    End If

                End If

            Else

                'GESTION DES DATES
                If (GunaDateTimePickerDepart.Value < GunaDateTimePickerArrivee.Value) Then

                    GunaTextBoxTempsAFaire.Text = 1

                    GunaButtonReservation.Visible = False
                    'Le bouton annuler n'est visible que sin on n'a deja enresgitré une résrevation
                    If Not GlobalVariable.codeReservationToUpdate = "" Then
                        Dim ETAT_RESERVATION As Integer = 1

                        If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                            ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                        End If
                        If ETAT_RESERVATION = 0 Then
                            GunaButtonAnnulerReservation.Visible = True
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If
                    Else
                        GunaButtonAnnulerReservation.Visible = False
                    End If

                    GunaButtonCheckOut.Visible = False
                    GunaButtonCheckIn.Visible = False

                Else

                    If GunaDateTimePickerArrivee.Value.ToShortDateString() = GlobalVariable.DateDeTravail.ToShortDateString() Then

                        GunaButtonReservation.Visible = True
                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If

                        'GunaButtonCheckOut.Visible = False
                        'we output the checkin button only it state is NON checkin not yet donne
                        If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                            GunaButtonCheckIn.Visible = False

                            If GlobalVariable.DateDeTravail.ToShortDateString() = GunaDateTimePickerDepart.Value.ToShortDateString() Then
                                GunaButtonCheckOut.Visible = True
                            Else
                                GunaButtonCheckOut.Visible = False
                            End If

                        Else
                            GunaButtonCheckIn.Visible = True
                        End If

                    ElseIf GlobalVariable.DateDeTravail.ToShortDateString() = GunaDateTimePickerDepart.Value.ToShortDateString() Then
                        'Permet a ce que l'ont puisse effectuer le checkout au bon moment et meme longtemps apres que la date soit passe
                        'Gestion du checkout
                        Dim solde As Double = 0

                        Double.TryParse(GunaLabelSolde.Text, solde)

                        GunaButtonReservation.Visible = True
                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If

                        'If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 And solde >= 0 Then'
                        'GlobalVariable.reserveConfCheckOutState is ETAT_CONFIRMATION
                        'We can't checkout what has not been checked in and checkout what has already been checked out

                        If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                            GunaButtonCheckOut.Visible = True
                        Else
                            GunaButtonCheckOut.Visible = False
                        End If

                        GunaButtonCheckIn.Visible = False

                    ElseIf GunaDateTimePickerDepart.Value.ToShortDateString() < GlobalVariable.DateDeTravail.ToShortDateString() Then
                        'Permet a ce que l'ont puisse effectuer le checkout au bon moment et meme longtemps apres que la date soit passe
                        'Gestion du checkout
                        Dim solde As Double = 0

                        Double.TryParse(GunaLabelSolde.Text, solde)

                        GunaButtonReservation.Visible = True
                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If

                        'If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 And solde >= 0 Then'
                        'GlobalVariable.reserveConfCheckOutState is ETAT_CONFIRMATION
                        'We can't checkout what has not been checked in and checkout what has already been checked out

                        If GlobalVariable.reserveConfCheckInState = "OUI" And GlobalVariable.reserveConfCheckOutState = 1 Then
                            GunaButtonCheckOut.Visible = True
                        Else
                            GunaButtonCheckOut.Visible = False
                        End If

                        GunaButtonCheckIn.Visible = False
                    Else

                        GunaButtonReservation.Visible = True

                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            Dim ETAT_RESERVATION As Integer = 1

                            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows.Count > 0 Then
                                ETAT_RESERVATION = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION").Rows(0)("ETAT_RESERVATION")
                            End If
                            If ETAT_RESERVATION = 0 Then
                                GunaButtonAnnulerReservation.Visible = True
                            Else
                                GunaButtonAnnulerReservation.Visible = False
                            End If
                        Else
                            GunaButtonAnnulerReservation.Visible = False
                        End If

                        GunaButtonCheckOut.Visible = False
                        GunaButtonCheckIn.Visible = False

                    End If

                End If

            End If

            'Else Client field empty we hide the buttons Enregistrer, Checkin, checkout
        Else

            GunaButtonReservation.Visible = False
            GunaButtonAnnulerReservation.Visible = False
            'GunaButtonCheckOut.Visible = False
            GunaButtonCheckIn.Visible = False

        End If

        'Si la réservation est dans reserve_conf on ne peut plus l'annuler via le bouton annuler mais en faisant un checkout
        If Not GlobalVariable.codeReservationToUpdate = "" Then
            If Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION").Rows.Count > 0 Then
                GunaButtonAnnulerReservation.Visible = False
            End If
        End If

    End Sub

    '-------------------------------------- RESERVATION SAVING -----------------------------------------------

    'Saving a reservation
    Private Sub GunaButtonReservation_Click(sender As Object, e As EventArgs) Handles GunaButtonReservation.Click

        Me.Cursor = Cursors.WaitCursor

        LabelNatureReservation.Visible = False

        Dim solde As Double = 0

        Double.TryParse(GunaLabelSolde.Text, solde)

        If 0 > solde Then
            GunaLabelSolde.ForeColor = Color.Red
        Else
            GunaLabelSolde.ForeColor = Color.Black
        End If

        GunaLabelNumReservation.Visible = False 'We hide reservation code

        'Refraching the front office form fields
        'affectingValuesToFields()


        'Insertion de donnees dans la table reservation

        Dim TYPE_CHAMBRE_OU_SALLE As String = ""

        If GunaRadioButtonChambre.Checked Then

            Dim adultes1 As Integer = 0
            Dim enfants1 As Integer = 0

            Double.TryParse(GunaTextBoxNbreAdulte.Text, adultes1)
            Double.TryParse(GunaTextBoxNbreEnfant.Text, enfants1)

            GlobalVariable.ADULTES = adultes1
            GlobalVariable.ENFANTS = enfants1

            TYPE_CHAMBRE_OU_SALLE = "chambre"

        ElseIf GunaRadioButtonSalleFete.Checked Then

            TYPE_CHAMBRE_OU_SALLE = "salle"

        End If

        If GunaRadioButtonMailOui.Checked Then
            GlobalVariable.RECEVOIR_EMAIL = 1
        End If

        If GunaRadioButtonSmsOui.Checked Then
            GlobalVariable.RECEVOIR_SMS = 1
        End If

        'Dim CLIENT_ID As String = GlobalVariable.codeClient

        Dim CLIENT_ID As String = GunaTextBoxRefClient.Text
        Dim UTILISATEUR_ID As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

        Dim CHAMBRE_ID As String = ""

        If Not Trim(GunaTextBoxNumeroChambre.Text) = "" Then

            CHAMBRE_ID = Trim(GunaTextBoxNumeroChambre.Text)

        Else

            CHAMBRE_ID = "-"

        End If

        Dim AGENCE_ID As String = GlobalVariable.codeAgence
        Dim NOM_CLIENT As String = GunaTextBoxNomPrenom.Text


        'ROUTAGE PETIT DEJEUNER
        Dim PETIT_DEJEUNER_ROUTAGE As Double = 0

        If GunaCheckBoxPetitDejRoutage.Checked Then
            Dim pdjRoutage As Double = 0
            Double.TryParse(GunaTextBoxPetitDejeunerRoutage.Text, pdjRoutage)
            PETIT_DEJEUNER_ROUTAGE = pdjRoutage
        End If

        'ROUTAGE LOGEMENT
        Dim CHAMBRE_ROUTAGE As String = ""

        If GunaCheckBoxChambreRoutage.Checked Then
            CHAMBRE_ROUTAGE = GunaComboBoxChambreRoutage.SelectedValue.ToString
        End If

        Dim ETAT_NOTE_RESERVATION As String

        If GunaComboBoxStatutReservation.SelectedIndex >= 0 Then
            ETAT_NOTE_RESERVATION = GunaComboBoxStatutReservation.SelectedItem.ToString
        Else
            ETAT_NOTE_RESERVATION = ""
        End If

        Dim ROUTAGE As String = GunaTextBoxRoutage.Text

        Dim SOURCE_RESERVATION As String = ""

        If GunaComboBoxSourceRéservation.SelectedIndex >= 0 Then
            SOURCE_RESERVATION = GunaComboBoxSourceRéservation.SelectedValue.ToString
        End If

        Dim VENANT_DE As String = GunaTextBoxVenantDe.Text
        Dim SE_RENDANT_A As String = GunaTextBoxSerendantA.Text
        Dim RAISON As String = GunaComboBoxTypeReservation.SelectedItem.ToString

        '----------------- dates obtained when ever the resting days change----------------------------------
        'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

        'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

        '-------------------NEW WAY ------------------

        Dim ArriveeMinutes As String = ""
        Dim ArriveeHeure As String = ""

        Dim departMinutes As String = ""
        Dim departHeure As String = ""

        If NumericUpDownArriveeMin.Value = 0 Then
            ArriveeMinutes = ":00:00"
        ElseIf NumericUpDownArriveeMin.Value < 10 Then
            ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
        Else
            ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
        End If

        If NumericUpDownHeureArrivee.Value >= 10 Then
            ArriveeHeure = NumericUpDownHeureArrivee.Value
        Else
            ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
        End If

        If NumericUpDownDepartMin.Value = 0 Then
            departMinutes = ":00:00"
        ElseIf NumericUpDownDepartMin.Value < 10 Then
            departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
        Else
            departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
        End If

        If NumericUpDownDepartHeure.Value >= 10 Then
            departHeure = NumericUpDownDepartHeure.Value
        Else
            departHeure = "0" & NumericUpDownDepartHeure.Value
        End If

        Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

        Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

        '-------------------------------------
        Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
        Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

        'Dim DATE_ENTTRE As Date = GlobalVariable.DATE_ENTTRE
        Dim DATE_ENTTRE As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
        Dim HEURE_ENTREE As String = DateTimeArrivee
        'Dim DATE_SORTIE As Date = GlobalVariable.DATE_SORTIE
        Dim DATE_SORTIE As Date = GunaDateTimePickerDepart.Value.ToShortDateString
        Dim HEURE_SORTIE As String = DateTimeDepart

        Dim ADULTES As Integer = GlobalVariable.ADULTES
        Dim ENFANTS = GlobalVariable.ENFANTS
        Dim NB_PERSONNES As Integer = ENFANTS + ADULTES
        Dim RECEVOIR_EMAIL As Integer = GlobalVariable.RECEVOIR_EMAIL
        Dim RECEVOIR_SMS As Integer = GlobalVariable.RECEVOIR_SMS
        Dim ETAT_RESERVATION As Integer = 0
        Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
        Dim HEURE_CREATION As DateTime = DateTime.Now().ToString("hh:mm:ss")
        Dim MONTANT_TOTAL_CAUTION As Double = GlobalVariable.MONTANT_TOTAL_CAUTION
        Dim MOTIF_ETAT As String = ""
        Dim DATE_ETAT As Date = GlobalVariable.DateDeTravail
        Dim MONTANT_ACCORDE As Double = GlobalVariable.MONTANT_ACCORDE

        Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
        Dim NOM_ENTREPRISE As String = Trim(GunaTextBoxEntrepriseDuclient.Text)

        Dim GROUPE As String = GunaTextBoxCodeDeGroupe.Text

        'RESERVATION DE GROUPE

        Dim CODE_RESERVATION = Functions.GeneratingRandomCode("reservation", "")

        Dim reservation As New Reservation()
        Dim mainCourante As New MainCourantes()
        Dim reglement As New Reglement()
        Dim occupationChambre As New OccupationChambre()
        Dim facture As New Facture()
        Dim ligneFacture As New LigneFacture()
        Dim compte As New Compte()
        Dim caisse As New Caisse()


        'ON MET AJOUR LE MONTANT DU SOLDE LIE A LA RESERVATION

        'Inserting a new reservation after checking that the reservation does not already exist
        If Not Functions.entryCodeExists(CODE_RESERVATION, "reservation", "CODE_RESERVATION") Then

            ' variables declarations 

            '-------------------------------- OCCUPATION CHAMBRE ------------------------------

            Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCode("occupation_chambre", "")
            Dim MONTANT_HT As Double = MONTANT_ACCORDE
            Dim TAXE As Double = 0
            Dim MONTANT_TTC As Double = 0
            Dim DATE_OCCUPATION As Date = DATE_ENTTRE
            'Dim OBSERVATIONS As String = ""
            Dim COMMENTAIRE1 As String = ""
            Dim COMMENTAIRE2 As String = ""
            Dim COMMENTAIRE3 As String = ""
            Dim COMMENTAIRE4 As String = ""
            Dim DATE_LIBERATION As Date = DATE_SORTIE
            Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
            Dim DATE_PREMIERE_ARRIVEE As Date = DATE_ENTTRE
            Dim TYPE_RESERVATION As String = ""
            Dim PDJ_INCLUS As String = ""
            Dim TAXE_SEJOURS_INCLUS As String = ""
            Dim TVA_INCLUS As String = ""
            Dim CODE_CLIENT_REEL As String = CLIENT_ID

            '------------------------------- REGLEMENT ----------------------------------------------

            Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCode("reglement", "REG")
            Dim NUM_FACTURE As String = ""
            Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
            Dim montantVerse As Double = 0
            Double.TryParse(GunaTextBoxAvance.Text, montantVerse)
            Dim MONTANT_VERSE As Double = montantVerse
            Dim DATE_REGLEMENT As Date = GlobalVariable.DateDeTravail
            Dim MODE_REGLEMENT As String = ""
            Dim REF_REGLEMENT As String = ""
            Dim CODE_MODE As String = ""
            Dim IMPRIMER As Double = 0

            '----------- MAIN COURANTES ------------------------------
            Dim CODE_MAIN_COURANTE As String = Functions.GeneratingRandomCode("main_courante", "MC")

            'Dim CODE_CLIENT As String = GlobalVariable.codeClient
            Dim CODE_CLIENT As String = Trim(GunaTextBoxRefClient.Text)

            CLIENT_ID = Trim(GunaTextBoxRefClient.Text)

            Dim CODE_CHAMBRE As String = GlobalVariable.codeChambre
            Dim ETAT_CHAMBRE As String = 0
            Dim CODE_AGENCE As String = AGENCE_ID

            '----------- MAIN COURANTE GENERALE ------------------------------

            Dim CODE_MAIN_COURANTE_GENERALE As String = Functions.GeneratingRandomCode("main_courante_generale", "")
            Dim DATE_MAIN_COURANTE As Date = GlobalVariable.DateDeTravail
            Dim PDJ_FOOD As Double = 0
            Dim PDJ_BOISSON As Double = 0
            Dim DEJEUNER_FOOD As Double = 0
            Dim DEJEUNER_BOISSON As Double = 0
            Dim DINER_FOOD As Double = 0
            Dim DINER_BOISSON As Double = 0
            Dim BANQUET_FOOD As Double = 0
            Dim BANQUET_BOISSON As Double = 0
            Dim BAR_MATIN As Double = 0
            Dim BAR_SOIR As Double = 0
            Dim DIVERS As Double = 0
            Dim TOTAL_JOUR As Double = 0
            Dim REPORT_VEILLE As Double = 0
            Dim TOTAL_GENERAL As Double = 0
            Dim NUM_RESERVATION = CODE_RESERVATION
            Dim DEDUCTION As Double = 0
            Dim ENCAISSEMENT_ESPECE As Double = 0
            Dim ENCAISSEMENT_CHEQUE As Double = 0
            Dim ENCAISSEMENT_CARTE_CREDIT As Double = 0
            Dim A_REPORTER As Double = 0
            Dim OBSERVATIONS As String = ""
            Dim TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text
            Dim INDICE_FREQUENTATION As String = ""
            Dim INDICE_FREQUENTATION_PCT As String = ""
            Dim TAUX_OCCUPATION As String = ""
            Dim TAUX_OCCUPATION_PCT As String = ""
            Dim CLIENTS_ATTENDUS As String = ""
            Dim CLIENTS_EN_CHAMBRE As String = ""
            Dim CHAMBRES_DISPONIBLES As String = ""
            Dim TOTAL_HORS_SERVICE As String = ""
            Dim CHAMBRES_HORS_SERVICE As String = ""
            Dim TOTAL_FICTIVES As String = ""
            Dim CHAMBRES_FICTIVES As String = ""
            Dim NOMBRE_MESSAGES As String = ""
            Dim TOTAL_GRATUITES As String = ""
            Dim CHAMBRES_GRATUITES As String = ""
            Dim TOTAL_NON_FACTUREES As String = ""
            Dim CHAMBRES_NON_FACTUREES As String = ""

            '----------- MAIN COURANTE JOURNALIERE ------------------------------

            Dim CODE_MAIN_COURANTE_JOURNALIERE As String = Functions.GeneratingRandomCode("main_courante_journaliere", "")
            Dim PDJ As Double = 0
            Dim DEJEUNER As Double = 0
            Dim DINER As Double = 0
            Dim CAFE As Double = 0
            Dim BAR As Double = 0
            Dim CAVE As Double = 0
            Dim AUTRE As Double = 0
            Dim SOUS_TOTAL1 As Double = 0
            Dim Location As Double = 0
            Dim TELE As Double = 0
            Dim FAX As Double = 0
            Dim LINGE As Double = 0
            Dim SOUS_TOTAL2 As Double = 0
            Dim DEBITEUR As Double = 0
            Dim ARRHES As Double = 0

            If GunaCheckBoxPetitDejeuenerInclus.Checked Then

                Dim petitDejeuner As Double = 0
                Double.TryParse(GunaTextBoxPetitDejeuner.Text, petitDejeuner)
                SOUS_TOTAL1 = petitDejeuner 'On gère les petit dejeuener inclus par apport a la valeur SOUS_TOTAL1 de la main courante journaliere

            End If

            '------------------------------- compte -----------------------------

            Dim INTITULE As String = ""
            Dim NUMERO_COMPTE As String = ""
            Dim TOTAL_DEBIT As Double = GlobalVariable.MONTANT_TOTAL
            Dim TOTAL_CREDIT As Double = GlobalVariable.avance
            Dim SOLDE_COMPTE As Double = TOTAL_CREDIT - TOTAL_DEBIT

            Dim SENS_DU_SOLDE As String = ""

            If (TOTAL_DEBIT < TOTAL_CREDIT) Then
                SENS_DU_SOLDE = "crediteur"
            ElseIf (TOTAL_CREDIT < TOTAL_DEBIT) Then
                SENS_DU_SOLDE = "debiteur"
            Else
                SENS_DU_SOLDE = "equilibre"
            End If

            Dim TYPE_DE_COMPTE As String = ""

            '--------------------------- FORFAIT SALLE
            Dim nbreCafe As Integer = 0
            Dim cafePu As Double = 0
            Dim dejeunerNbre As Integer = 0
            Dim dejeunerPu As Double = 0
            Dim dinerNbre As Integer = 0
            Dim dinerPu As Double = 0
            Dim traiteurNbre As Integer = 0
            Dim traiteurPu As Double = 0

            Double.TryParse(GunaTextBox35.Text, nbreCafe)
            Double.TryParse(GunaTextBoxForfaitCafe.Text, cafePu)
            Double.TryParse(GunaTextBox30.Text, dejeunerNbre)
            Double.TryParse(GunaTextBoxForfatiDejeuner.Text, dejeunerPu)
            Double.TryParse(GunaTextBox25.Text, dinerNbre)
            Double.TryParse(GunaTextBoxForfaitDiner.Text, dinerPu)
            Double.TryParse(GunaTextBox13.Text, traiteurNbre)
            Double.TryParse(GunaTextBoxForfaitTraiteur.Text, traiteurPu)

            Dim NBRE__CAFE = nbreCafe
            Dim PU_CAFE = cafePu
            Dim NBRE_DEJEUNER = dejeunerNbre
            Dim PU_DEJEUNER = dejeunerPu
            Dim NBRE_DINER = dinerNbre
            Dim PU_DINER = dinerPu
            Dim NBRE_TRAITEUR = traiteurNbre
            Dim PU_TRAITEUR = traiteurNbre
            Dim decorationCast As Double = 0
            Double.TryParse(GunaTextBoxDecoration.Text, decorationCast)
            Dim DECORATION = decorationCast

            '---------------------- Facturation ---------------------------------------

            Dim CODE_FACTURE = Functions.GeneratingRandomCode("facture", "")
            Dim NUMERO_PIECE = ""
            Dim CODE_ARTICLE = ""
            Dim CODE_LOT = ""
            Dim QUANTITE = 1
            Dim PRIX_UNITAIRE_TTC = 0
            Dim DATE_FACTURE = GlobalVariable.DateDeTravail
            Dim HEURE_FACTURE = Now().ToShortTimeString
            Dim ETAT_FACTURE = 0
            Dim HEURE_OCCUPATION = Now().ToShortTimeString
            Dim LIBELLE_FACTURE = "Avance Location Salle(" & CODE_CHAMBRE & ")"
            Dim TYPE_LIGNE_FACTURE = 0
            Dim NUMERO_SERIE = ""
            Dim NUMERO_ORDRE = ""
            Dim DESCRIPTION = ""
            Dim MONTANT_REMISE = 0
            Dim MONTANT_TAXE = 0
            Dim NUMERO_SERIE_DEBUT = ""
            Dim NUMERO_SERIE_FIN = ""
            Dim CODE_MAGASIN = ""
            Dim FUSIONNEE = ""
            Dim Type = GlobalVariable.typeChambreOuSalle
            Dim CODE_MOUVEMENT = ""
            Dim CODE_MODE_PAIEMENT = ""

            '-------------------------- UPDATE ROOM --------------------------------

            If GlobalVariable.codeChambreToUpdate = "" Then
                'We  update the room, we manually got CODE_CHAMBRE when we inserted the room informations
                Dim updateQuery As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code "

                Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)

                command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                command.Parameters.Add("@code", MySqlDbType.VarChar).Value = Trim(GunaTextBoxNumeroChambre.Text)
                command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Occupée propre"

                'Opening the connection
                'connect.openConnection()

                'Excuting the command and testing if everything went on well
                If (command.ExecuteNonQuery() = 1) Then
                    'connect.closeConnection()
                End If

            Else
                'DELOGEMENT D'UNE CHAMBRE POUR UNE AUTRE
                ' We come from main courante reception journaliere
                'The room has been changed
                'If Not GlobalVariable.codeChambreToUpdate = GlobalVariable.codeChambre Then
                If Not GlobalVariable.codeChambreToUpdate = Trim(GunaTextBoxNumeroChambre.Text) Then

                    Dim motifDelogement As String = InputBox("DELOGEMENT ", "Motif du délogement", "")

                    OBSERVATIONS = motifDelogement

                    Dim newEtatChambre As String = "Libre propre"

                    Dim reservationActuel As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

                    If reservationActuel.Rows.Count > 0 Then
                        newEtatChambre = "Libre propre"
                    Else

                        Dim reservationConfActuel As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                        If reservationConfActuel.Rows.Count > 0 Then
                            newEtatChambre = "Libre sale"
                        Else

                        End If

                    End If
                    'The room has been changed, we liberate the old room and set the new room as occupied

                    'We liberate the old room so as to set occupy the new room
                    Dim updateQuery1 As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

                    Dim command1 As New MySqlCommand(updateQuery1, GlobalVariable.connect)

                    command1.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                    'command1.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
                    command1.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambreToUpdate
                    command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = newEtatChambre

                    'Opening the connection
                    'connect.openConnection()

                    'Excuting the command and testing if everything went on well
                    If (command1.ExecuteNonQuery() = 1) Then
                        'connect.closeConnection()
                    End If

                    'We set the new room as occupied
                    'CODE_CHAMBRE = GlobalVariable.codeChambreToUpdate
                    CODE_CHAMBRE = Trim(GunaTextBoxNumeroChambre.Text)

                    Dim updateQuery2 As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

                    Dim command2 As New MySqlCommand(updateQuery2, GlobalVariable.connect)

                    If newEtatChambre = "Libre propre" Then
                        newEtatChambre = "Occupée propre" 'Simple reservation
                    Else
                        newEtatChambre = "Occupée sale" 'reservation confirmee
                    End If

                    command2.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                    command2.Parameters.Add("@code", MySqlDbType.VarChar).Value = CODE_CHAMBRE
                    command2.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Occupée propre"

                    OBSERVATIONS = "Délogement de la " & GlobalVariable.codeChambreToUpdate & " vers " & Trim(GunaTextBoxNumeroChambre.Text) & " pour " & motifDelogement
                    If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                    End If

                    'Opening the connection
                    'connect.openConnection()

                    'Excuting the command and testing if everything went on well
                    If (command2.ExecuteNonQuery() = 1) Then
                        'connect.closeConnection()
                    End If

                End If

                'We set back the global variables used for update to their initial values

            End If

            '-------------------------- OCCUPATION CHAMBRE--------------------------
            If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                If GlobalVariable.codeOccupationchambreToUpdate = "" Then
                    'As the Global variable codeMainCouranteToUpdate is empty => new  Entry

                    If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                    End If

                Else

                    'As the Global variable codeMainCouranteToUpdate is not empty => insert again

                    If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                    End If

                End If

            End If

            'GESTION DES AVANCES ICI

            '----------- MAIN COURANTE GENERALE ------------------------------

            'We check if the the main courante generale already exist
            If Not Functions.entryCodeExists(CODE_MAIN_COURANTE_GENERALE, "main_courante_generale", "CODE_MAIN_COURANTE_GENERALE") Then

                If GlobalVariable.codeMainCouranteToUpdate = "" Then
                    'As the Global variable codeMainCouranteGeneraleToUpdate is empty => new  Entry

                    If mainCourante.insertMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                    End If

                Else
                    'As the Global variable codeMainCouranteGeneraleToUpdate is not empty => update 

                    CODE_MAIN_COURANTE_GENERALE = GlobalVariable.codeMainCouranteGeneraleToUpdate
                    NUM_RESERVATION = GlobalVariable.codeReservationToUpdate

                    If mainCourante.updateMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                    End If

                End If

            End If

            '----------- MAIN COURANTE JOURNALIERE ------------------------------

            'We check if the the main courante journaliere already exist
            If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                If GlobalVariable.codeMainCouranteJournaliereToUpdate = "" Then
                    'As the Global variable codeMainCouranteToUpdate is empty => new  Entry

                    If mainCourante.insertMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                    End If

                Else
                    'As the Global variable codeMainCourantJournaliereToUpdate is not empty => update 

                    CODE_MAIN_COURANTE_JOURNALIERE = GlobalVariable.codeMainCouranteJournaliereToUpdate
                    NUM_RESERVATION = GlobalVariable.codeReservationToUpdate

                    If mainCourante.updateMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                    End If

                End If

            End If

            '------------------------------------------------- GESTION DE LA RESERVATION  -----------------------------------

            If (GlobalVariable.codeReservationToUpdate = "") Then

                'As the Global variable codeReservationToUpdate is empty => new Reservation Entry 

                If reservation.insertReservation(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                    If GlobalVariable.typeChambreOuSalle = "salle" Then
                        reservation.insertForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                    End If

                    MessageBox.Show("Réservation de " & NOM_CLIENT & " du " & DATE_ENTTRE & " au " & DATE_SORTIE & " enregistrée avec succès!!", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                Else
                    'Error when inserting a new reservation entry
                    MessageBox.Show("Problème lors de l'enregistrement de Réservation !!", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Warning)

                End If

            Else

                '-------------------------EITHER WE ARE UPDATING A RESERVATION OR A RESERVATION_CONF-----------------------------------------

                'As the Global variable codeReservationToUpdate is not empty => update reservation or reservation _conf
                ' we determine if the reservation is found in reservation or reserve_conf
                CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                CHAMBRE_ID = GlobalVariable.codeChambre

                'We have to search where the reservtion to update is found either in reservation or reserve_conf
                Dim reservationTable As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

                If reservationTable.Rows.Count > 0 Then

                    ' The Reseravtion is found in reservation

                    If reservation.updateReservation(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            'ICI LE SOLDE_RESERVATION DEPAND DU LABEL EMPECHANT UNE VUE INSTANTANNEE
                            'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", GunaLabelSolde.Text)
                            Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                            reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                        End If

                        If GlobalVariable.typeChambreOuSalle = "salle" Then
                            reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                        End If

                        MessageBox.Show("Réservation de " & NOM_CLIENT & " du " & DATE_ENTTRE & " au " & DATE_SORTIE & " Mise à jours avec succès!!", "Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If

                Else

                    'The resevation is instead found in reserve_conf
                    'We have to set back the value of etat_reservation from 0 to 1
                    ETAT_RESERVATION = 1
                    CHAMBRE_ID = GlobalVariable.codeChambre
                    'MessageBox.Show(CLIENT_ID & " - " & CHAMBRE_ID)
                    'In case the table has migrate from reservation to reservation_conf we update instead in reserve_conf

                    If reservation.updateReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reserve_conf", GunaLabelSolde.Text)
                            Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                            reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reserve_conf", updatedSolde)
                        End If

                        If GlobalVariable.typeChambreOuSalle = "salle" Then
                            reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                        End If

                    End If

                End If

            End If

        End If

        '-------------------------------------------- TAXE SEJOUR COLLECTE -------------------------------------------------------------------------

        If GunaCheckBoxTaxeSejour.Checked Then

            'We delete if something already exist and insert a new entry
            Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

            'Insertion des lignes dans taxe séjours collectées TAXE_SEJOURS_COLLECTEE
            Dim insertQueryTaxe As String = "INSERT INTO `taxe_sejour_collectee`(`CODE_CATEGORIE_HOTEL`, `CODE_CLIENT`, `NUM_RESERVATION`, `NUM_FACTURE`, `CODE_CHAMBRE`, `TAXE_SEJOUR_COLLECTEE`, `DATE_FACTURATION_TAXE`, `DATE_CREATION`, `CODE_UTILISATEUR_CREA`, `CODE_AGENCE`) VALUES (@valu1,@valu2,@valu3,@valu4,@valu5,@valu6,@valu7,@valu8,@valu9,@valu10)"

            Dim commandTaxe As New MySqlCommand(insertQueryTaxe, GlobalVariable.connect)

            commandTaxe.Parameters.Add("@valu1", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CATEGORIE_HOTEL")
            commandTaxe.Parameters.Add("@valu2", MySqlDbType.VarChar).Value = CLIENT_ID
            commandTaxe.Parameters.Add("@valu3", MySqlDbType.VarChar).Value = CODE_RESERVATION
            commandTaxe.Parameters.Add("@valu4", MySqlDbType.VarChar).Value = ""
            commandTaxe.Parameters.Add("@valu5", MySqlDbType.VarChar).Value = CHAMBRE_ID

            Dim TaxeSejour As Double
            Double.TryParse(GunaTextBoxTaxeSejour.Text, TaxeSejour)
            commandTaxe.Parameters.Add("@valu6", MySqlDbType.Double).Value = TaxeSejour

            commandTaxe.Parameters.Add("@valu7", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
            commandTaxe.Parameters.Add("@valu8", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
            commandTaxe.Parameters.Add("@valu9", MySqlDbType.VarChar).Value = GlobalVariable.codeUser
            commandTaxe.Parameters.Add("@valu10", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")

            'Opening the connection
            'connect.openConnection()

            'Excuting the command and testing if everything went on well
            If (commandTaxe.ExecuteNonQuery() = 1) Then
                'connect.closeConnection()
            Else
                'connect.closeConnection()
            End If

        End If

        'MISE A JOUR DU SOLDE DE LA RESERVATION 
        Dim reservationToUpdateInReservation As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

        'SOIT DANS RESERVATION
        If reservationToUpdateInReservation.Rows.Count > 0 Then

            'MISE JOURS DU SOLDE DE LA RESERVATION
            Dim updatedSolde As Double = Functions.SituationDeReservation(CODE_RESERVATION)

            reservation.updateSoldeReservation(CODE_RESERVATION, "reservation", updatedSolde)

        Else

            'OU DANS RESERVATION
            Dim reservationToUpdateInReserve_conf As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

            If reservationToUpdateInReserve_conf.Rows.Count > 0 Then

                Dim updatedSolde As Double = Functions.SituationDeReservation(CODE_RESERVATION)

                reservation.updateSoldeReservation(CODE_RESERVATION, "reserve_conf", updatedSolde)

            End If

        End If

        '-------------------------------------------- IMPRESSION DES DOCUMENTS -------------------------------------------------

        'la fiche de confirmation ou de contrat s'imrpirme uniquement si c'est la premiere reservation
        If GlobalVariable.codeReservationToUpdate = "" Then

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Télécharger La fiche de confirmation ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If dialog = DialogResult.No Then
                'e.Cancel = True
            Else

                'Génération des documents concernants les salles Confirmation de réservation
                Dim montantParNuitee As Double = 0

                'DOCUMENT DE LA SALLE DE FETE
                If GunaRadioButtonSalleFete.Checked Then

                    If GlobalVariable.codeReservationToUpdate = "" Then

                        'CONFIRMATION DE RESERVATION

                        Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                        'CONTRAT DE POLICE
                        'Functions.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GunaDateTimeHeureArrive.Value.ToLongTimeString, GunaDateTimePickerHeureDepart.Value.ToLongTimeString, GlobalVariable.typeChambreOuSalle)

                        Functions.GenerationDeConfirmationReservation(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)

                    Else

                        'MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If

                    'DOCUMENT DE LA CHAMBRE
                ElseIf GunaRadioButtonChambre.Checked Then
                    'Génération des documents concernants les chambres confirmation de réservation

                    If GlobalVariable.codeReservationToUpdate = "" Then
                        'CONFIRMATION DE RESERVATION
                        Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)

                        Functions.GenerationDeConfirmationReservation(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)


                        'FICHE DE POLICE
                        'Génératiion de la fiche de police pour les chambres
                        'Functions.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GunaDateTimeHeureArrive.Value.ToLongTimeString, GunaDateTimePickerHeureDepart.Value.ToLongTimeString, GlobalVariable.typeChambreOuSalle)
                    Else

                        'MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                    End If

                End If

            End If

        End If

        '---------------------------------------------------------------------------------------------------------------------
        'TabControlHbergement.SelectedIndex = 0

        VidageDesChampsPourNouvelleReservation()

        '-------------------------------------------------------------------------------------------------
        'RSERVATION NORMALE

        'Clearing all the informations found in the the reseravtion field
        'emtptyRegistrationFields()

        'We set all the global variables used for update to their original values
        Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        'Renitialisation des dates en plus de la date de travail après avoir vidé les variables globales
        ReinitialisationDesDates()

        Functions.SiplifiedClearTextBox(Me)

        'On masque les tarifs associés au client si existe 
        GunaComboBoxCodeTarif.Visible = False
        GunaLabelCodeTarif.Visible = False

        'ReservationList()

        'Desactivation du bouton de gestion de groupe
        GunaCheckBoxReservationDeGroupe.Checked = False

        reservationButtonToDisplay()

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaCheckBoxTaxeSejour.Checked = False
        GunaTextBoxPetitDejeuner.Visible = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False

        'Obtention des informations pour les statistiques
        Dim stat As New statistiques()

        stat.ObtenirDerniereStatistique()

        Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

        GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

        Me.Cursor = Cursors.Default

    End Sub

    '------------------------------ END RESERVATION ----------------------------------


    'When Changing the real price manually we re do calculations
    Private Sub GunaTextBoxMontantAccorde_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxMontantAccorde.TextChanged

        ReservationMoneyCalculation()

    End Sub

    'We automatically fill the user part of the form when when ever a new client is created
    Sub FillingFormFromNewlyCreatedUserData()

        If (GlobalVariable.addUserFromFrontOffice = True) Then

            GunaTextBoxNomPrenom.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("NOM_PRENOM").ToString
            GunaTextBoxTelClient.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("TELEPHONE").ToString
            GunaTextBoxClientEmail.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("EMAIL").ToString
            GunaTextBoxCNI.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("CNI").ToString
            GunaTextBoxRefClient.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_CLIENT").ToString)
            GlobalVariable.codeClient = GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_CLIENT").ToString
            'GunaTextBoxRefClient.Text = Trim(Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_CLIENT").ToString))
            GunaTextBoxSiteWeb.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("SITE_INTERNET").ToString)
            GunaTextBoxTelClient.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("TELEPHONE"))
            GunaTextBoxNomJeuneFille.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("NOM_JEUNE_FILLE"))
            GunaTextBoxTypeClient.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("TYPE_CLIENT"))
            GunaDateTimePickerDateNaissance.Value = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("DATE_DE_NAISSANCE"))
            GunaTextBoxLieu.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("LIEU_DE_NAISSANCE"))
            GunaTextBoxNationalite.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("NATIONALITE"))
            GunaTextBoxPaysResidence.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("PAYS_RESIDENCE"))
            GunaTextBoxProfession.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("PROFESSION"))
            GunaTextBoxNumeroCompte.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("NUM_COMPTE"))
            GunaTextBoxRue.Text = Trim(GlobalVariable.userAddedFromFrontOffice.Rows(0)("ADRESSE"))
            GunaTextBoxVilleDeResidence.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = GlobalVariable.userAddedFromFrontOffice.Rows(0)("NUM_VEHICULE")

            'Client ajouté a partir du front desk chargement de l'entreprise du client
            Dim Entreprise As DataTable = Functions.getElementByCode(GlobalVariable.userAddedFromFrontOffice.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then
                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))
            End If

        End If

        'We determine which button to display depending on the information that have been filled
        reservationButtonToDisplay()

    End Sub

    'When we save the newly create user we activate the main form so as to fill automaticcaly the new user in the reservation form
    Private Sub MainWindow_Activated(sender As Object, e As EventArgs) Handles MyBase.Activated

        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()



        'elementsDesChambres()
        'contenuStatistique()
        'StatistiquesDesChambres()
        'StatusDesChambres() 'Icon des chambres au niveau du dashboard
        'GunaGroupBoxRoomStatus.Controls.Clear()
        'GunaGroupBoxStatistiques.Controls.Clear()
        'StatusDesChambres() 'Icon des chambres au niveau du dashboard
        'ReservationList()
        'ListeDesAttendues()
        'ListeDesDeparts()
        'ListeDesEnChambres()

        'Refresh the Room List
        'Dim room As New RoomForm()
        'room.roomList()
        Me.Refresh()

        ' GlobalVariable.cloturer = True lorsque l'on cloture une journee
        If GlobalVariable.cloturer Then

            elementsDesChambres()
            contenuStatistique()
            StatistiquesDesChambres()
            StatusDesChambres()
            StatusDesChambres()

            GunaDateTimePickerArriveeDepart.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerDepartDepert.Value = GlobalVariable.DateDeTravail.AddDays(1)
            GunaDateTimePickerDebutEnChambre.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerArrivee.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail
            GunaLabelDateDeTravail.Text = GlobalVariable.DateDeTravail.ToShortDateString
            GunaDateTimePickerDebut.Value = GlobalVariable.DateDeTravail
            GunaDateTimePickerFin.Value = GlobalVariable.DateDeTravail

            'Clearing all the informations found in the the reseravtion field
            VidageDesChampsPourNouvelleReservation()
            'Functions.emptyFields(Me)

            'We set all the global variables used for update to their original values
            Functions.EmtyGlobalVariablesContainingCodeToUpdate()
            ReinitialisationDesDates()

            'Functions.SiplifiedClearTextBox(Me)

            'On masque les tarifs associés au client si existe 
            GunaComboBoxCodeTarif.Visible = False
            GunaLabelCodeTarif.Visible = False

            GlobalVariable.cloturer = False

        End If

        'Loading Tarif from front desk, as it has an influence on Prix réel
        If GlobalVariable.tarifFromFrontDesk Then

            Dim tarif As DataTable = Functions.getElementByCode(GlobalVariable.tarifFromFrontDeskCode, "tarif_prix", "ID_TARIF")

            If GlobalVariable.typeChambreOuSalle = "chambre" Then

                If tarif.Rows.Count > 0 Then

                    GunaTextBoxMontantAccorde.Text = Format(tarif.Rows(0)("PRIX_TARIF1"), "#,##0")

                End If

            ElseIf GlobalVariable.typeChambreOuSalle = "salle" Then

                If tarif.Rows.Count > 0 Then

                    GunaTextBoxMontantReelSalle.Text = Format(tarif.Rows(0)("PRIX_TARIF1"), "#,##0")

                End If

            End If

            GlobalVariable.tarifFromFrontDeskCode = ""
            GlobalVariable.tarifFromFrontDesk = False
        End If


        'We update our values from Planning pannel
        If GlobalVariable.ComingFromPlanning Then

            GunaLabelNumReservation.Visible = True
            GunaLabelNumReservation.Text = "Hello"
            'We set back the value to false
            GlobalVariable.ComingFromPlanning = False

        End If

        If Not GlobalVariable.chambreOuSalleFromFrontDesk = "" Then

            'ON ne peut mettre que ceux qui sont libre propre
            Dim chambre As DataTable = Functions.getElementByCode(GlobalVariable.chambreOuSalleFromFrontDesk, "chambre", "CODE_CHAMBRE")

            'We want to attribute the code of the romm that was select in the room list coming from the frontdesk
            If chambre.Rows.Count > 0 Then

                Dim chambreId As Integer = 0
                Integer.TryParse(chambre.Rows(0)("ID_CHAMBRE"), chambreId)
                GlobalVariable.idChambre = chambreId
                GlobalVariable.codeChambre = chambre.Rows(0)("CODE_CHAMBRE").ToString
                GunaTextBoxNumeroChambre.Text = chambre.Rows(0)("CODE_CHAMBRE").ToString
                GunaTextBoxLibelleChambre.Text = chambre.Rows(0)("LOCALISATION").ToString
                'GunaTextBoxSuperficie.Text = chambre.Rows(0)("SUPERFICIE").ToString
                'GunaTextBoxSuperficie.Text = chambre.Rows(0)("CAPACITE").ToString

                GunaDataGridViewRoom.Visible = False

            End If

            GlobalVariable.chambreOuSalleFromFrontDesk = ""

        End If

        If GlobalVariable.addCategorieFromFrontOffice Then

            ' We add the information obtained after a double click on the Room Type Categorie list

            GunaTextBoxCodeTypeDeChambre.Text = GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("CODE_TYPE_CHAMBRE")

            GunaTextBoxLibelleTYpe.Text = GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("LIBELLE_TYPE_CHAMBRE")

            Dim PrixAffiche As Double
            Double.TryParse(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), PrixAffiche)
            GunaTextBoxpPrixAffiche.Text = Format(PrixAffiche, "#,##0")

            Dim prixAccorde As Double
            Double.TryParse(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), prixAccorde)
            GunaTextBoxMontantAccorde.Text = Format(prixAccorde, "#,##0")
            'GunaTextBoxCodeType.Text = GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("CODE_TYPE_CHAMBRE")

            If GlobalVariable.typeChambreOuSalle = "salle" Then

                GunaTextBoxMontantAfficherSalle.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), "#,##0")
                GunaTextBoxMontantReelSalle.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("PRIX"), "#,##0")
                GunaTextBoxSuperficie.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("SUPERFICIE"), "#,##0")
                GunaTextBoxCapacite.Text = Format(GlobalVariable.CategorieAddedFromFrontOffice.Rows(0)("CAPACITE"), "#,##0")

            End If

            'GunaTextBoxNumeroChambre.BaseColor = Color.White
            GunaTextBoxNumeroChambre.Enabled = True

            GunaTextBoxNumeroChambre.Text = ""
            GunaTextBoxLibelleChambre.Text = ""

            GlobalVariable.addCategorieFromFrontOffice = False

        End If

        'Refreshing the value of the Solde 
        If Not GlobalVariable.codeClientToUpdate = "" Then

            'GunaLabelSolde.Text = Format(Functions.SituationDuClient(GlobalVariable.codeClientToUpdate), "#,##0")
            GunaLabelSolde.Text = Format(Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate), "#,##0")

            'We print the reservation  number or code
            GunaLabelNumReservation.Visible = True
            GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate
            GunaLabelNumReservation.Refresh()

        End If

        If GlobalVariable.addUserFromFrontOffice Then

            FillingFormFromNewlyCreatedUserData()

            GlobalVariable.addUserFromFrontOffice = False

        End If

        'We activated the main form as we come from MainCouranteJournaliere
        If (GlobalVariable.fromMainCouranteJournaliereToFrontOffice) Then

            TabControlHbergement.SelectedIndex = 0

            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We set the value that permit to know that we come fron MainCouranteJournaliere to Default
            GlobalVariable.fromMainCouranteJournaliereToFrontOffice = False

        End If

        Dim solde As Double = 0

        Double.TryParse(GunaLabelSolde.Text, solde)

        If 0 > solde Then
            GunaLabelSolde.ForeColor = Color.Red
        Else
            GunaLabelSolde.ForeColor = Color.Black
        End If

        GunaDataGridViewRoomType.Visible = False
        GunaDataGridViewClient.Visible = False
        GunaDataGridViewRoom.Visible = False
        GunaDataGridViewPhone.Visible = False

    End Sub

    'Update the amount when ever the arhes (Avances) changes
    Private Sub GunaTextBoxAvance_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxAvance.TextChanged

        'We automatically field information of the newly registered client
        ReservationMoneyCalculation()

    End Sub

    'END OF FILLING OF FORM FOR REGISTRATION

    '-------------------------------------------------- CHECKIN MANAGEMENT BUTTON ------------------------------------------------------

    Private Sub GunaButtonCheckIn_Click(sender As Object, e As EventArgs) Handles GunaButtonCheckIn.Click

        Me.Cursor = Cursors.WaitCursor

        LabelNatureReservation.Visible = False

        Dim solde As Double = 0

        Double.TryParse(GunaLabelSolde.Text, solde)

        If 0 > solde Then
            GunaLabelSolde.ForeColor = Color.Red
        Else
            GunaLabelSolde.ForeColor = Color.Black
        End If

        'On masque les tarifs associés au client si existe 
        GunaComboBoxCodeTarif.Visible = False
        GunaLabelCodeTarif.Visible = False

        GunaLabelNumReservation.Visible = False 'We hide reservation code 

        Dim enfantsCast As Integer = 0
        Dim adultesCast As Integer = 0

        Integer.TryParse(GunaTextBoxNbreAdulte.Text, adultesCast)
        Integer.TryParse(GunaTextBoxNbreEnfant.Text, enfantsCast)
        GlobalVariable.ADULTES = adultesCast
        GlobalVariable.ENFANTS = enfantsCast

        If GunaRadioButtonMailOui.Checked Then
            GlobalVariable.RECEVOIR_EMAIL = 1
        End If

        If GunaRadioButtonSmsOui.Checked Then
            GlobalVariable.RECEVOIR_SMS = 1
        End If

        Dim CLIENT_ID As String = GunaTextBoxRefClient.Text

        Dim UTILISATEUR_ID As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")

        Dim CHAMBRE_ID As String = ""

        If Not Trim(GunaTextBoxNumeroChambre.Text) = "" Then

            CHAMBRE_ID = Trim(GunaTextBoxNumeroChambre.Text)

        Else

            CHAMBRE_ID = "-"

        End If

        Dim AGENCE_ID As String = GlobalVariable.codeAgence

        Dim NOM_CLIENT As String = GunaTextBoxNomPrenom.Text

        'ROUTAGE PETIT DEJEUNER
        Dim PETIT_DEJEUNER_ROUTAGE As Double = 0

        If GunaCheckBoxPetitDejRoutage.Checked Then
            Dim pdjRoutage As Double = 0
            Double.TryParse(GunaTextBoxPetitDejeunerRoutage.Text, pdjRoutage)
            PETIT_DEJEUNER_ROUTAGE = pdjRoutage
        End If

        'ROUTAGE LOGEMENT
        Dim CHAMBRE_ROUTAGE As String = ""

        If GunaCheckBoxChambreRoutage.Checked Then
            CHAMBRE_ROUTAGE = GunaComboBoxChambreRoutage.SelectedValue.ToString
        End If

        Dim ETAT_NOTE_RESERVATION As String

        If GunaComboBoxStatutReservation.SelectedIndex >= 0 Then
            ETAT_NOTE_RESERVATION = GunaComboBoxStatutReservation.SelectedItem.ToString
        Else
            ETAT_NOTE_RESERVATION = ""
        End If

        Dim ROUTAGE As String = GunaTextBoxRoutage.Text

        Dim SOURCE_RESERVATION As String = ""

        If GunaComboBoxSourceRéservation.SelectedIndex >= 0 Then
            SOURCE_RESERVATION = GunaComboBoxSourceRéservation.SelectedValue.ToString
        End If

        Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
        Dim NOM_ENTREPRISE As String = Trim(GunaTextBoxEntrepriseDuclient.Text)

        Dim VENANT_DE As String = GunaTextBoxVenantDe.Text
        Dim SE_RENDANT_A As String = GunaTextBoxSerendantA.Text
        Dim RAISON As String = GunaComboBoxTypeReservation.SelectedItem.ToString

        '----------------- dates obtained when ever the resting days change
        'working perfectly
        'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

        'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

        'Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
        'Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

        '-------------------NEW WAY ------------------

        Dim ArriveeMinutes As String = ""
        Dim ArriveeHeure As String = ""

        Dim departMinutes As String = ""
        Dim departHeure As String = ""

        If NumericUpDownArriveeMin.Value = 0 Then
            ArriveeMinutes = ":00:00"
        ElseIf NumericUpDownArriveeMin.Value < 10 Then
            ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
        Else
            ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
        End If

        If NumericUpDownHeureArrivee.Value >= 10 Then
            ArriveeHeure = NumericUpDownHeureArrivee.Value
        Else
            ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
        End If

        If NumericUpDownDepartMin.Value = 0 Then
            departMinutes = ":00:00"
        ElseIf NumericUpDownDepartMin.Value < 10 Then
            departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
        Else
            departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
        End If

        If NumericUpDownDepartHeure.Value >= 10 Then
            departHeure = NumericUpDownDepartHeure.Value
        Else
            departHeure = "0" & NumericUpDownDepartHeure.Value
        End If

        Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

        Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

        'MessageBox.Show(DateTimeArriveeStringFormat + "-" + DateTimeDepartStringFormat, "Dates Time")
        '-------------------------------------

        Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
        Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
        'Dim DATE_ENTTRE As Date = GlobalVariable.DATE_ENTTRE
        Dim DATE_ENTTRE As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
        Dim HEURE_ENTREE As String = DateTimeArrivee
        'Dim DATE_SORTIE As Date = GlobalVariable.DATE_SORTIE
        Dim DATE_SORTIE As Date = GunaDateTimePickerDepart.Value.ToShortDateString
        Dim HEURE_SORTIE As String = DateTimeDepart

        Dim TYPE_CHAMBRE_OU_SALLE As String = ""

        If GunaRadioButtonChambre.Checked Then

            TYPE_CHAMBRE_OU_SALLE = "chambre"

        ElseIf GunaRadioButtonSalleFete.Checked Then

            TYPE_CHAMBRE_OU_SALLE = "salle"

        End If

        If GunaRadioButtonMailOui.Checked Then
            GlobalVariable.RECEVOIR_EMAIL = 1
        End If

        Dim ADULTES As Integer = GlobalVariable.ADULTES
        Dim ENFANTS = GlobalVariable.ENFANTS
        Dim NB_PERSONNES As Integer = ENFANTS + ADULTES
        Dim RECEVOIR_EMAIL As Integer = GlobalVariable.RECEVOIR_EMAIL
        Dim RECEVOIR_SMS As Integer = GlobalVariable.RECEVOIR_SMS
        Dim ETAT_RESERVATION As Integer = 1
        Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
        Dim HEURE_CREATION As DateTime = DateTime.Now().ToString("hh:mm:ss")
        Dim MONTANT_TOTAL_CAUTION As Double = GlobalVariable.MONTANT_TOTAL_CAUTION
        Dim MOTIF_ETAT As String = ""
        Dim DATE_ETAT As Date = GlobalVariable.DateDeTravail
        Dim MONTANT_ACCORDE As Double = GlobalVariable.MONTANT_ACCORDE

        'RESERVATION DE GROUPE
        Dim GROUPE As String = ""

        If GunaCheckBoxReservationDeGroupe.Checked Then
            GROUPE = Trim(GunaTextBoxCodeDeGroupe.Text)
        End If

        Dim CODE_RESERVATION = Functions.GeneratingRandomCode("reservation", "")

        Dim reservation As New Reservation()
        Dim mainCourante As New MainCourantes()
        Dim reglement As New Reglement()
        Dim occupationChambre As New OccupationChambre()
        Dim facture As New Facture()

        Dim compte As New Compte()
        Dim caisse As New Caisse()

        'Inserting a new reservation after checking that the reservation does not already exist

        ' variables declarations 

        '-------------------------------- OCCUPATION CHAMBRE ------------------------------
        Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCode("occupation_chambre", "")
        Dim MONTANT_HT As Double = MONTANT_ACCORDE
        Dim TAXE As Double = 0
        Dim MONTANT_TTC As Double = 0
        Dim DATE_OCCUPATION As Date = DATE_ENTTRE
        'Dim OBSERVATIONS As String =""
        Dim COMMENTAIRE1 As String = ""
        Dim COMMENTAIRE2 As String = ""
        Dim COMMENTAIRE3 As String = ""
        Dim COMMENTAIRE4 As String = ""
        Dim DATE_LIBERATION As Date = DATE_SORTIE
        Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim DATE_PREMIERE_ARRIVEE As Date = DATE_ENTTRE
        Dim TYPE_RESERVATION As String = ""
        Dim PDJ_INCLUS As String = ""
        Dim TAXE_SEJOURS_INCLUS As String = ""
        Dim TVA_INCLUS As String = ""
        Dim CODE_CLIENT_REEL As String = CLIENT_ID

        '------------------------------- REGLEMENT ----------------------------------------------

        Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCode("reglement", "RGL")
        Dim NUM_FACTURE As String = ""
        Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim montantVerse As Double = 0
        Double.TryParse(GunaTextBoxAvance.Text, montantVerse)
        Dim MONTANT_VERSE As Double = montantVerse
        Dim DATE_REGLEMENT As Date = GlobalVariable.DateDeTravail
        Dim MODE_REGLEMENT As String = ""
        Dim REF_REGLEMENT As String = ""
        Dim CODE_MODE As String = ""
        Dim IMPRIMER As Double = 0


        '----------- MAIN COURANTES ------------------------------
        Dim CODE_MAIN_COURANTE As String = Functions.GeneratingRandomCode("main_courante", "MC")
        Dim CODE_CLIENT As String = GlobalVariable.codeClient
        Dim CODE_CHAMBRE As String = GlobalVariable.codeChambre
        Dim ETAT_CHAMBRE As String = 1
        Dim CODE_AGENCE As String = AGENCE_ID

        '----------- MAIN COURANTE GENERALE ------------------------------

        Dim CODE_MAIN_COURANTE_GENERALE As String = Functions.GeneratingRandomCode("main_courante_generale", "MCG")
        Dim DATE_MAIN_COURANTE As Date = GlobalVariable.DateDeTravail
        Dim PDJ_FOOD As Double = 0
        Dim PDJ_BOISSON As Double = 0
        Dim DEJEUNER_FOOD As Double = 0
        Dim DEJEUNER_BOISSON As Double = 0
        Dim DINER_FOOD As Double = 0
        Dim DINER_BOISSON As Double = 0
        Dim BANQUET_FOOD As Double = 0
        Dim BANQUET_BOISSON As Double = 0
        Dim BAR_MATIN As Double = 0
        Dim BAR_SOIR As Double = 0
        Dim DIVERS As Double = 0
        Dim TOTAL_JOUR As Double = 0
        Dim REPORT_VEILLE As Double = 0
        Dim TOTAL_GENERAL As Double = 0
        Dim NUM_RESERVATION = CODE_RESERVATION
        Dim DEDUCTION As Double = 0
        Dim ENCAISSEMENT_ESPECE As Double = 0
        Dim ENCAISSEMENT_CHEQUE As Double = 0
        Dim ENCAISSEMENT_CARTE_CREDIT As Double = 0
        Dim A_REPORTER As Double = 0
        Dim OBSERVATIONS As String = ""
        Dim TYPE_CHAMBRE As String = GunaTextBoxCodeTypeDeChambre.Text
        Dim INDICE_FREQUENTATION As String = ""
        Dim INDICE_FREQUENTATION_PCT As String = ""
        Dim TAUX_OCCUPATION As String = ""
        Dim TAUX_OCCUPATION_PCT As String = ""
        Dim CLIENTS_ATTENDUS As String = ""
        Dim CLIENTS_EN_CHAMBRE As String = ""
        Dim CHAMBRES_DISPONIBLES As String = ""
        Dim TOTAL_HORS_SERVICE As String = ""
        Dim CHAMBRES_HORS_SERVICE As String = ""
        Dim TOTAL_FICTIVES As String = ""
        Dim CHAMBRES_FICTIVES As String = ""
        Dim NOMBRE_MESSAGES As String = ""
        Dim TOTAL_GRATUITES As String = ""
        Dim CHAMBRES_GRATUITES As String = ""
        Dim TOTAL_NON_FACTUREES As String = ""
        Dim CHAMBRES_NON_FACTUREES As String = ""

        '----------- MAIN COURANTE JOURNALIERE ------------------------------

        Dim CODE_MAIN_COURANTE_JOURNALIERE As String = Functions.GeneratingRandomCode("main_courante_journaliere", "MCJ")
        Dim PDJ As Double = 0
        Dim DEJEUNER As Double = 0
        Dim DINER As Double = 0
        Dim CAFE As Double = 0
        Dim BAR As Double = 0
        Dim CAVE As Double = 0
        Dim AUTRE As Double = 0

        Dim SOUS_TOTAL1 As Double = 0

        If GunaCheckBoxPetitDejeuenerInclus.Checked Then

            Dim petitDejeuner As Double = 0
            Double.TryParse(GunaTextBoxPetitDejeuner.Text, petitDejeuner)
            SOUS_TOTAL1 = petitDejeuner 'On gère les taxes séjours par apport la valeur SOUS_TOTAL1 de la main courante journaliere

        End If

        Dim Location As Double = 0
        Dim TELE As Double = 0
        Dim FAX As Double = 0
        Dim LINGE As Double = 0
        Dim SOUS_TOTAL2 As Double = 0
        Dim DEBITEUR As Double = 0
        Dim ARRHES As Double = 0

        '------------------------------- compte -----------------------------

        Dim INTITULE As String = ""
        Dim NUMERO_COMPTE As String = ""
        Dim TOTAL_DEBIT As Double = GlobalVariable.MONTANT_TOTAL
        Dim TOTAL_CREDIT As Double = GlobalVariable.avance
        Dim SOLDE_COMPTE As Double = TOTAL_CREDIT - TOTAL_DEBIT

        Dim SENS_DU_SOLDE As String = ""

        If (TOTAL_DEBIT < TOTAL_CREDIT) Then
            SENS_DU_SOLDE = "crediteur"
        ElseIf (TOTAL_CREDIT < TOTAL_DEBIT) Then
            SENS_DU_SOLDE = "debiteur"
        Else
            SENS_DU_SOLDE = "equilibre"
        End If

        Dim TYPE_DE_COMPTE As String = "debiteur"

        '--------------------------- FORFAIT SALLE

        Dim nbreCafe As Integer = 0
        Dim cafePu As Double = 0
        Dim dejeunerNbre As Integer = 0
        Dim dejeunerPu As Double = 0
        Dim dinerNbre As Integer = 0
        Dim dinerPu As Double = 0
        Dim traiteurNbre As Integer = 0
        Dim traiteurPu As Double = 0

        Double.TryParse(GunaTextBox35.Text, nbreCafe)
        Double.TryParse(GunaTextBoxForfaitCafe.Text, cafePu)
        Double.TryParse(GunaTextBox30.Text, dejeunerNbre)
        Double.TryParse(GunaTextBoxForfatiDejeuner.Text, dejeunerPu)
        Double.TryParse(GunaTextBox25.Text, dinerNbre)
        Double.TryParse(GunaTextBoxForfaitDiner.Text, dinerPu)
        Double.TryParse(GunaTextBox13.Text, traiteurNbre)
        Double.TryParse(GunaTextBoxForfaitTraiteur.Text, traiteurPu)

        Dim NBRE__CAFE = nbreCafe
        Dim PU_CAFE = cafePu
        Dim NBRE_DEJEUNER = dejeunerNbre
        Dim PU_DEJEUNER = dejeunerPu
        Dim NBRE_DINER = dinerNbre
        Dim PU_DINER = dinerPu
        Dim NBRE_TRAITEUR = traiteurNbre
        Dim PU_TRAITEUR = traiteurNbre
        Dim decorationCast As Double = 0
        Double.TryParse(GunaTextBoxDecoration.Text, decorationCast)
        Dim DECORATION = decorationCast

        '--------------------------------------------------------------------------------------------------

        Dim reservationConf As New Reservation()

        If (GlobalVariable.codeReservationToUpdate = "") Then

            'Direct checkIn as the reservation has not been saved before
            'We check if the code of the reservation already exist in the database
            If Not Functions.entryCodeExists(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION") Then
                If reservationConf.insertReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                    If GlobalVariable.typeChambreOuSalle = "salle" Then

                        reservation.insertForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)

                    End If

                    'We update the checkin button so not to display the checkin button again
                    reservation.updateReservationConfCheckIn(CODE_RESERVATION)

                    'We update the room if everythig is ok


                    '-------------------------- OCCUPATION CHAMBRE--------------------------
                    If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                        If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                        End If

                    End If

                    '----------- MAIN COURANTES ------------------------------

                    'We check if the the main courante already exist
                    If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante", "CODE_MAIN_COURANTE") Then

                        If mainCourante.insertMainCourante(CODE_MAIN_COURANTE, CODE_CLIENT, CODE_RESERVATION, CODE_CHAMBRE, ETAT_CHAMBRE, ETAT_RESERVATION, DATE_ETAT, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                        End If
                    End If

                    '----------- MAIN COURANTE GENERALE ------------------------------

                    'We check if the the main courante generale already exist
                    If Not Functions.entryCodeExists(CODE_MAIN_COURANTE_GENERALE, "main_courante_generale", "CODE_MAIN_COURANTE_GENERALE") Then

                        If mainCourante.insertMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                        End If

                    End If

                    '----------- MAIN COURANTE JOURNALIERE ------------------------------

                    'We check if the the main courante journaliere already exist
                    If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                        If mainCourante.insertMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                        End If

                    End If

                End If
            Else
                ' the generated code already exist

            End If
        Else

            'Checkin from reservation meaning the reseravtion has been saved earlier

            'AVANT DE MIGRER ON DOIT ENREGISTERE D'EVENTUELLE MOODIFICATION

            'As the Global variable codeReservationToUpdate is not empty => update reservation
            ' we determine if the reservation is found in reservation or reserve_conf
            CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
            CHAMBRE_ID = GlobalVariable.codeChambre

            'We have to search where the reservtion to update is found either in reservation or reserve_conf
            Dim reservationTable As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If reservationTable.Rows.Count > 0 Then

                ' The Reseravtion is found in reservation

                If reservation.updateReservation(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                    'So we migrate the  entry from reservation to reserve_conf
                    If reservationConf.insertReservationMigration(CODE_RESERVATION) Then
                        Functions.DeleteElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")
                        'We change the status of the checkin field to yes as it was initialise to 0
                        reservation.updateReservationConfCheckIn(CODE_RESERVATION)
                    End If

                    If Not GlobalVariable.codeReservationToUpdate = "" Then
                        'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", GunaLabelSolde.Text)
                        Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                        reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                    End If

                    If GlobalVariable.typeChambreOuSalle = "salle" Then
                        reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                    End If

                End If

            Else

                'The resevation is instead found in reserve_conf
                'We have to set back the value of etat_reservation from 0 to 1
                ETAT_RESERVATION = 1
                CHAMBRE_ID = GlobalVariable.codeChambre
                'MessageBox.Show(CLIENT_ID & " - " & CHAMBRE_ID)
                'In case the table has migrate from reservation to reservation_conf we update instead in reserve_conf

                If reservation.updateReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE) Then

                    'So we migrate the  entry from reservation to reserve_conf
                    If reservationConf.insertReservationMigration(CODE_RESERVATION) Then
                        Functions.DeleteElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")
                        'We change the status of the checkin field to yes as it was initialise to 0
                        reservation.updateReservationConfCheckIn(CODE_RESERVATION)
                    End If

                    If Not GlobalVariable.codeReservationToUpdate = "" Then
                        'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reserve_conf", GunaLabelSolde.Text)
                        Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                        reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                    End If

                    If GlobalVariable.typeChambreOuSalle = "salle" Then
                        reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                    End If

                End If

            End If

            '-------------------------- OCCUPATION CHAMBRE--------------------------
            If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                End If

            End If

        End If

        '-------------------------- UPDATE ROOM --------------------------------
        Dim updateQuery As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

        Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)

        command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
        command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Occupée sale"
        command.Parameters.Add("@code", MySqlDbType.VarChar).Value = Trim(GunaTextBoxNumeroChambre.Text)
        'Opening the connection
        'connect.openConnection()

        'Excuting the command and testing if everything went on well
        If (command.ExecuteNonQuery() = 1) Then
            'connect.closeConnection()
        End If

        '-------------------------------------------- TAXE SEJOUR COLLECTE ---------------------------------------

        If GunaCheckBoxTaxeSejour.Checked Then

            Functions.DeleteElementByCode(CODE_RESERVATION, "taxe_sejour_collectee", "NUM_RESERVATION")

            'Insertion des lignes dans taxe séjours collectées TAXE_SEJOURS_COLLECTEE
            Dim insertQueryTaxe As String = "INSERT INTO `taxe_sejour_collectee`(`CODE_CATEGORIE_HOTEL`, `CODE_CLIENT`, `NUM_RESERVATION`, `NUM_FACTURE`, `CODE_CHAMBRE`, `TAXE_SEJOUR_COLLECTEE`, `DATE_FACTURATION_TAXE`, `DATE_CREATION`, `CODE_UTILISATEUR_CREA`, `CODE_AGENCE`) VALUES (@valu1,@valu2,@valu3,@valu4,@valu5,@valu6,@valu7,@valu8,@valu9,@valu10)"

            Dim commandTaxe As New MySqlCommand(insertQueryTaxe, GlobalVariable.connect)

            commandTaxe.Parameters.Add("@valu1", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CATEGORIE_HOTEL")
            commandTaxe.Parameters.Add("@valu2", MySqlDbType.VarChar).Value = CLIENT_ID
            commandTaxe.Parameters.Add("@valu3", MySqlDbType.VarChar).Value = CODE_RESERVATION
            commandTaxe.Parameters.Add("@valu4", MySqlDbType.VarChar).Value = ""
            commandTaxe.Parameters.Add("@valu5", MySqlDbType.VarChar).Value = CHAMBRE_ID

            Dim TaxeSejour As Double
            Double.TryParse(GunaTextBoxTaxeSejour.Text, TaxeSejour)
            commandTaxe.Parameters.Add("@valu6", MySqlDbType.Double).Value = TaxeSejour

            commandTaxe.Parameters.Add("@valu7", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
            commandTaxe.Parameters.Add("@valu8", MySqlDbType.Date).Value = GlobalVariable.DateDeTravail
            commandTaxe.Parameters.Add("@valu9", MySqlDbType.VarChar).Value = GlobalVariable.codeUser
            commandTaxe.Parameters.Add("@valu10", MySqlDbType.VarChar).Value = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")

            'Opening the connection
            'connect.openConnection()

            'Excuting the command and testing if everything went on well
            If (commandTaxe.ExecuteNonQuery() = 1) Then
                'connect.closeConnection()
            Else
                'connect.closeConnection()
            End If

        End If

        'GESTION DES ENCAISSEMENTS ICI

        '--------------------------------------- GESTION DE LA MISE A JOURS DU SOLDE DE LA RESERVATION ----------------------------
        Dim reservationToUpdateInReservation As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

        'SOIT DANS RESERVATION

        If reservationToUpdateInReservation.Rows.Count > 0 Then

            'MISE JOURS DU SOLDE DE LA RESERVATION
            Dim updatedSolde As Double = Functions.SituationDeReservation(CODE_RESERVATION)

            reservation.updateSoldeReservation(CODE_RESERVATION, "reservation", updatedSolde)

        Else

            'OU DANS RESERVATION
            Dim reservationToUpdateInReserve_conf As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

            If reservationToUpdateInReserve_conf.Rows.Count > 0 Then

                Dim updatedSolde As Double = Functions.SituationDeReservation(CODE_RESERVATION)

                reservation.updateSoldeReservation(CODE_RESERVATION, "reserve_conf", updatedSolde)

            End If

        End If
        '---------------------------------------EN CODAGE DES CARTE-------------------------------------------
        'Gestion de l'encodage
        MessageBox.Show("Logement de " & NOM_CLIENT & " du " & DATE_ENTTRE & " au " & DATE_SORTIE & " enregistré avec succès!!", "Logement", MessageBoxButtons.OK, MessageBoxIcon.Information)

        '-------------------------------------------- IMPRESSION DES DOCUMENTS -------------------------------------------------

        Dim dialog As DialogResult
        dialog = MessageBox.Show("Télécharger La fiche de police ", "Documents", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        If dialog = DialogResult.No Then
            'e.Cancel = True
        Else

            'Génération des documents concernants les salles Confirmation de réservation
            Dim montantParNuitee As Double = 0

            'DOCUMENT DE LA SALLE DE FETE
            If GunaRadioButtonSalleFete.Checked Then

                If GlobalVariable.codeReservationToUpdate = "" Then

                    'CONFIRMATION DE RESERVATION

                    Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                    'CONTRAT DE POLICE
                    Functions.GenerationDeFicheDePolice(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)

                    'Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GunaDateTimeHeureArrive.Value.ToLongTimeString, GunaDateTimePickerHeureDepart.Value.ToLongTimeString, GlobalVariable.typeChambreOuSalle)

                Else

                    'MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

                'DOCUMENT DE LA CHAMBRE
            ElseIf GunaRadioButtonChambre.Checked Then
                'Génération des documents concernants les chambres confirmation de réservation

                If GlobalVariable.codeReservationToUpdate = "" Then
                    'CONFIRMATION DE RESERVATION
                    Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)

                    'Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GunaDateTimeHeureArrive.Value.ToLongTimeString, GunaDateTimePickerHeureDepart.Value.ToLongTimeString, GlobalVariable.typeChambreOuSalle)


                    'FICHE DE POLICE
                    'Génératiion de la fiche de police pour les chambres
                    Functions.GenerationDeFicheDePolice(CODE_RESERVATION, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)
                Else

                    'MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

            End If

        End If

        '---------------------------------------------------------------------------------------------------------------------

        Dim dialog1 As New DialogResult()

        dialog1 = MessageBox.Show("Client entré en chambre. Encoder une carte?", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        If dialog1 = DialogResult.Yes Then

            GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

            ZenoLockForm.Show()

        End If

        'Desactivation du bouton de gestion des groupes
        GunaCheckBoxReservationDeGroupe.Checked = False

        'RSERVATION NORMALE

        'Clearing all the informations found in the the reseravtion field
        VidageDesChampsPourNouvelleReservation()
        'emtptyRegistrationFields()

        'We set all the global variables used for update to their original values
        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        ReinitialisationDesDates()

        'We prevent from choosing a room if a room type is not first choosen
        'GunaTextBoxNumeroChambre.BaseColor = Color.Beige
        GunaTextBoxNumeroChambre.Enabled = True

        Functions.SiplifiedClearTextBox(Me)

        'On masque les tarifs associés au client si existe 
        GunaComboBoxCodeTarif.Visible = False
        GunaLabelCodeTarif.Visible = False

        GunaLabelNumReservation.Text = ""

        'ReservationList()

        'We update the buttons to display
        reservationButtonToDisplay()

        GunaComboBoxHeureArrivee.selectedItem = "120000"
        GunaComboBoxHeureDepart.selectedItem = "120000"

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaCheckBoxTaxeSejour.Checked = False
        GunaTextBoxPetitDejeuner.Visible = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False

        'Obtention des informations pour les statistiques
        Dim stat As New statistiques()

        stat.ObtenirDerniereStatistique()

        Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

        GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

        Me.Cursor = Cursors.Default

    End Sub

    '--------------------------------------- CHECKOUT MANAGEMENT ----------------------------------------
    Private Sub GunaButtonCheckOut_Click(sender As Object, e As EventArgs) Handles GunaButtonCheckOut.Click

        Me.Cursor = Cursors.WaitCursor

        '---------------SUPPRESSION DU CONTENU DE LA CARTE -------------------

        Dim lStatus As Integer
        Dim Port As Integer
        Dim CardNo As Integer

        Port = CB_Port.SelectedIndex

        If IsNumeric(TB_CardNo.Text) Then
            CardNo = Val(TB_CardNo.Text)
        Else
            CardNo = 0
        End If

        TB_Result.Text = "Executing..."
        TB_Result.Refresh()

        lStatus = EraseKeyCard(Port, CardNo)

        TB_Result.Text = lStatus.ToString("X")

        '---------------------------------------------------------------------

        LabelNatureReservation.Visible = False

        'We change the color of the label depending on if the label the value is negatif or positif

        'On masque les tarifs associés au client si existe 
        GunaComboBoxCodeTarif.Visible = False
        GunaLabelCodeTarif.Visible = False

        GunaLabelNumReservation.Visible = False 'We hide reservation code

        '------------------------------------------ VARIEBLES------------------------------------------------
        Dim TYPE_CHAMBRE_OU_SALLE As String = ""

        If GunaRadioButtonChambre.Checked Then

            TYPE_CHAMBRE_OU_SALLE = "chambre"

        ElseIf GunaRadioButtonSalleFete.Checked Then

            TYPE_CHAMBRE_OU_SALLE = "salle"

        End If

        GlobalVariable.ADULTES = Integer.Parse(GunaTextBoxNbreAdulte.Text)
        GlobalVariable.ENFANTS = Integer.Parse(GunaTextBoxNbreEnfant.Text)

        If GunaRadioButtonMailOui.Checked Then
            GlobalVariable.RECEVOIR_EMAIL = 1
        End If

        If GunaRadioButtonSmsOui.Checked Then
            GlobalVariable.RECEVOIR_SMS = 1
        End If

        Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
        Dim NOM_ENTREPRISE As String = Trim(GunaTextBoxEntrepriseDuclient.Text)

        'Dim CLIENT_ID As String = GlobalVariable.codeClient
        Dim CLIENT_ID As String = Trim(GunaTextBoxRefClient.Text)

        Dim UTILISATEUR_ID As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        'Dim CHAMBRE_ID As String = GlobalVariable.codeChambre
        Dim CHAMBRE_ID As String = Trim(GunaTextBoxNumeroChambre.Text)

        Dim AGENCE_ID As String = GlobalVariable.codeAgence

        Dim NOM_CLIENT As String = Trim(GunaTextBoxNomPrenom.Text)

        '----------------- dates obtained when ever the resting days change
        'Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

        'Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

        '-------------------NEW WAY ------------------

        Dim ArriveeMinutes As String = ""
        Dim ArriveeHeure As String = ""

        Dim departMinutes As String = ""
        Dim departHeure As String = ""

        If NumericUpDownArriveeMin.Value = 0 Then
            ArriveeMinutes = ":00:00"
        ElseIf NumericUpDownArriveeMin.Value < 10 Then
            ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
        Else
            ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
        End If

        If NumericUpDownHeureArrivee.Value >= 10 Then
            ArriveeHeure = NumericUpDownHeureArrivee.Value
        Else
            ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
        End If

        If NumericUpDownDepartMin.Value = 0 Then
            departMinutes = ":00:00"
        ElseIf NumericUpDownDepartMin.Value < 10 Then
            departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
        Else
            departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
        End If

        If NumericUpDownDepartHeure.Value >= 10 Then
            departHeure = NumericUpDownDepartHeure.Value
        Else
            departHeure = "0" & NumericUpDownDepartHeure.Value
        End If

        Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

        Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

        '-------------------------------------
        Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
        Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

        'Dim DATE_ENTTRE As Date = GlobalVariable.DATE_ENTTRE
        Dim DATE_ENTTRE As Date = GunaDateTimePickerArrivee.Value.ToShortDateString
        Dim HEURE_ENTREE As String = DateTimeArrivee
        'Dim DATE_SORTIE As Date = GlobalVariable.DATE_SORTIE
        Dim DATE_SORTIE As Date = GunaDateTimePickerDepart.Value.ToShortDateString
        Dim HEURE_SORTIE As String = DateTimeDepart

        'Dim ADULTES As Integer = GlobalVariable.ADULTES
        Dim ADULTES As Integer = Integer.Parse(GunaTextBoxNbreAdulte.Text)
        Dim ENFANTS As Integer = Integer.Parse(GunaTextBoxNbreEnfant.Text)
        Dim NB_PERSONNES As Integer = ENFANTS + ADULTES
        Dim RECEVOIR_EMAIL As Integer = GlobalVariable.RECEVOIR_EMAIL
        Dim RECEVOIR_SMS As Integer = GlobalVariable.RECEVOIR_SMS
        Dim ETAT_RESERVATION As Integer = 0
        Dim DATE_CREATION As Date = GlobalVariable.DateDeTravail
        Dim HEURE_CREATION As DateTime = DateTime.Now().ToString("hh:mm:ss")
        Dim MONTANT_TOTAL_CAUTION As Double = GlobalVariable.MONTANT_TOTAL_CAUTION
        Dim MOTIF_ETAT As String = ""
        Dim DATE_ETAT As Date = GlobalVariable.DateDeTravail
        Dim MONTANT_ACCORDE As Double = GlobalVariable.MONTANT_ACCORDE
        Dim GROUPE As String = GunaTextBoxCodeDeGroupe.Text
        'Dim CODE_RESERVATION = Functions.GeneratingRandomCode("reservation", "REA")
        Dim CODE_RESERVATION As String = Trim(GunaLabelNumReservation.Text)

        Dim reservation As New Reservation()
        Dim mainCourante As New MainCourantes()
        Dim reglement As New Reglement()
        Dim occupationChambre As New OccupationChambre()
        Dim facture As New Facture()
        Dim ligneFacture As New LigneFacture()
        Dim compte As New Compte()

        'Inserting a new reservation after checking that the reservation does not already exist

        ' variables declarations 

        '-------------------------------- OCCUPATION CHAMBRE ------------------------------

        Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCode("occupation_chambre", "OC")
        Dim MONTANT_HT As Double = 0
        Dim TAXE As Double = 0
        Dim MONTANT_TTC As Double = 0
        Dim DATE_OCCUPATION As Date = GlobalVariable.DateDeTravail
        'Dim OBSERVATIONS As String =""
        Dim COMMENTAIRE1 As String = ""
        Dim COMMENTAIRE2 As String = ""
        Dim COMMENTAIRE3 As String = ""
        Dim COMMENTAIRE4 As String = ""
        Dim DATE_LIBERATION As Date = GlobalVariable.DateDeTravail
        Dim CODE_UTILISATEUR_CREA As String = ""
        Dim DATE_PREMIERE_ARRIVEE As Date = GlobalVariable.DateDeTravail
        Dim TYPE_RESERVATION As String = ""
        Dim PDJ_INCLUS As String = ""
        Dim TAXE_SEJOURS_INCLUS As String = ""
        Dim TVA_INCLUS As String = ""
        Dim CODE_CLIENT_REEL As String = ""

        '------------------------------- REGLEMENT ----------------------------------------------

        Dim NUM_REGLEMENT As String = Functions.GeneratingRandomCode("reglement", "RGL")
        Dim NUM_FACTURE As String = ""
        Dim CODE_CAISSIER As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim MONTANT_VERSE As Double = 0
        Dim DATE_REGLEMENT As Date = GlobalVariable.DateDeTravail
        Dim MODE_REGLEMENT As String = ""
        Dim REF_REGLEMENT As String = ""
        Dim CODE_MODE As String = ""
        Dim IMPRIMER As Double = 0

        '----------- MAIN COURANTES ------------------------------
        Dim CODE_MAIN_COURANTE As String = Functions.GeneratingRandomCode("main_courante", "MC")
        Dim CODE_CLIENT As String = GlobalVariable.codeClient
        Dim CODE_CHAMBRE As String = GlobalVariable.codeChambre
        Dim ETAT_CHAMBRE As String = 0
        Dim CODE_AGENCE As String = AGENCE_ID

        '----------- MAIN COURANTE GENERALE ------------------------------

        Dim CODE_MAIN_COURANTE_GENERALE As String = Functions.GeneratingRandomCode("main_courante_generale", "MCG")
        Dim DATE_MAIN_COURANTE As Date = GlobalVariable.DateDeTravail
        Dim PDJ_FOOD As Double = 0
        Dim PDJ_BOISSON As Double = 0
        Dim DEJEUNER_FOOD As Double = 0
        Dim DEJEUNER_BOISSON As Double = 0
        Dim DINER_FOOD As Double = 0
        Dim DINER_BOISSON As Double = 0
        Dim BANQUET_FOOD As Double = 0
        Dim BANQUET_BOISSON As Double = 0
        Dim BAR_MATIN As Double = 0
        Dim BAR_SOIR As Double = 0
        Dim DIVERS As Double = 0
        Dim TOTAL_JOUR As Double = 0
        Dim REPORT_VEILLE As Double = 0
        Dim TOTAL_GENERAL As Double = 0
        Dim NUM_RESERVATION = CODE_RESERVATION
        Dim DEDUCTION As Double = 0
        Dim ENCAISSEMENT_ESPECE As Double = 0
        Dim ENCAISSEMENT_CHEQUE As Double = 0
        Dim ENCAISSEMENT_CARTE_CREDIT As Double = 0
        Dim A_REPORTER As Double = 0
        Dim OBSERVATIONS As String = ""
        Dim TYPE_CHAMBRE As String = ""
        Dim INDICE_FREQUENTATION As String = ""
        Dim INDICE_FREQUENTATION_PCT As String = ""
        Dim TAUX_OCCUPATION As String = ""
        Dim TAUX_OCCUPATION_PCT As String = ""
        Dim CLIENTS_ATTENDUS As String = ""
        Dim CLIENTS_EN_CHAMBRE As String = ""
        Dim CHAMBRES_DISPONIBLES As String = ""
        Dim TOTAL_HORS_SERVICE As String = ""
        Dim CHAMBRES_HORS_SERVICE As String = ""
        Dim TOTAL_FICTIVES As String = ""
        Dim CHAMBRES_FICTIVES As String = ""
        Dim NOMBRE_MESSAGES As String = ""
        Dim TOTAL_GRATUITES As String = ""
        Dim CHAMBRES_GRATUITES As String = ""
        Dim TOTAL_NON_FACTUREES As String = ""
        Dim CHAMBRES_NON_FACTUREES As String = ""

        '--------------------------- FORFAIT SALLE
        Dim nbreCafe As Integer = 0
        Dim cafePu As Double = 0
        Dim dejeunerNbre As Integer = 0
        Dim dejeunerPu As Double = 0
        Dim dinerNbre As Integer = 0
        Dim dinerPu As Double = 0
        Dim traiteurNbre As Integer = 0
        Dim traiteurPu As Double = 0

        Double.TryParse(GunaTextBox35.Text, nbreCafe)
        Double.TryParse(GunaTextBoxForfaitCafe.Text, cafePu)
        Double.TryParse(GunaTextBox30.Text, dejeunerNbre)
        Double.TryParse(GunaTextBoxForfatiDejeuner.Text, dejeunerPu)
        Double.TryParse(GunaTextBox25.Text, dinerNbre)
        Double.TryParse(GunaTextBoxForfaitDiner.Text, dinerPu)
        Double.TryParse(GunaTextBox13.Text, traiteurNbre)
        Double.TryParse(GunaTextBoxForfaitTraiteur.Text, traiteurPu)

        Dim NBRE__CAFE = nbreCafe
        Dim PU_CAFE = cafePu
        Dim NBRE_DEJEUNER = dejeunerNbre
        Dim PU_DEJEUNER = dejeunerPu
        Dim NBRE_DINER = dinerNbre
        Dim PU_DINER = dinerPu
        Dim NBRE_TRAITEUR = traiteurNbre
        Dim PU_TRAITEUR = traiteurNbre
        Dim decorationCast As Double = 0
        Double.TryParse(GunaTextBoxDecoration.Text, decorationCast)
        Dim DECORATION = decorationCast

        '----------- MAIN COURANTE JOURNALIERE ------------------------------

        Dim CODE_MAIN_COURANTE_JOURNALIERE As String = Functions.GeneratingRandomCode("main_courante_journaliere", "MCJ")
        Dim PDJ As Double = 0
        Dim DEJEUNER As Double = 0
        Dim DINER As Double = 0
        Dim CAFE As Double = 0
        Dim BAR As Double = 0
        Dim CAVE As Double = 0
        Dim AUTRE As Double = 0
        Dim SOUS_TOTAL1 As Double = 0
        Dim Location As Double = 0
        Dim TELE As Double = 0
        Dim FAX As Double = 0
        Dim LINGE As Double = 0
        Dim SOUS_TOTAL2 As Double = 0
        Dim DEBITEUR As Double = 0
        Dim ARRHES As Double = 0


        If GunaCheckBoxPetitDejeuenerInclus.Checked Then

            Dim petitDejeuner As Double = 0
            Double.TryParse(GunaTextBoxPetitDejeuner.Text, petitDejeuner)
            SOUS_TOTAL1 = petitDejeuner 'On gère les petit dejeuener inclus par apport a la valeur SOUS_TOTAL1 de la main courante journaliere

        End If

        '------------------------------- compte -----------------------------

        Dim INTITULE As String = ""
        Dim NUMERO_COMPTE As String = ""
        Dim TOTAL_DEBIT As Double = GlobalVariable.MONTANT_TOTAL
        Dim TOTAL_CREDIT As Double = GlobalVariable.avance
        Dim SOLDE_COMPTE As Double = TOTAL_CREDIT - TOTAL_DEBIT

        Dim SENS_DU_SOLDE As String = ""

        If (TOTAL_DEBIT < TOTAL_CREDIT) Then
            SENS_DU_SOLDE = "crediteur"
        ElseIf (TOTAL_CREDIT < TOTAL_DEBIT) Then
            SENS_DU_SOLDE = "debiteur"
        End If

        Dim TYPE_DE_COMPTE As String = "debiteur"

        Dim reservationConf As New Reservation()


        '-------------------------GESTION DE LIBERATION DES CHAMBRES POUR LES METTRES DANS DES CHAMBRES FICTIVE----------

        ' Dim Solde As Double = Functions.SituationDuClient(GlobalVariable.codeClientToUpdate)
        Dim Solde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)

        Dim dialogCheckOut As DialogResult

        If 0 > Solde Then

            'Si nous avons un solde negatif

            dialogCheckOut = MessageBox.Show("Votre Solde est négatif voulez-vous continuer?", "Check out", MessageBoxButtons.YesNo, MessageBoxIcon.Warning)

            If dialogCheckOut = DialogResult.Yes Then

                If Not (GlobalVariable.codeReservationToUpdate = "") Then

                    'Libération de la chambre en utilisant une chambre fictive
                    'BASCULEMENT DE LA CHAMBRE DANS UNE CHAMBRE FICTIVE

                    'Checkout meaning the reseravtion has been saved earlier
                    CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                    CHAMBRE_ID = GlobalVariable.codeChambreToUpdate
                    ETAT_RESERVATION = 2

                    'CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE, TYPE_CHAMBRE_OU_SALLE, PETIT_DEJEUNER_ROUTAGE, CHAMBRE_ROUTAGE, VENANT_DE, SE_RENDANT_A, RAISON, SOURCE_RESERVATION, ROUTAGE, ETAT_NOTE_RESERVATION, CODE_ENTREPRISE, NOM_ENTREPRISE

                    If reservationConf.updateReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE) Then

                        If Not GlobalVariable.codeReservationToUpdate = "" Then
                            'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reserve_conf", GunaLabelSolde.Text)
                            Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                            reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                        End If

                        If GlobalVariable.typeChambreOuSalle = "salle" Then
                            reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                        End If

                        'We update the checkin button so no to display the checkin button again
                        reservation.updateReservationConfCheckIn(CODE_RESERVATION)

                        'We update the room if everythig is ok

                        'MIGRATION DE LA RESERVATION EN TANT QUE NO SHOW



                        'On copie de reserve_conf vers la table reserve_temp
                        Dim noShowCheckOut As String = "INSERT INTO `reserve_temp`(`CODE_RESERVATION`, `CLIENT_ID`, `UTILISATEUR_ID`, `CHAMBRE_ID`, `AGENCE_ID`, `NOM_CLIENT`, `DATE_ENTTRE`, `HEURE_ENTREE`, `DATE_SORTIE`, `HEURE_SORTIE`, `ADULTES`, `NB_PERSONNES`, `ENFANTS`, `RECEVOIR_EMAIL`, `RECEVOIR_SMS`, `ETAT_RESERVATION`, `DATE_CREATION`, `HEURE_CREATION`, `MONTANT_TOTAL_CAUTION`, `MOTIF_ETAT`, `DATE_ETAT`, `MONTANT_ACCORDE`, `GROUPE`, `CHECKIN`, `TYPE`, `PETIT_DEJEUNER`, `SOLDE_RESERVATION`) SELECT `CODE_RESERVATION`, `CLIENT_ID`, `UTILISATEUR_ID`, `CHAMBRE_ID`, `AGENCE_ID`, `NOM_CLIENT`, `DATE_ENTTRE`, `HEURE_ENTREE`, `DATE_SORTIE`, `HEURE_SORTIE`, `ADULTES`, `NB_PERSONNES`, `ENFANTS`, `RECEVOIR_EMAIL`, `RECEVOIR_SMS`, `ETAT_RESERVATION`, `DATE_CREATION`, `HEURE_CREATION`, `MONTANT_TOTAL_CAUTION`, `MOTIF_ETAT`, `DATE_ETAT`, `MONTANT_ACCORDE`, `GROUPE`, `CHECKIN`, `TYPE`, `PETIT_DEJEUNER`, `SOLDE_RESERVATION` FROM reserve_conf WHERE CODE_RESERVATION = @CODE_RESERVATION"

                        Dim commandNoShowCheckOut As New MySqlCommand(noShowCheckOut, GlobalVariable.connect)

                        commandNoShowCheckOut.Parameters.Add("@CODE_RESERVATION", MySqlDbType.VarChar).Value = GlobalVariable.codeReservationToUpdate

                        'Opening the connection
                        'connect.openConnection()

                        'Excuting the command and testing if everything went on well
                        If (commandNoShowCheckOut.ExecuteNonQuery() = 1) Then
                            'MessageBox.Show("GunaCheckBoxDepartDuJour")
                        Else
                            'MessageBox.Show("OUps 1")
                        End If

                        '--------------------------  COMPTE --------------------------

                        CODE_CLIENT = GlobalVariable.codeClientToUpdate
                        NUMERO_COMPTE = GlobalVariable.codeCompteToUpdate

                        If compte.updateCompte(INTITULE, NUMERO_COMPTE, CODE_CLIENT, TOTAL_DEBIT, TOTAL_CREDIT, SOLDE_COMPTE, DATE_CREATION, TYPE_DE_COMPTE, SENS_DU_SOLDE) Then
                        End If

                        '-------------------------- REGLEMENT --------------------------
                        If (Not Functions.entryCodeExists(NUM_REGLEMENT, "reglement", "NUM_REGLEMENT")) And (Not GlobalVariable.avance = 0) Then

                            NUM_REGLEMENT = GlobalVariable.codeFactureToUpdate
                            REF_REGLEMENT = GlobalVariable.codeReglementToUpdate
                            CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                            CODE_CLIENT = GlobalVariable.codeClientToUpdate

                            If reglement.updateReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT) Then

                            End If

                        End If

                        '-------------------------- OCCUPATION CHAMBRE--------------------------
                        If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                            CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                            CODE_CHAMBRE = GlobalVariable.codeChambreToUpdate
                            CODE_CLIENT_REEL = GlobalVariable.codeClientToUpdate

                            If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                            End If

                        End If


                        '----------- MAIN COURANTES ------------------------------

                        'We check if the the main courante already exist
                        If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante", "CODE_MAIN_COURANTE") Then

                            If mainCourante.insertMainCourante(CODE_MAIN_COURANTE, CODE_CLIENT, CODE_RESERVATION, CODE_CHAMBRE, ETAT_CHAMBRE, ETAT_RESERVATION, DATE_ETAT, CODE_AGENCE) Then

                            End If
                        End If

                        '----------- MAIN COURANTE GENERALE ------------------------------

                        'We check if the the main courante generale already exist
                        If Not Functions.entryCodeExists(CODE_MAIN_COURANTE_GENERALE, "main_courante_generale", "CODE_MAIN_COURANTE_GENERALE") Then

                            If mainCourante.updateMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                            End If

                        End If

                        '----------- MAIN COURANTE JOURNALIERE ------------------------------

                        'We check if the the main courante journaliere already exist
                        If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                            If mainCourante.updateMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                            End If

                        End If

                    End If

                End If

                '-------------------------- UPDATE ROOM --------------------------------
                Dim updateQuery As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code "

                Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)

                command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                command.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
                command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre sale"

                'Opening the connection
                'connect.openConnection()

                'Excuting the command and testing if everything went on well
                If (command.ExecuteNonQuery() = 1) Then
                    'connect.closeConnection()
                End If

                'Gestion du désencodage

                GunaLabelSolde.ForeColor = Color.Black

                Dim ZenoLockForm As New ZenoLockForm()

                Dim dialog As New DialogResult()

                dialog = MessageBox.Show("Client Sortie de chambre. Désencoder la carte?", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

                If dialog = DialogResult.Yes Then

                    GlobalVariable.infoReservationPourEncodage = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                    ZenoLockForm.Show()

                End If

                'We empty the fields
                emtptyRegistrationFields()

                'ReservationList()

                'We update the buttons to display
                reservationButtonToDisplay()

                Me.Cursor = Cursors.Default

                'we set all the global variables used for updates using code
                Functions.EmtyGlobalVariablesContainingCodeToUpdate()
                ReinitialisationDesDates()

                'We prevent from choosing a room if a room type is not first choosen
                'GunaTextBoxNumeroChambre.BaseColor = Color.Beige
                GunaTextBoxNumeroChambre.Enabled = True

                GunaLabelSolde.ForeColor = Color.Black
                GunaLabelSolde.Text = 0

                GunaCheckBoxPetitDejeuenerInclus.Checked = False
                GunaCheckBoxTaxeSejour.Checked = False
                GunaTextBoxPetitDejeuner.Visible = False
                GunaTextBoxPetitDejeunerRoutage.Visible = False

            End If

        Else

            '------------------------ NORNAL CHECKOUT CAR SOLDE SUPEIEUR A ZERO -----------------------------

            If Not (GlobalVariable.codeReservationToUpdate = "") Then

                'Checkout meaning the reseravtion has been saved earlier
                CODE_RESERVATION = GlobalVariable.codeReservationToUpdate

                If reservationConf.updateReservationConf(CODE_RESERVATION, CLIENT_ID, UTILISATEUR_ID, CHAMBRE_ID, AGENCE_ID, NOM_CLIENT, DATE_ENTTRE, HEURE_ENTREE, DATE_SORTIE, HEURE_SORTIE, ADULTES, NB_PERSONNES, ENFANTS, RECEVOIR_EMAIL, RECEVOIR_SMS, ETAT_RESERVATION, DATE_CREATION, HEURE_CREATION, MONTANT_TOTAL_CAUTION, MOTIF_ETAT, DATE_ETAT, MONTANT_ACCORDE, GROUPE) Then


                    If Not GlobalVariable.codeReservationToUpdate = "" Then
                        'reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", GunaLabelSolde.Text)
                        Dim updatedSolde As Double = Functions.SituationDeReservation(GlobalVariable.codeReservationToUpdate)
                        reservation.updateSoldeReservation(GlobalVariable.codeReservationToUpdate, "reservation", updatedSolde)
                    End If

                    If GlobalVariable.typeChambreOuSalle = "salle" Then
                        reservation.updateForfait(CODE_RESERVATION, NBRE__CAFE, PU_CAFE, NBRE_DEJEUNER, PU_DEJEUNER, NBRE_DINER, PU_DINER, NBRE_TRAITEUR, PU_TRAITEUR, DECORATION)
                    End If

                    'We update the checkin button so no to display the checkin button again
                    reservation.updateReservationConfCheckIn(CODE_RESERVATION)

                    'We update the room if everythig is ok

                    '--------------------------  COMPTE --------------------------

                    CODE_CLIENT = GlobalVariable.codeClientToUpdate
                    NUMERO_COMPTE = GlobalVariable.codeCompteToUpdate

                    If compte.updateCompte(INTITULE, NUMERO_COMPTE, CODE_CLIENT, TOTAL_DEBIT, TOTAL_CREDIT, SOLDE_COMPTE, DATE_CREATION, TYPE_DE_COMPTE, SENS_DU_SOLDE) Then
                    End If

                    '-------------------------- REGLEMENT --------------------------
                    If (Not Functions.entryCodeExists(NUM_REGLEMENT, "reglement", "NUM_REGLEMENT")) And (Not GlobalVariable.avance = 0) Then

                        NUM_REGLEMENT = GlobalVariable.codeFactureToUpdate
                        REF_REGLEMENT = GlobalVariable.codeReglementToUpdate
                        CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                        CODE_CLIENT = GlobalVariable.codeClientToUpdate

                        If reglement.updateReglement(NUM_REGLEMENT, NUM_FACTURE, CODE_CAISSIER, MONTANT_VERSE, DATE_REGLEMENT, MODE_REGLEMENT, REF_REGLEMENT, CODE_MODE, IMPRIMER, CODE_AGENCE, CODE_RESERVATION, CODE_CLIENT) Then

                        End If

                    End If

                    '-------------------------- OCCUPATION CHAMBRE--------------------------
                    If Not Functions.entryCodeExists(CODE_OCCUPATION_CHAMBRE, "occupation_chambre", "CODE_OCCUPATION_CHAMBRE") Then

                        CODE_RESERVATION = GlobalVariable.codeReservationToUpdate
                        CODE_CHAMBRE = GlobalVariable.codeChambreToUpdate
                        CODE_CLIENT_REEL = GlobalVariable.codeClientToUpdate

                        If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

                        End If

                    End If


                    '----------- MAIN COURANTES ------------------------------

                    'We check if the the main courante already exist
                    If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante", "CODE_MAIN_COURANTE") Then

                        If mainCourante.insertMainCourante(CODE_MAIN_COURANTE, CODE_CLIENT, CODE_RESERVATION, CODE_CHAMBRE, ETAT_CHAMBRE, ETAT_RESERVATION, DATE_ETAT, CODE_AGENCE) Then

                        End If
                    End If

                    '----------- MAIN COURANTE GENERALE ------------------------------

                    'We check if the the main courante generale already exist
                    If Not Functions.entryCodeExists(CODE_MAIN_COURANTE_GENERALE, "main_courante_generale", "CODE_MAIN_COURANTE_GENERALE") Then

                        If mainCourante.updateMainCouranteGenerale(CODE_MAIN_COURANTE_GENERALE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ_FOOD, PDJ_BOISSON, DEJEUNER_FOOD, DEJEUNER_BOISSON, DINER_FOOD, DINER_BOISSON, BANQUET_FOOD, BANQUET_BOISSON, BAR_MATIN, BAR_SOIR, DIVERS, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                        End If

                    End If

                    '----------- MAIN COURANTE JOURNALIERE ------------------------------

                    'We check if the the main courante journaliere already exist
                    If Not Functions.entryCodeExists(CODE_MAIN_COURANTE, "main_courante_journaliere", "CODE_MAIN_COURANTE_JOURNALIERE") Then

                        If mainCourante.updateMainCouranteJournaliere(CODE_MAIN_COURANTE_JOURNALIERE, DATE_MAIN_COURANTE, CODE_CHAMBRE, MONTANT_ACCORDE, ETAT_CHAMBRE, NOM_CLIENT, PDJ, DEJEUNER, DINER, CAFE, BAR, CAVE, AUTRE, SOUS_TOTAL1, Location, TELE, FAX, LINGE, DIVERS, SOUS_TOTAL2, TOTAL_JOUR, REPORT_VEILLE, TOTAL_GENERAL, NUM_RESERVATION, DEDUCTION, ENCAISSEMENT_ESPECE, ENCAISSEMENT_CHEQUE, ENCAISSEMENT_CARTE_CREDIT, DEBITEUR, ARRHES, A_REPORTER, OBSERVATIONS, TYPE_CHAMBRE, CODE_CLIENT, INDICE_FREQUENTATION, INDICE_FREQUENTATION_PCT, TAUX_OCCUPATION, TAUX_OCCUPATION_PCT, CLIENTS_ATTENDUS, CLIENTS_EN_CHAMBRE, CHAMBRES_DISPONIBLES, TOTAL_HORS_SERVICE, CHAMBRES_HORS_SERVICE, TOTAL_FICTIVES, CHAMBRES_FICTIVES, NOMBRE_MESSAGES, TOTAL_GRATUITES, CHAMBRES_GRATUITES, TOTAL_NON_FACTUREES, CHAMBRES_NON_FACTUREES, CODE_AGENCE, TYPE_CHAMBRE_OU_SALLE) Then

                        End If

                    End If

                End If

            End If

            '-------------------------- UPDATE ROOM --------------------------------
            Dim updateQuery As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code "

            Dim command As New MySqlCommand(updateQuery, GlobalVariable.connect)

            command.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
            command.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
            command.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre sale"

            'Opening the connection
            'connect.openConnection()

            'Excuting the command and testing if everything went on well
            If (command.ExecuteNonQuery() = 1) Then
                'connect.closeConnection()
            End If

            'Gestion du désencodage

            GunaLabelSolde.ForeColor = Color.Black

            Dim ZenoLockForm As New ZenoLockForm()

            Dim dialog As New DialogResult()

            'dialog = MessageBox.Show("Client Sortie de chambre. Désencoder la carte?", "Encodage de carte", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            'If dialog = DialogResult.Yes Then

            'ZenoLockForm.Show()

            'End If

            'We empty the fields
            emtptyRegistrationFields()

            'ReservationList()

            'We update the buttons to display
            reservationButtonToDisplay()

            Me.Cursor = Cursors.Default

            'we set all the global variables used for updates using code
            Functions.EmtyGlobalVariablesContainingCodeToUpdate()
            ReinitialisationDesDates()

            'We prevent from choosing a room if a room type is not first choosen
            'GunaTextBoxNumeroChambre.BaseColor = Color.Beige
            GunaTextBoxNumeroChambre.Enabled = True

            GunaLabelSolde.ForeColor = Color.Black
            GunaLabelSolde.Text = 0

            GunaCheckBoxPetitDejeuenerInclus.Checked = False
            GunaCheckBoxTaxeSejour.Checked = False
            GunaTextBoxPetitDejeuner.Visible = False
            GunaTextBoxPetitDejeunerRoutage.Visible = False
        End If

        reservationButtonToDisplay()

        'Obtention des informations pour les statistiques
        Dim stat As New statistiques()

        stat.ObtenirDerniereStatistique()

        Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

        GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")


    End Sub

    '--------------------------------------------------- TABS GESTION DES ATTENDUS - EN CHAMBRES - DEPARTS --------------------------------------
    '-----------------------------------------------------------------------TABS MANAGEMENT ---------------------------------------------------------------
    '--------------------------------------- GRSTION DES RESERVATIONS --------------------------------------------------------
    Public Sub ReservationList(ByVal searchField As String, ByVal searchValue As String, Optional ByVal DateSearch As String = "")

        Dim query As String = ""
        Dim query1 As String = ""
        Dim table As New DataTable()

        If searchField = "all" Then

            query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE  TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

            Dim adapter As New MySqlDataAdapter(command)

            adapter.Fill(table)

            query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE  TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

            Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
            command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

            Dim adapter1 As New MySqlDataAdapter(command1)
            Dim table1 As New DataTable()
            adapter1.Fill(table1)

            table.Merge(table1)

        ElseIf Not Trim(DateSearch).Equals("") Then

            If Trim(DateSearch).Equals("arrivee") Then

            ElseIf Trim(DateSearch).Equals("depart") Then

            End If

        Else

            query = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE  TYPE=@TYPE AND " & searchField & "=@searchField ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            command.Parameters.Add("@searchField", MySqlDbType.VarChar).Value = searchValue

            Dim adapter As New MySqlDataAdapter(command)

            adapter.Fill(table)

            query1 = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE  TYPE=@TYPE AND " & searchField & "=@searchField ORDER BY ID_RESERVATION DESC"

            Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
            command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            command1.Parameters.Add("@searchField", MySqlDbType.VarChar).Value = searchValue

            Dim adapter1 As New MySqlDataAdapter(command1)
            Dim table1 As New DataTable()
            adapter1.Fill(table1)

            table.Merge(table1)

        End If

        If (table.Rows.Count > 0) Then

            GunaDataGridViewReservationList.DataSource = table

            GunaDataGridViewReservationList.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            GunaDataGridViewReservationList.DefaultCellStyle.SelectionForeColor = Color.White
            GunaDataGridViewReservationList.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewReservationList.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

            For i = 0 To GunaDataGridViewReservationList.Rows.Count - 1

                If GunaDataGridViewReservationList.Rows(i).Cells("SOLDE").Value < 0 Then
                    GunaDataGridViewReservationList.Rows(i).DefaultCellStyle.BackColor = Color.LightPink
                    'GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.BackColor = Color.LightPink
                    ' GunaDataGridViewReservationList.Columns("SOLDE").DefaultCellStyle.BackColor = Color.White
                    GunaDataGridViewReservationList.Rows(i).DefaultCellStyle.ForeColor = Color.White
                End If

            Next

        Else

            GunaDataGridViewReservationList.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub




    ''--------------------------- START ATTENDUS TAB ---------------------------------

    'we empty the datagrid whe tab when activated

    Private Sub TabControl1_Selected(sender As Object, e As TabControlEventArgs) Handles TabControlHbergement.Selected

        DataGridViewAttenduPanel.Columns.Clear()

        DataGridViewEnChambre.Columns.Clear()

        DataGridViewDepartTab.Columns.Clear()

    End Sub

    Public Sub ListeDesAttendues()

        Dim DateDebut As Date = GunaDateTimePickerDebut.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GunaDateTimePickerFin.Value.ToString("yyyy-MM-dd")

        If (GunaDateTimePickerDebut.Value <= GunaDateTimePickerFin.Value) Then

            'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                DataGridViewAttenduPanel.DataSource = table

                DataGridViewAttenduPanel.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                DataGridViewAttenduPanel.DefaultCellStyle.SelectionForeColor = Color.White
                DataGridViewAttenduPanel.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                DataGridViewAttenduPanel.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                DataGridViewAttenduPanel.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                DataGridViewAttenduPanel.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

                For i = 0 To DataGridViewAttenduPanel.Rows.Count - 1

                    If DataGridViewAttenduPanel.Rows(i).Cells("SOLDE").Value < 0 Then
                        DataGridViewAttenduPanel.Rows(i).DefaultCellStyle.BackColor = Color.Red
                        DataGridViewAttenduPanel.Rows(i).DefaultCellStyle.ForeColor = Color.White
                    End If

                Next

            Else

                DataGridViewAttenduPanel.Columns.Clear()

            End If

            'connect.closeConnection()
        Else

            DataGridViewAttenduPanel.Columns.Clear()

        End If


    End Sub

    Public Sub ListeDesAttenduesRapportDST(ByVal DateEntree As Date)

        Dim DateDebut As Date = DateEntree.ToString("yyyy-MM-dd")
        Dim DateFin As Date = DateEntree.ToString("yyyy-MM-dd")

        If (GunaDateTimePickerDebut.Value <= GunaDateTimePickerFin.Value) Then

            'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
            Dim query As String = "SELECT reservation.NOM_CLIENT As 'NOM CLIENT',CNI As 'CNI/NIU', DATE_ENTTRE As 'DATE ARRIVEE', DATE_SORTIE As 'DATE SORTIE', VENANT_DE AS 'VENANT DE', SE_RENDANT_A As 'SE RENDANT A' FROM reservation INNER JOIN client WHERE reservation.CLIENT_ID=client.CODE_CLIENT AND DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
            'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewRapportDST.DataSource = table

                GunaButtonImpressionPourDST.Visible = True

            Else

                GunaDataGridViewRapportDST.Columns.Clear()

                GunaButtonImpressionPourDST.Visible = False

            End If

            'connect.closeConnection()
        Else

            GunaDataGridViewRapportDST.Columns.Clear()

        End If


    End Sub
    'Reservation to display at the espected Tab 
    Private Sub GunaButtonAfficher_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherArrivee.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewAttenduPanel.Columns.Clear()

        ListeDesAttendues()

    End Sub


    ''--------------------------- START EN CHAMBRE TAB ---------------------------------

    '---------------------------------------- LIVE SEARCH -------------------------------------

    Public Sub ListeDesEnChambres()

        'On affiche toutes les reserv_conf dont la date saisie est entre la d'entrée et la date de sortie (inclusif)

        Dim DateDebut As Date = GunaDateTimePickerDebutEnChambre.Value.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            DataGridViewEnChambre.DataSource = table

            DataGridViewEnChambre.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            DataGridViewEnChambre.DefaultCellStyle.SelectionForeColor = Color.White
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            DataGridViewEnChambre.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            DataGridViewEnChambre.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            DataGridViewEnChambre.Columns("NOM CLIENT").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter


            For i = 0 To DataGridViewEnChambre.Rows.Count - 1

                If DataGridViewEnChambre.Rows(i).Cells("SOLDE").Value < 0 Then
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.BackColor = Color.LightPink
                    DataGridViewEnChambre.Rows(i).DefaultCellStyle.ForeColor = Color.Black
                End If

            Next

        Else

            DataGridViewEnChambre.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub

    'When we select a date an press the print button
    Private Sub GunaButtonEnChambre_Click(sender As Object, e As EventArgs) Handles GunaButtonEnChambreAfficher.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewEnChambre.Columns.Clear()

        ListeDesEnChambres()

    End Sub

    ''--------------------------- END EN CHAMBRE TAB ---------------------------------


    '-------------------------------------- START DEPART PANEL -------------------------------
    Public Sub ListeDesDeparts()

        Dim DateDebut As Date = GunaDateTimePickerArriveeDepart.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")

        If (GunaDateTimePickerArriveeDepart.Value <= GunaDateTimePickerDepartDepert.Value) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                DataGridViewDepartTab.DataSource = table

                DataGridViewDepartTab.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                DataGridViewDepartTab.DefaultCellStyle.SelectionForeColor = Color.White
                DataGridViewDepartTab.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                DataGridViewDepartTab.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                DataGridViewDepartTab.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                DataGridViewDepartTab.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight

                For i = 0 To DataGridViewDepartTab.Rows.Count - 1

                    If DataGridViewDepartTab.Rows(i).Cells("SOLDE").Value < 0 Then
                        DataGridViewDepartTab.Rows(i).DefaultCellStyle.BackColor = Color.Red
                        DataGridViewDepartTab.Rows(i).DefaultCellStyle.ForeColor = Color.White
                    End If

                Next

            Else

                DataGridViewDepartTab.Columns.Clear()

            End If

            'connect.closeConnection()
        End If

    End Sub

    'outputting the elements of the departure tab at the font office depending on two dates and departure date
    Private Sub GunaButtonAfficherDepart_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherDepart.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        DataGridViewDepartTab.Columns.Clear()

        ListeDesDeparts()

    End Sub

    '-------------------------------------- END DEPART PANEL -------------------------------

    '---------------------------------------------------FACTURATION MANAGEMENT

    'Facturation form management
    Private Sub FacturationToolStripMenuItem_Click(sender As Object, e As EventArgs)

        FacturationForm.Show()

    End Sub

    '------------------------------------FACTURATION BASED ON THE ARTICLE FAMILY ONLY FOR IN ROOM-----------------------------------------------
    'On ne peut facturer ceux qui sont en chambre
    Private Sub FacturationDesEnChambres()

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            'As we come from the MainCouranteReception 
            Dim clientInRoom As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            If clientInRoom.Rows.Count > 0 Then
                'We selected the room in reserve_conf hence reservation has been checkedIn
                If clientInRoom.Rows(0)("ETAT_RESERVATION") = 1 Then
                    'We can output the the facturationForm has our reservation is a checked reservation with out checkout
                    FacturationForm.Show()
                End If
            End If

        End If

    End Sub

    'Facturation based on the bar/restaurant (clicked at front desk) family
    Private Sub GunaButtonBar_Click(sender As Object, e As EventArgs) Handles GunaButtonBar.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BAR"
        FacturationForm.Show()

    End Sub

    'Facturation based on the bar/restaurant (clicked at front desk) family
    Private Sub GunaButtonRestaurant_Click(sender As Object, e As EventArgs) Handles GunaButtonRestaurant.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True
        GlobalVariable.ArticleFamily = "RESTAURANT"
        FacturationForm.Show()

    End Sub

    'Facturation based on the services (clicked at front desk) family
    Private Sub GunaButtonServices_Click(sender As Object, e As EventArgs) Handles GunaButtonServices.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "SERVICES"

        FacturationForm.Show()

    End Sub

    'Facturation based on the salon de beaute (clicked at front desk) family
    Private Sub GunaButtonSalonDeBeaute_Click(sender As Object, e As EventArgs) Handles GunaButtonSalonDeBeaute.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "SALON DE BEAUTE"
        FacturationForm.Show()

    End Sub

    'Facturation based on boutique
    Private Sub GunaButtonBoutique_Click(sender As Object, e As EventArgs) Handles GunaButtonBoutique.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BOUTIQUE"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonCyberCafe_Click(sender As Object, e As EventArgs) Handles GunaButtonCyberCafe.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "BUSINESS CENTER"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonAutres_Click(sender As Object, e As EventArgs) Handles GunaButtonAutres.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "AUTRES"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonLoisir_Click(sender As Object, e As EventArgs) Handles GunaButtonLoisir.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "LOISIRS"

        FacturationForm.Show()

    End Sub

    Private Sub GunaButtonKiosque_Click(sender As Object, e As EventArgs) Handles GunaButtonKiosque.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "KIOSQUE A JOURNAUX"

        FacturationForm.Show()
    End Sub

    Private Sub GunaButtonSport_Click(sender As Object, e As EventArgs) Handles GunaButtonSport.Click
        FacturationForm.TopMost = True
        FacturationForm.Location = New System.Drawing.Point(10, 104)
        'To know if we come from the frontdesk
        GlobalVariable.checkInFacturation = True

        GlobalVariable.ArticleFamily = "SPORTS"

        FacturationForm.Show()
    End Sub

    '---------------------------------- SITUATION DU CLIENT EN DOUBLE CLIQUANT SUR LE SOLDE ----------------------------------

    'When we double click on solde textbox we open SituationClientForm

    Private Sub GunaPanelSolde_DoubleClick(sender As Object, e As EventArgs) Handles GunaPanelSolde.DoubleClick

        'Ne s'affiche que pour les utilisateurs ayant une reservation enregistrée ou tout autre
        If Not GlobalVariable.codeReservationToUpdate = "" Then
            SituationClientForm.Show()
        Else
            ReglementForm.Show()
        End If

    End Sub

    Private Sub GunaLabelSolde_DoubleClick(sender As Object, e As EventArgs) Handles GunaLabelSolde.DoubleClick

        'Ne s'affiche que pour les utilisateurs ayant une reservation enregistrée ou tout autre
        If Not GlobalVariable.codeReservationToUpdate = "" Then
            SituationClientForm.Show()
        Else
            ReglementForm.Show()
        End If

    End Sub

    '---------------------------------- SITUATION DU CLIENT ----------------------------------

    'Affichage de la famille des article
    Private Sub GunaButton8_Click(sender As Object, e As EventArgs) Handles GunaButtonFamilleArticle.Click

        GlobalVariable.typeFamilleOuSousFamille = "famille"

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        ArticleFamilyForm.Show()

    End Sub

    'Affichage des article
    Private Sub GunaButtonArticles_Click(sender As Object, e As EventArgs) Handles GunaButtonArticles.Click

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 2
        ArticleForm.Show()

    End Sub

    'CHANGEMENT DE LABEL DES DATES POUR CHAQUE TAB-----------------------------------

    'Tab En chambre
    'En cas de changement de date on renomme les labelles pour chaque tab
    Private Sub GunaDateTimePickerDebutEnChambre_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDebutEnChambre.ValueChanged
        GunaLabel50.Text = GunaDateTimePickerDebutEnChambre.Value.ToShortDateString()
    End Sub

    'Tab Departs
    Private Sub GunaDateTimePickerArriveeDepart_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerArriveeDepart.ValueChanged
        GunaLabelDateDepartFin.Text = GunaDateTimePickerDepartDepert.Value.ToShortDateString()
        GunaLabelDateDepartDebut.Text = GunaDateTimePickerArriveeDepart.Value.ToShortDateString()
    End Sub

    Private Sub GunaDateTimePickerDepartDepert_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDepartDepert.ValueChanged
        GunaLabelDateDepartFin.Text = GunaDateTimePickerDepartDepert.Value.ToShortDateString()
        GunaLabelDateDepartDebut.Text = GunaDateTimePickerArriveeDepart.Value.ToShortDateString()
    End Sub

    'Tab Attendus
    Private Sub GunaDateTimePickerDebut_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerDebut.ValueChanged
        GunaLabel53.Text = GunaDateTimePickerFin.Value.ToShortDateString()
        GunaLabel54.Text = GunaDateTimePickerDebut.Value.ToShortDateString()
    End Sub

    Private Sub GunaDateTimePickerFin_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerFin.ValueChanged
        GunaLabel53.Text = GunaDateTimePickerFin.Value.ToShortDateString()
        GunaLabel54.Text = GunaDateTimePickerDebut.Value.ToShortDateString()
    End Sub

    '--------------------------------------------------- GESTION DES DATAGRIDS DES ENTENDUS - EN CHAMBRES - DEPARTS ---------------

    '------------------------------------- LOADING OF THE CONTENT OF A TAB INTO THE FRONT DESK ---------------------------------------------
    'EN CHAMBRE GRID
    Private Sub DataGridViewEnChambre_CellContentDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridViewEnChambre.CellDoubleClick

        viderDocumentDatagrids()

        If e.RowIndex >= 0 Then

            LabelNatureReservation.Text = "EN CHAMBRE"

            Dim row As DataGridViewRow

            row = Me.DataGridViewEnChambre.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                'Variable to print or not checkout button
                GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")
            End If

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            End If

            affectingValuesToFields()

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'RESERVATION GRID
    Private Sub GunaDataGridViewReservationList_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewReservationList.CellDoubleClick

        viderDocumentDatagrids()

        If e.RowIndex >= 0 Then

            LabelNatureReservation.Visible = True

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewReservationList.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString


            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve_conf
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                If GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 1 Then
                    LabelNatureReservation.Text = "EN CHAMBRE"
                Else
                    LabelNatureReservation.Text = "CHECKOUT"
                End If

            Else

                If GlobalVariable.ReservationToUpdate.Rows(0)("ETAT_RESERVATION") = 0 Then
                    LabelNatureReservation.Text = "EN COURS"
                Else
                    LabelNatureReservation.Text = "ANNULEE"
                End If

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")

            'MessageBox.Show(GlobalVariable.codeClientToUpdate & " - " & GlobalVariable.codeReservationToUpdate & "-" & GlobalVariable.ReservationToUpdate(0)("CLIENT_ID"))
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate


            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            End If

            'Affecting values mostly for calculations
            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            TabControlHbergement.SelectedIndex = 0

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'ATTENDUS GRID
    Private Sub DataGridViewAttenduPanel_CellContentClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridViewAttenduPanel.CellDoubleClick

        viderDocumentDatagrids()

        If e.RowIndex >= 0 Then

            LabelNatureReservation.Text = "EN COURS"

            Dim row As DataGridViewRow

            row = Me.DataGridViewAttenduPanel.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString


            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve_conf
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate


            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            End If

            'Affecting values mostly for calculations
            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            TabControlHbergement.SelectedIndex = 0

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'DEPART GRID
    Private Sub DataGridViewDepartTab_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridViewDepartTab.CellDoubleClick

        viderDocumentDatagrids()

        If e.RowIndex >= 0 Then

            LabelNatureReservation.Text = "EN CHAMBRE"

            Dim row As DataGridViewRow

            row = Me.DataGridViewDepartTab.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = Trim(row.Cells("RESERVATION").Value.ToString)

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                'Variable to print or not checkout button
                GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")
            End If

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            End If

            affectingValuesToFields()

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False
            'We hide all the Datagrid used for custom filling

            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    '--------------------------------------------------- END GESTION DES ENTENDUS - EN CHAMBRES - DEPARTS ---------------


    Private Sub GunaButton6_Click(sender As Object, e As EventArgs)

        ReglementForm.Show()

    End Sub

    '--------------------------------------------- PLANNING PANNEL MANEGEMNT ----------------------------------------------

    Dim dateEntree As Date
    Dim dateDeSortie As Date
    Dim codeChambreSelectionnee As String
    Dim firstCell As Boolean = True
    Dim secondCell As Boolean = True

    'Coordinate of the selected cells OnMouseUp and OnMouseDown
    Dim m As Integer
    Dim r As Integer
    Dim n As Integer
    Dim s As Integer

    'Coordinates of the first and last cell
    Dim DisplayPoint1 As Point
    Dim DisplayPoint2 As Point

    'Used to dtermine the lenght of the selected cells
    Dim numberOfCellsSelected As Integer = 0
    Dim widthOfSelectedCells As Integer = 0

    Dim heightOfCells As Integer = 0

    Private Sub GunaDataGridViewPlanning_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewPlanning.CellClick

        'On mouse out I need 
        'For the first cell
        '- The column so as to obtain the date1 (1, r) since first cell has coordinate (m,r) with r > 1 : mouseDown
        'For the second cell
        '- The column so as to obtain the date2 (1, s) since second cell has coordinate (n, s) with s > 1 : mouseUp
        '- s > r and m = n
        '- With one of the above I obtain the room
        '- To obtain the room code (m, 0) with m > 0

        '------------------------- Obtaining the room ---------------------------
        'm/n : row and r/s : column

        'Coordinate (n,s)

        If e.RowIndex Then

            Dim row As DataGridViewRow

            Dim mouseDown As String = GunaDataGridViewPlanning.CurrentCell.ColumnIndex & " - " & GunaDataGridViewPlanning.CurrentCell.ColumnIndex

            'The coordinate of the last cell will be given by (m,r)
            Dim t As Integer = 0

            If firstCell Then

                m = GunaDataGridViewPlanning.CurrentCell.RowIndex
                r = GunaDataGridViewPlanning.CurrentCell.ColumnIndex

                DisplayPoint1 = GunaDataGridViewPlanning.PointToScreen(GunaDataGridViewPlanning.GetCellDisplayRectangle(e.ColumnIndex, e.RowIndex, False).Location)


                firstCell = False

            ElseIf secondCell Then

                n = GunaDataGridViewPlanning.CurrentCell.RowIndex
                s = GunaDataGridViewPlanning.CurrentCell.ColumnIndex

                If (m = n) And s >= r Then

                    If Not (r Mod 2 = 0) Then
                        r = r - 1
                    End If

                    If Not (s Mod 2 = 0) Then
                        s = s - 1
                    End If

                    TabControlHbergement.SelectedIndex = 0

                    secondCell = False

                    row = GunaDataGridViewPlanning.Rows(m)

                    Dim room As DataTable = Functions.getElementByCode(row.Cells(0).Value.ToString(), "chambre", "CODE_CHAMBRE")

                    Dim codeType As String = room.Rows(0)("CODE_TYPE_CHAMBRE")

                    Dim roomType As DataTable = Functions.getElementByCode(codeType, "type_chambre", "CODE_TYPE_CHAMBRE")

                    GunaTextBoxLibelleChambre.Text = room.Rows(0)("LIBELLE_CHAMBRE")
                    GunaTextBoxCodeTypeDeChambre.Text = room.Rows(0)("CODE_TYPE_CHAMBRE")
                    GunaTextBoxLibelleTYpe.Text = roomType.Rows(0)("LIBELLE_TYPE_CHAMBRE")
                    GunaTextBoxNumeroChambre.Text = room.Rows(0)("CODE_CHAMBRE").ToString()
                    GunaTextBoxLibelleChambre.Text = room.Rows(0)("LOCALISATION").ToString()

                    GunaTextBoxpPrixAffiche.Text = Format(roomType.Rows(0)("PRIX"), "#,##0")

                    GunaTextBoxMontantAccorde.Text = GunaTextBoxpPrixAffiche.Text

                    GunaTextBoxPrixParNuitee.Text = GunaTextBoxMontantAccorde.Text
                    GunaTextBoxNombreDeJourTotal.Text = CType(GunaTextBoxTempsAFaire.Text, Int32)

                    row = GunaDataGridViewPlanning.Rows(0)

                    Dim dateOrigine As Date = Now().AddDays(-13)

                    'Date d'entrée
                    Dim numberOfDaysToAdd As Integer = 0

                    numberOfDaysToAdd = (r / 2) - 1

                    dateEntree = dateOrigine.AddDays(numberOfDaysToAdd)

                    'Date sortie

                    numberOfDaysToAdd = (s / 2) - 1

                    dateDeSortie = dateOrigine.AddDays(numberOfDaysToAdd)

                    GunaDateTimePickerArrivee.Value = dateEntree
                    GunaDateTimePickerDepart.Value = dateDeSortie

                    firstCell = True
                    secondCell = True

                    GunaDataGridViewRoomType.Visible = False
                    GunaDataGridViewClient.Visible = False
                    GunaDataGridViewRoom.Visible = False
                    GunaDataGridViewPhone.Visible = False

                    'Selction of cells between the range
                    Dim i As Integer = 0

                    If (s Mod 2 = 0) Then
                        s = s + 1
                    End If

                    numberOfCellsSelected = s - r + 1

                    For i = r To s
                        GunaDataGridViewPlanning.Rows(m).Cells(i).Selected = True
                        GunaDataGridViewPlanning.Rows(m).Cells(i).Style.SelectionBackColor = Color.Red
                    Next

                    'Coordinate of second cell
                    DisplayPoint2 = GunaDataGridViewPlanning.PointToScreen(GunaDataGridViewPlanning.GetCellDisplayRectangle(e.ColumnIndex, e.RowIndex, False).Location)

                    'Coordinates of the first and last cell
                    MessageBox.Show(DisplayPoint1.X & "-" & DisplayPoint1.Y)
                    MessageBox.Show(DisplayPoint2.X & "-" & DisplayPoint2.Y)

                    MessageBox.Show(numberOfCellsSelected)

                    'Width of selected cells
                    widthOfSelectedCells = numberOfCellsSelected * GunaDataGridViewPlanning.Columns(0).Width
                    heightOfCells = GunaDataGridViewPlanning.Rows(0).Height
                    MessageBox.Show(widthOfSelectedCells)

                    'Creation of label to display on the selected datagrid cells

                    GunaLabelOccupant.Size = New System.Drawing.Size(widthOfSelectedCells, heightOfCells)
                    GunaLabelOccupant.Location = New System.Drawing.Point(DisplayPoint1.X + (widthOfSelectedCells / 4) + 40, DisplayPoint1.Y - 116)
                    'GunaLabelOccupant.Text = "NEMBOT BILIE LINDA " & Chr(13) & "nembolinda@yahoo.fr"

                    reservationButtonToDisplay()

                    PanelTableauDeBords.Hide()
                    PanelPlanning.Hide()
                    PanelEnregistrement.Show()

                Else

                    firstCell = True

                    secondCell = True

                End If

            End If

        End If

    End Sub

    'We change the label of the front desk depending on the active tab
    Public Sub nomDuLabelAAficher()

        If GunaRadioButtonChambre.Checked Then

            If TabControlHbergement.SelectedIndex = 0 Then

                GunaFrontDeskLabel.Text = "RESERVATION CHAMBRE"
            ElseIf TabControlHbergement.SelectedIndex = 1 Then

                GunaFrontDeskLabel.Text = "RESERVATIONS"

            ElseIf TabControlHbergement.SelectedIndex = 2 Then

                GunaFrontDeskLabel.Text = "ARRIVEES"

            ElseIf TabControlHbergement.SelectedIndex = 3 Then

                TabControlHbergement.SelectedTab.Text = "En chambre"
                GunaFrontDeskLabel.Text = "EN CHAMBRES"

            ElseIf TabControlHbergement.SelectedIndex = 4 Then

                GunaFrontDeskLabel.Text = "DEPARTS"

            End If

        ElseIf GunaRadioButtonSalleFete.Checked Then

            If TabControlHbergement.SelectedIndex = 0 Then

                GunaFrontDeskLabel.Text = "RESERVATION SALLE DE FETE"

            ElseIf TabControlHbergement.SelectedIndex = 1 Then

                GunaFrontDeskLabel.Text = "RESERVATIONS"

            ElseIf TabControlHbergement.SelectedIndex = 2 Then

                GunaFrontDeskLabel.Text = "SALLES RESERVEES"

            ElseIf TabControlHbergement.SelectedIndex = 3 Then

                TabControlHbergement.SelectedTab.Text = "Salle Occupée"
                GunaFrontDeskLabel.Text = "SALLES OCCUPEES"

            ElseIf TabControlHbergement.SelectedIndex = 4 Then

                GunaFrontDeskLabel.Text = "DEPARTS"

            End If

        End If

    End Sub

    Private Sub emptySearchFieldReservation()

        'Clearing of search form field
        GunaTextBoxClient.Clear()
        GunaTextBoxNumResa.Clear()
        GunaTextBoxParEntreprise.Clear()
        GunaTextBoxSourceResa.Clear()
        GunaTextBoxNumGroupe.Clear()
        GunaTextBoxTypeChambre.Clear()

    End Sub

    Private Sub TabControl1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles TabControlHbergement.SelectedIndexChanged

        'Le statut ne doit être visible que en cas de modification

        If Not GlobalVariable.codeReservationToUpdate = "" Then
            LabelNatureReservation.Visible = True
        Else
            LabelNatureReservation.Visible = False
        End If

        'On s'aasutre les tabs des arrivé est vide à l'ouverture
        DataGridViewAttenduPanel.Columns.Clear()
        DataGridViewEnChambre.Columns.Clear()
        DataGridViewDepartTab.Columns.Clear()
        GunaDataGridViewReservationList.Columns.Clear()

        nomDuLabelAAficher()

        If Not TabControlHbergement.SelectedIndex = 1 Then
            GunaDataGridViewReservationList.Columns.Clear()
        End If

        If TabControlHbergement.SelectedIndex = 0 Then

            GunaLabelTypeDeSejour.Visible = True
            Imprimer.Visible = True
            GunaButtonVider.Visible = True
            GunaButtonQuitter.Visible = True
            GunaComboBoxImpressionSalle.Visible = True
            GunaComboBoxImpressionChambre.Visible = True
        Else
            GunaLabelTypeDeSejour.Visible = False
            Imprimer.Visible = False
            GunaButtonVider.Visible = False
            GunaButtonQuitter.Visible = False
            GunaComboBoxImpressionSalle.Visible = False
            GunaComboBoxImpressionChambre.Visible = False
        End If

    End Sub

    ' ------------------------------------------------ END PLANNING MANAGAMENT ----------------------------------------------


    '------------------------------------------------ FILLING OF CLIENT INFORMATION USING THE PHONE NUMBER ------------------------------

    'We select a client from front desk depending on his number

    Private Sub GunaTextBoxTelClient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTelClient.TextChanged

        GunaDataGridViewPhone.Visible = True

        Dim Query As String = "SELECT NOM_PRENOM, EMAIL From client WHERE TELEPHONE LIKE '%" & GunaTextBoxTelClient.Text & "%'"
        Dim command As New MySqlCommand(Query, GlobalVariable.connect)
        Dim table As New DataTable
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then
            GunaDataGridViewPhone.DataSource = table
        Else
            GunaDataGridViewPhone.Columns.Clear()
            GunaDataGridViewPhone.Visible = False
        End If

        If GunaTextBoxTelClient.Text = "" Then
            GunaDataGridViewPhone.Visible = False
        End If

    End Sub

    'Filling the other fields concerning the room type when we click on the custom Datagrid
    Private Sub GunaDataGridViewPhone_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewPhone.CellClick

        'Exacte code also used for filling client part from phone number 

        GunaDataGridViewPhone.Visible = False

        Dim row As DataGridViewRow

        row = Me.GunaDataGridViewPhone.Rows(e.RowIndex)

        Dim query As String = "SELECT * FROM client WHERE NOM_PRENOM = @NOM_PRENOM AND EMAIL=@EMAIL ORDER BY NOM_PRENOM ASC"

        Dim client As New DataTable()
        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@NOM_PRENOM", MySqlDbType.VarChar).Value = row.Cells("NOM_PRENOM").Value.ToString()
        command.Parameters.Add("@EMAIL", MySqlDbType.VarChar).Value = row.Cells("EMAIL").Value.ToString()
        Dim adapter As New MySqlDataAdapter(command)
        adapter.Fill(client)

        If (client.Rows.Count > 0) Then

            'Gathering of some information concernit the client to be use later

            GlobalVariable.idClient = client.Rows(0)("ID_CLIENT").ToString

            GlobalVariable.codeClient = client.Rows(0)("CODE_CLIENT").ToString

            GlobalVariable.codeCompteClient = client.Rows(0)("NUM_COMPTE").ToString

            GunaTextBoxNomPrenom.Text = row.Cells("NOM_PRENOM").Value.ToString()
            GunaTextBoxTelClient.Text = client.Rows(0)("TELEPHONE").ToString
            GunaTextBoxClientEmail.Text = client.Rows(0)("EMAIL").ToString
            GunaTextBoxCNI.Text = client.Rows(0)("CNI").ToString
            GunaTextBoxRefClient.Text = client.Rows(0)("CODE_CLIENT").ToString
            GunaTextBoxSiteWeb.Text = client.Rows(0)("SITE_INTERNET").ToString

            GunaTextBoxCNI.Text = client.Rows(0)("CNI")

            GunaTextBoxNomJeuneFille.Text = client.Rows(0)("NOM_JEUNE_FILLE")
            GunaTextBoxTypeClient.Text = client.Rows(0)("TYPE_CLIENT")
            GunaDateTimePickerDateNaissance.Value = client.Rows(0)("DATE_DE_NAISSANCE")
            GunaTextBoxLieu.Text = client.Rows(0)("LIEU_DE_NAISSANCE")
            GunaTextBoxNationalite.Text = client.Rows(0)("NATIONALITE")
            GunaTextBoxPaysResidence.Text = client.Rows(0)("PAYS_RESIDENCE")
            GunaTextBoxProfession.Text = client.Rows(0)("PROFESSION")
            GunaTextBoxNumeroCompte.Text = client.Rows(0)("NUM_COMPTE")
            GunaTextBoxRue.Text = client.Rows(0)("ADRESSE")
            GunaTextBoxVilleDeResidence.Text = client.Rows(0)("VILLE_DE_RESIDENCE")
            GunaTextBoxModeTransport.Text = client.Rows(0)("MODE_TRANSPORT")
            GunaTextBoxNumVehicule.Text = client.Rows(0)("NUM_VEHICULE")

            Dim Entreprise As DataTable = Functions.getElementByCode(client.Rows(0)("CODE_ENTREPRISE"), "client", "CODE_CLIENT")

            If Entreprise.Rows.Count > 0 Then
                GunaTextBoxEntrepriseDuclient.Text = Trim(Entreprise.Rows(0)("NOM_PRENOM"))
            End If

            GunaDataGridViewRoom.Visible = False

            GunaDataGridViewClient.Visible = False

        Else

            GunaTextBoxTelClient.Clear()

        End If

        GunaDataGridViewPhone.Visible = False

        'connect.closeConnection()

        'We display buttons
        reservationButtonToDisplay()

    End Sub

    Private Sub GunaButtonListeDesCategorieDeChambre_Click(sender As Object, e As EventArgs) Handles GunaButtonListeDesCategorieDeChambre.Click

        If GunaRadioButtonSalleFete.Checked Then

            GlobalVariable.typeChambreOuSalle = "salle"

        ElseIf GunaRadioButtonChambre.Checked Then

            GlobalVariable.typeChambreOuSalle = "chambre"

        End If
        'To be set back after a double click on the categorie list

        GlobalVariable.addCategorieFromFrontOffice = True

        RoomTypeForm.Show()

    End Sub

    '------------------------------------------------ END FILLING OF CLIENT INFORMATION USING THE PHONE NUMBER ---------------------------


    '------------------------------------------------ MANAGING SEJOUR AND PETIT DEJEUNER CHECK BOX --------------------------
    Private Sub GunaCheckBoxTaxeSejour_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxTaxeSejour.Click

        If GunaCheckBoxTaxeSejour.Checked Then

            GunaTextBoxTaxeSejour.Visible = True

            Dim adapter As New MySqlDataAdapter
            Dim table As New DataTable
            Dim getUserQuery = "SELECT LIBELLE, CATEGORIE_HOTEL, MONTANT_TAXE FROM category_hotel_taxe_sejour_collectee INNER JOIN agence WHERE category_hotel_taxe_sejour_collectee.LIBELLE = agence.CATEGORIE_HOTEL"
            Dim Command As New MySqlCommand(getUserQuery, GlobalVariable.connect)

            adapter.SelectCommand = Command
            adapter.Fill(table)

            If table.Rows.Count > 0 Then

                Dim TaxeSejour As Double
                Double.TryParse(table.Rows(0)("MONTANT_TAXE"), TaxeSejour)
                GunaTextBoxTaxeSejour.Visible = True
                GunaTextBoxTaxeSejour.Text = Format(TaxeSejour, "#,##0")

            Else

            End If

        Else

            GunaTextBoxTaxeSejour.Visible = False

        End If

    End Sub

    Private Sub GunaCheckBoxPetitDejeuenerInclus_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxPetitDejeuenerInclus.Click

        If GunaCheckBoxPetitDejeuenerInclus.Checked Then

            GunaTextBoxPetitDejeuner.Visible = False
            GunaTextBoxPetitDejeuner.Text = 1

        Else

            GunaTextBoxPetitDejeuner.Visible = False
            GunaTextBoxPetitDejeuner.Clear()


        End If

    End Sub

    Private Sub GunaCheckBoxPetitDejRoutage_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxPetitDejRoutage.Click

        If GunaCheckBoxPetitDejRoutage.Checked Then

            GunaTextBoxPetitDejeunerRoutage.Visible = True

        Else

            GunaTextBoxPetitDejeunerRoutage.Visible = False
            GunaTextBoxPetitDejeunerRoutage.Clear()
        End If

    End Sub

    Private Sub GunaCheckBoxChambreRoutage_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxChambreRoutage.Click

        If GunaCheckBoxChambreRoutage.Checked Then

            GunaTextBoxPrixChambreRoutage.Visible = True
            GunaTextBoxPrixChambreRoutage.Text = GunaTextBoxMontantAccorde.Text
            GunaTextBoxRoutage.Text = "OUI"

        Else

            GunaTextBoxPrixChambreRoutage.Visible = False
            GunaTextBoxRoutage.Text = "NON"

        End If

    End Sub

    '------------------------------------------------------ END CHECK BOX -----------------------------------------------------------


    '---------------------------GESTION DES CHECKBOXES POUR RESERVATION CHAMBRE OU SALLE DE FETE -------------------------------

    '--------------------------------- CHAMBRES 

    Private Sub GunaRadioButtonChambre_Click(sender As Object, e As EventArgs) Handles GunaRadioButtonChambre.Click

        GunaDataGridViewReservationList.Columns.Clear()

        GunaTextBoxNbreAdulte.Text = 1
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text
        setTableUsedForAutocompletionToFalse()

        setTableUsedForAutocompletionToFalse()

        TabPage3.Text = "En Chambre"

        If GunaRadioButtonChambre.Checked Then

            GunaLabelNumReservation.Text = ""

            nomDuLabelAAficher()

            GlobalVariable.typeChambreOuSalle = "chambre"

            GunaCheckBoxPetitDejeuenerInclus.Visible = True
            GunaCheckBoxTaxeSejour.Visible = True

            emtptyRegistrationFields()

            TabPage3.Text = "En Chambre"

            GunaLabel52.Text = "EN CHAMBRE DU: "

            GlobalVariable.typeChambreOuSalle = "chambre"

            If TabControlHbergement.SelectedIndex = 3 Then
                TabControlHbergement.SelectedTab.Text = "En Chambre"
                GunaFrontDeskLabel.Text = "EN CHAMBRE"
            End If

            If TabControlHbergement.SelectedIndex = 0 Then
                GunaFrontDeskLabel.Text = "RESERVATION CHAMBRE"
            End If

            If TabControlHbergement.SelectedIndex = 1 Then
                GunaFrontDeskLabel.Text = "RESERVATIONS"
            End If

            GunaRadioButtonChambre.Visible = True
            GunaRadioButtonSalleFete.Visible = True

            GunaComboBoxImpressionChambre.Visible = True
            GunaButtonLectureDeCarte.Visible = True
            GunaComboBoxImpressionSalle.Visible = False

            GunaTextBoxSuperficie.Visible = False

            '----------------------------- LEFT TAB -----------------

            '------------------------------- DETAILS CHAMBRE
            GunaGroupBoxDetailChambre.Text = "Détails de la Chambre"
            GunaLabelLibelleTypeChambreSalle.Text = "Type Chambre"
            GunaLabelNumeroChambre.Text = "Chambre N°"

            TabControlGestionReservation.SelectedIndex = 0

            GunaPanelSalleReservation.Visible = False
            GunaTextBoxCapacite.Visible = False

            Functions.SiplifiedClearTextBox(Me)

        End If

    End Sub

    '--------------------------------- SALLE DE FETE

    Public Sub setTableUsedForAutocompletionToFalse()

        GunaDataGridViewRoomType.Visible = False
        GunaDataGridViewClient.Visible = False
        GunaDataGridViewRoom.Visible = False
        GunaDataGridViewPhone.Visible = False

    End Sub

    Private Sub GunaRadioButtonSalleFete_Click(sender As Object, e As EventArgs) Handles GunaRadioButtonSalleFete.Click

        GunaDataGridViewReservationList.Columns.Clear()

        setTableUsedForAutocompletionToFalse()

        GunaTextBoxNbreAdulte.Text = 1
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text

        If GunaRadioButtonSalleFete.Checked Then

            GunaLabelNumReservation.Text = ""

            nomDuLabelAAficher()

            GlobalVariable.typeChambreOuSalle = "salle"

            GunaCheckBoxPetitDejeuenerInclus.Visible = False
            GunaCheckBoxTaxeSejour.Visible = False

            emtptyRegistrationFields()

            GunaLabel52.Text = "SALLES OCCUPEES DU: "

            GlobalVariable.typeChambreOuSalle = "salle"

            TabPage3.Text = "Salle Occupée"

            If TabControlHbergement.SelectedIndex = 3 Then
                TabControlHbergement.SelectedTab.Text = "Salle Occupée"
                GunaFrontDeskLabel.Text = "SALLE(S) OCCUPEE(S)"
            End If

            If TabControlHbergement.SelectedIndex = 0 Then
                GunaFrontDeskLabel.Text = "RESERVATION SALLE DE FETE"
            End If

            If TabControlHbergement.SelectedIndex = 1 Then
                GunaFrontDeskLabel.Text = "RESERVATIONS"
            End If

            GunaRadioButtonChambre.Visible = True
            GunaRadioButtonSalleFete.Visible = True
            GunaComboBoxImpressionChambre.Visible = False
            GunaComboBoxImpressionSalle.Visible = True

            GunaTextBoxSuperficie.Visible = True
            GunaButtonLectureDeCarte.Visible = False

            '----------------------------- LEFT TAB -----------------

            '------------------------------- DETAILS SALLE
            GunaGroupBoxDetailChambre.Text = "Détails de la Salle"
            GunaLabelLibelleTypeChambreSalle.Text = "Type de Salle"
            GunaLabelNumeroChambre.Text = "Nom Salle"

            TabControlGestionReservation.SelectedIndex = 0

            GunaPanelSalleReservation.Visible = True
            GunaTextBoxCapacite.Visible = True

        End If


    End Sub

    '------------------------- GESTION DU CALCUL TOTAL DU COUT DE LA SALLE

    Public Function sumAReglerPourSalle()

        Dim val1 = 0
        Dim val2 = 0
        Dim val3 = 0
        Dim val4 = 0
        Dim val5 = 0
        Dim val6 = 0

        Double.TryParse(GunaTextBox37.Text, val1)
        Double.TryParse(GunaTextBox33.Text, val2)
        Double.TryParse(GunaTextBox31.Text, val3)
        Double.TryParse(GunaTextBox29.Text, val4)
        Double.TryParse(GunaTextBoxMontantReelSalle.Text, val5)
        Double.TryParse(GunaTextBoxDecoration.Text, val6)

        Return val1 + val2 + val3 + val4 + val5 + val6

    End Function

    'Café
    Private Sub GunaTextBox40_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfaitCafe.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0

        Double.TryParse(GunaTextBoxForfaitCafe.Text, prix)
        Integer.TryParse(GunaTextBox35.Text, quantite)
        GunaTextBox37.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub


    Private Sub GunaTextBox35_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox35.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitCafe.Text, prix)
        Integer.TryParse(GunaTextBox35.Text, quantite)
        GunaTextBox37.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    'Déjeuner

    Private Sub GunaTextBoxForfatiDejeuner_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfatiDejeuner.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfatiDejeuner.Text, prix)
        Integer.TryParse(GunaTextBox30.Text, quantite)
        GunaTextBox33.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    Private Sub GunaTextBox30_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox30.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfatiDejeuner.Text, prix)
        Integer.TryParse(GunaTextBox30.Text, quantite)
        GunaTextBox33.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    'Dinner

    Private Sub GunaTextBoxForfaitDiner_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfaitDiner.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitDiner.Text, prix)
        Integer.TryParse(GunaTextBox25.Text, quantite)
        GunaTextBox31.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    Private Sub GunaTextBox25_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox25.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitDiner.Text, prix)
        Integer.TryParse(GunaTextBox25.Text, quantite)
        GunaTextBox31.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub


    'Traiteur
    Private Sub GunaTextBox34_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxForfaitTraiteur.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitTraiteur.Text, prix)
        Integer.TryParse(GunaTextBox13.Text, quantite)
        GunaTextBox29.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    Private Sub GunaTextBox13_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBox13.TextChanged

        Dim prix As Double = 0
        Dim quantite As Integer = 0
        Double.TryParse(GunaTextBoxForfaitTraiteur.Text, prix)
        Integer.TryParse(GunaTextBox13.Text, quantite)
        GunaTextBox29.Text = Format(prix * quantite, "#,##0")

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub


    Private Sub GunaTextBoxMontantReelSalle_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxMontantReelSalle.TextChanged

        Dim montantAccorde As Double = 0
        'Conservation du montant accordé
        Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantAccorde)
        GlobalVariable.MONTANT_ACCORDE = montantAccorde
        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    Private Sub GunaTextBoxDecoration_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxDecoration.TextChanged

        Dim montantDeco As Double = 0

        GunaTextBoxMontantTotalSalle.Text = Format(sumAReglerPourSalle(), "#,##0")

        Dim nombreDeJourTotal As Integer = 0
        Integer.TryParse(GunaTextBoxTempsAFaire.Text, nombreDeJourTotal)
        GunaTextBoxGrandTotal.Text = Format(sumAReglerPourSalle() * nombreDeJourTotal, "#,##0")

    End Sub

    Private Sub MiseEnServiceToolStripMenuItem1_Click(sender As Object, e As EventArgs)

        'To know if we are managing if we are on chambre ou salle
        GlobalVariable.typeChambreOuSalle = "chambre"
        RoomForm.Show()

    End Sub

    'CASHIER FORM
    Private Sub ToolStripMenuItem76_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem76.Click

        CashierForm.Show()

    End Sub
    '------------------------------- GESTION DES IMPRESSIONS DES DOCUMENTS -------------------------------------------------------------
    ' DOCS LIES AUX CHAMBRES 
    '-------CONFIRMATION DE RESERVATION ---------------------

    Private Sub Imprimer_Click(sender As Object, e As EventArgs) Handles Imprimer.Click

        Dim montantParNuitee As Double = 0

        If GunaLabelNumReservation.Text = "num" Then

            MessageBox.Show(" Aucune Réservation sélectionnée!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

        'Génération des documents concernants les salles Confirmation de réservation
        If GunaRadioButtonSalleFete.Checked Then

            If GunaComboBoxImpressionSalle.SelectedIndex = 0 Then

                'CONFIRMATION DE RESERVATION

                Double.TryParse(GunaTextBoxMontantReelSalle.Text, montantParNuitee)

                Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)

            ElseIf GunaComboBoxImpressionSalle.SelectedIndex = 1 Then
                'CONTRAT DE POLICE
                Functions.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)
            Else

                MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

            GunaComboBoxImpressionSalle.SelectedIndex = -1

        ElseIf GunaRadioButtonChambre.Checked Then
            'Génération des documents concernants les chambres confirmation de réservation

            If GunaComboBoxImpressionChambre.SelectedIndex = 0 Then
                'CONFIRMATION DE RESERVATION
                Double.TryParse(GunaTextBoxMontantAccorde.Text, montantParNuitee)

                Functions.GenerationDeConfirmationReservation(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)

            ElseIf GunaComboBoxImpressionChambre.SelectedIndex = 1 Then
                'FICHE DE POLICE
                'Génératiion de la fiche de police pour les chambres
                Functions.GenerationDeFicheDePolice(GunaLabelNumReservation.Text, GunaTextBoxNomPrenom.Text, GunaDateTimePickerArrivee.Value.ToShortDateString(), GunaDateTimePickerDepart.Value.ToShortDateString(), GunaTextBoxTempsAFaire.Text, GunaTextBoxLibelleTYpe.Text, GunaTextBoxNumeroChambre.Text, montantParNuitee, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureArrivee.selectedItem, GlobalVariable.DateDeTravail + " " + GunaComboBoxHeureDepart.selectedItem, GlobalVariable.typeChambreOuSalle)
            Else

                MessageBox.Show("Sélectionner un Document à imprimer!", "Impression de Document", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

            GunaComboBoxImpressionChambre.SelectedIndex = -1

        End If

    End Sub

    '----------------------------------------------------------------------------------------------------------------------------
    'vidage des datagrid DOCUMENT
    Public Sub viderDocumentDatagrids()

        GunaDataGridViewDesFactures.Columns.Clear()
        GunaDataGridViewListeDesReglement.Columns.Clear()

    End Sub

    'Listing the room
    Private Sub GunaButtonRoomSearchButton_Click(sender As Object, e As EventArgs) Handles GunaButtonRoomSearchButton.Click

        If GunaRadioButtonSalleFete.Checked Then

            GlobalVariable.typeChambreOuSalle = "salle"

        ElseIf GunaRadioButtonChambre.Checked Then

            GlobalVariable.typeChambreOuSalle = "chambre"

        End If

        'To load a room from a window based on conditions
        GlobalVariable.chambreOuSalleFromFrontDesk = GunaTextBoxCodeTypeDeChambre.Text

        RoomForm.Show()

    End Sub

    'BUtton to Load a promo code when chambre is selected
    Private Sub GunaButtonPromo_Click(sender As Object, e As EventArgs) Handles GunaButtonPromo.Click, GunaButtonPromoSalle.Click

        GlobalVariable.tarifFromFrontDesk = True

        TarifForm.Show()

    End Sub

    ' Card paiment management
    Private Sub GunaTextBoxPaiement_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxPaiement.TextChanged

        If Not Trim(GunaTextBoxPaiement.Text).Equals("") Then
            Dim paiement As Double = 0
            Double.TryParse(GunaTextBoxPaiement.Text, paiement)
            GlobalVariable.cardPaiement = paiement
        End If

    End Sub

    'GEstion du contenu du bouton paiment au niveau du front desk
    Private Sub GunaButtonPayer_Click(sender As Object, e As EventArgs) Handles GunaButtonPayer.Click

        ReglementForm.Show()

    End Sub

    Private Sub GunaButton3_Click_1(sender As Object, e As EventArgs) Handles GunaButtonVider.Click

        LabelNatureReservation.Visible = False

        Dim dialog As DialogResult
        dialog = MessageBox.Show("Ceci aura pour effet de vider tous les champs! " & Chr(13) & "Voulez-vous continuer", "Effacement du Froont desk ", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        If dialog = DialogResult.Yes Then

            VidageDesChampsPourNouvelleReservation()
            GunaComboBoxStatutReservation.SelectedIndex = 2
            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    'Client form
    Private Sub GunaButtonModifierClient_Click(sender As Object, e As EventArgs) Handles GunaButtonModifierClient.Click
        ClientForm.Show()
    End Sub

    'GENERAL ACCOUNT
    Private Sub ToolStripMenuItem75_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem75.Click
        GeneralAccountForm.Show()
    End Sub

    '---------------------------------------------------- GESTION DU TABLEAU DE BORDS - DASHBOARD ---------------------------------------------------------------
    'ARRIVEES
    Private Sub GunaAdvenceButtonArrivee_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonArrivee.Click

        'Dim DateDebut As Date = GunaDateTimePickerArriveeDepart.Value.ToString("yyyy-MM-dd")
        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        'Dim DateFin As Date = GunaDateTimePickerDepartDepert.Value.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        If (DateDebut <= DateFin) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION = @ETAT_RESERVATION ORDER BY ID_RESERVATION DESC"

            Dim ETAT_RESERVATION As Integer = 0
            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"
            command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int64).Value = ETAT_RESERVATION

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewCLientDashBoard.DataSource = table
                GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewCLientDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            Else

                GunaDataGridViewCLientDashBoard.Columns.Clear()

            End If

            'connect.closeConnection()
        End If

    End Sub

    'DEPARTS
    Private Sub GunaAdvenceButtonDeparts_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonDeparts.Click

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        If (DateDebut <= DateFin) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewCLientDashBoard.DataSource = table
                GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewCLientDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
            Else

                GunaDataGridViewCLientDashBoard.Columns.Clear()

            End If

            'connect.closeConnection()

        End If

    End Sub

    'EN CHAMBRE
    Private Sub GunaAdvenceButtonSejour_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtonSejour.Click

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT CHAMBRE_ID AS 'CHAMBRE', NOM_CLIENT As 'NOM CLIENT', DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_ENTTRE <= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE >='" & DateDebut.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()
        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            GunaDataGridViewCLientDashBoard.DataSource = table
            GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
            GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
            GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
            GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
            GunaDataGridViewCLientDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

        Else

            GunaDataGridViewCLientDashBoard.Columns.Clear()

        End If

        'connect.closeConnection()

    End Sub

    'NO SHOW
    Private Sub GunaAdvenceButtoNoShow_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButtoNoShow.Click

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.AddDays(-1)
        Dim DateFin As Date = GlobalVariable.DateDeTravail.AddDays(-1)

        If (DateDebut <= DateFin) Then

            Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_temp WHERE TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

            If (table.Rows.Count > 0) Then

                GunaDataGridViewCLientDashBoard.DataSource = table
                GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionBackColor = Color.BlueViolet
                GunaDataGridViewCLientDashBoard.DefaultCellStyle.SelectionForeColor = Color.White
                GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewCLientDashBoard.Columns("PRIX/NUITEE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Format = "#,##0"
                GunaDataGridViewCLientDashBoard.Columns("SOLDE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                GunaDataGridViewCLientDashBoard.Columns("RESERVATION").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter

            Else

                GunaDataGridViewCLientDashBoard.Columns.Clear()

            End If

            'connect.closeConnection()

        End If

    End Sub

    'GESTION DES ELEMENTS DU PANNEAU GAUCHE DU DASHBOARD APRES UN DOUBLE CLICK
    Private Sub GunaDataGridViewCLientDashBoard_CellDoubleClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewCLientDashBoard.CellDoubleClick

        If e.RowIndex >= 0 Then
            LabelNatureReservation.Visible = True
            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewCLientDashBoard.Rows(e.RowIndex)

            GlobalVariable.codeReservationToUpdate = row.Cells("RESERVATION").Value.ToString

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")
            LabelNatureReservation.Text = "EN COURS"

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_temp", "CODE_RESERVATION")
                LabelNatureReservation.Text = "ANNULEE"

                If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                    'not found in reservation so, we search in reserve_conf
                    GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")
                    LabelNatureReservation.Text = "EN CHAMBRE"

                End If

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate


            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            End If

            TabControlHbergement.SelectedIndex = 0

            'Affecting values mostly for calculations
            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

        End If

        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

        TabControlHbergement.SelectedIndex = 0

    End Sub

    '-------------------------------------- GESTION DE PANNEAU DU MILIEU ---------------------------------------

    'STATS DU DASHBOARD

    'Cette fonction contient l'ensemble des informations pour les statistiques
    Public Sub contenuStatistique()

        'Obtention des informations pour les statistiques
        Dim stat As New statistiques()

        stat.ObtenirDerniereStatistique()

        Dim codeDelaDerniereStatistique As String = stat.ObtenirDerniereStatistique()

        GlobalVariable.informationDesStatistiques = Functions.getElementByCode(codeDelaDerniereStatistique, "statistiques", "CODE_STATISTIQUE")

        ' End of obtention des informations statistique

    End Sub


    Public Sub StatistiquesDesChambres()

        Dim DateDebut As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")
        Dim DateFin As Date = GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd")

        Dim query As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reserve_conf WHERE DATE_SORTIE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_SORTIE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND ETAT_RESERVATION = 1 AND TYPE=@TYPE ORDER BY ID_RESERVATION DESC"

            Dim command As New MySqlCommand(query, GlobalVariable.connect)
            command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()
            adapter.Fill(table)

        Dim nombreDeDepartDuJour As Integer = 0

        If (table.Rows.Count > 0) Then
            nombreDeDepartDuJour = table.Rows.Count

        End If

        'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
        Dim query1 As String = "SELECT NOM_CLIENT As 'NOM CLIENT', CHAMBRE_ID AS 'CHAMBRE',DATE_ENTTRE As 'DATE ENTREE', DATE_SORTIE As 'DATE SORTIE', SOLDE_RESERVATION AS 'SOLDE', MONTANT_ACCORDE AS 'PRIX/NUITEE', CODE_RESERVATION AS 'RESERVATION',ETAT_NOTE_RESERVATION AS 'STATUT',NB_PERSONNES As 'PERSONNE(S)' FROM reservation WHERE DATE_ENTTRE >= '" & DateDebut.ToString("yyyy-MM-dd") & "' AND DATE_ENTTRE <='" & DateFin.ToString("yyyy-MM-dd") & "' AND TYPE=@TYPE AND ETAT_RESERVATION= 0 ORDER BY ID_RESERVATION DESC"

        Dim command1 As New MySqlCommand(query1, GlobalVariable.connect)
        command1.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = GlobalVariable.typeChambreOuSalle
        'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

        Dim adapter1 As New MySqlDataAdapter(command1)
        Dim table1 As New DataTable()
        adapter1.Fill(table1)

        Dim nombreArriveeDuJour As Integer = 0

        If (table1.Rows.Count > 0) Then
            nombreArriveeDuJour = table1.Rows.Count
        End If

        contenuStatistique()

        Dim departEffectue As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_DEPART_EFFECTUE")
        Dim departTotal As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_DEPART_FINAL")

        Dim arriveeEffectuee As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_ARRIVEE_EFFECTUE")
        Dim arrriveeTotal As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_ARRIVEE_FINAL")

        Dim nombreTotalDeChambre As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_TOTAL")

        Dim nombreDeChambreOccupee As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_OCCUPEE")
        Dim nombreDeChambreLibre As Integer = GlobalVariable.informationDesStatistiques.Rows(0)("NOMBRE_CHAMBRE_LIBRE")

        GunaLabelRmc.Text = Format(GlobalVariable.informationDesStatistiques.Rows(0)("RECETTE_MOYENNE_PAR_CHAMBRE_LOUEE"), "#,##0")
        GunaLabelCodeMonnaie.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
        GunaLabelMonnaieCode.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")

        Dim roundedValue As Double = Math.Round(GlobalVariable.informationDesStatistiques.Rows(0)("RECETTE_TOTAL_PAR_CHAMBRE"), 0)
        GunaLabelTrevPar.Text = Format(roundedValue, "#,##0")

        Dim xValue As Integer = 22
        Dim yValue As Integer = 43

        For m = 0 To 4

            Dim customPanel As New Panel
            customPanel.Text = "Test" & m
            customPanel.Name = "a" & m
            customPanel.Location = New Point(xValue, yValue)

            If m = 0 Then
                customPanel.BackColor = Color.CadetBlue
            ElseIf m = 1 Then
                customPanel.BackColor = Color.YellowGreen
            ElseIf m = 2 Then
                customPanel.BackColor = Color.Goldenrod
            ElseIf m = 3 Then
                customPanel.BackColor = Color.Peru
            End If

            customPanel.ForeColor = Color.White
            'customPanel.Size = New Size(75, 103)
            customPanel.Size = New Size(185, 115)
            customPanel.Anchor = AnchorStyles.None

            Dim customLabel As New Label

            customLabel.AutoSize = True
            customLabel.Font = New System.Drawing.Font("Segoe UI", 11.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))

            customLabel.Name = "customLabel"
            customLabel.Size = New System.Drawing.Size(67, 81)
            customLabel.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabel.TabIndex = 4

            Dim customLabelValue As New Label

            customLabelValue.AutoSize = True
            customLabelValue.Font = New System.Drawing.Font("Segoe UI", 45.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
            customLabelValue.Location = New System.Drawing.Point(55, -10)
            customLabelValue.Name = "customLabelValue"
            customLabelValue.Size = New System.Drawing.Size(67, 81)
            customLabelValue.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabelValue.TabIndex = 4

            Dim customLabelValue1 As New Label

            customLabelValue1.AutoSize = True
            customLabelValue1.Font = New System.Drawing.Font("Segoe UI", 14.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
            customLabelValue1.Location = New System.Drawing.Point(65, 85)
            customLabelValue1.Name = "customLabelValue1"
            customLabelValue1.Size = New System.Drawing.Size(67, 81)
            customLabelValue1.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabelValue1.TabIndex = 4

            'Gestion de l'etat en plus du nombre
            If m = 0 Then
                'customLabelValue.Text = departTotal - departEffectue
                customLabelValue.Text = nombreDeDepartDuJour

                'customLabelValue1.Text = departEffectue & " / " & departTotal
                customLabelValue1.Text = nombreDeDepartDuJour & " / " & departTotal

                customLabel.Location = New System.Drawing.Point(35, 60)

                customLabel.Text = "Départs Restants"
            ElseIf m = 1 Then
                'customLabelValue.Text = arrriveeTotal - arriveeEffectuee
                customLabelValue.Text = nombreArriveeDuJour

                'customLabelValue1.Text = arriveeEffectuee & " / " & arrriveeTotal

                customLabelValue1.Text = nombreArriveeDuJour & " / " & arrriveeTotal

                customLabel.Location = New System.Drawing.Point(30, 60)

                customLabel.Text = "Arrivées Restantes"

            ElseIf m = 2 Then

                customLabel.Location = New System.Drawing.Point(20, 60)
                customLabelValue.Text = nombreDeChambreOccupee

                customLabelValue1.Text = nombreDeChambreOccupee & " / " & nombreTotalDeChambre

                customLabel.Text = "Chambres occupées"

            ElseIf m = 3 Then
                customLabelValue.Text = nombreDeChambreLibre

                customLabelValue1.Text = nombreDeChambreLibre & " / " & nombreTotalDeChambre

                customLabel.Location = New System.Drawing.Point(40, 60)

                customLabel.Text = "Chambres libres"
            End If

            customPanel.Controls.Add(customLabel)
            customPanel.Controls.Add(customLabelValue)
            customPanel.Controls.Add(customLabelValue1)

            GunaGroupBoxStatistiques.Controls.Add(customPanel)

            yValue += 142

        Next

        'CREATION DU STATUT DES CHAMBRES

        Dim roomList As New Room()
        Dim Room As DataTable = roomList.roomsOnly()

        Dim sale As Integer = 0
        Dim propre As Integer = 0
        Dim horsService As Integer = 0
        Dim aInspecter As Integer = 0
        Dim enCours As Integer = 0

        If Room.Rows.Count > 0 Then

            For i = 0 To Room.Rows.Count - 1

                If Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Or Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Then
                    'Chambre sale
                    sale += 1
                ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Then
                    propre += 1
                ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Hors Service" Then
                    horsService += 1
                ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Nettoyage" Then
                    'En cours de nettoyage
                    enCours += 1
                ElseIf Room.Rows(i)("ETAT_CHAMBRE_NOTE") = "Attente" Then
                    'Chambre dont le nettoyage est termine et en attente de validation
                    aInspecter += 1
                End If

            Next

        End If

        'GunaProgressBarSale.Maximum = nombreTotalDeChambre
        'GunaProgressBarSale.Value = sale
        'GunaLabelSale.Text = " Sale (" & sale & "/" & nombreTotalDeChambre & ")"

        'GunaProgressBarEncours.Maximum = nombreTotalDeChambre
        'GunaProgressBarEncours.Value = enCours
        'GunaLabelEncours.Text = " En cours (" & enCours & "/" & nombreTotalDeChambre & ")"

        ' GunaProgressBarAinspecter.Maximum = nombreTotalDeChambre
        ' GunaProgressBarAinspecter.Value = aInspecter
        'GunaLabelAinspecter.Text = "A inspecter (" & aInspecter & "/" & nombreTotalDeChambre & ")"

        ' GunaProgressBarPropre.Maximum = nombreTotalDeChambre
        'GunaProgressBarPropre.Value = propre
        'GunaLabelPropre.Text = "Propre (" & propre & "/" & nombreTotalDeChambre & ")"

        ' GunaProgressBarHorsService.Maximum = nombreTotalDeChambre
        ' GunaProgressBarHorsService.Value = horsService
        'GunaLabelHorsService.Text = "Hor service (" & horsService & "/" & nombreTotalDeChambre & ")"

        Dim xValueStatus As Integer = 420
        Dim yValueStatus As Integer = 300
        Dim compteur As Integer = 0

        For m = 0 To 4

            compteur += 1
            Dim customPanel As New Panel
            customPanel.Text = "Test" & m
            customPanel.Name = "a" & m
            customPanel.Location = New Point(xValueStatus, yValueStatus)

            If m = 0 Then
                customPanel.BackColor = Color.Red
            ElseIf m = 3 Then
                customPanel.BackColor = Color.Green
            ElseIf m = 2 Then
                customPanel.BackColor = Color.Orange
            ElseIf m = 1 Then
                customPanel.BackColor = Color.OrangeRed
            ElseIf m = 4 Then
                customPanel.BackColor = Color.Black
            End If

            customPanel.ForeColor = Color.White
            'customPanel.Size = New Size(75, 103)
            customPanel.Size = New Size(130, 30)
            customPanel.Anchor = AnchorStyles.None


            Dim customLabel As New Label
            customLabel.BringToFront()
            customLabel.AutoSize = True
            customLabel.ForeColor = Color.White
            customLabel.Font = New System.Drawing.Font("Segoe UI", 11.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(0, Byte))

            customLabel.Name = "customLabelDashboard"
            customLabel.Size = New System.Drawing.Size(75, 15)
            customLabel.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabel.TabIndex = 4

            Dim customLabelValue As New Label

            customLabelValue.AutoSize = True
            customLabelValue.ForeColor = Color.White
            customLabelValue.Font = New System.Drawing.Font("Segoe UI", 12.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
            customLabelValue.Location = New System.Drawing.Point(332, 378)
            customLabelValue.Name = "customLabelDashBoardValue"
            customLabelValue.Size = New System.Drawing.Size(15, 80)
            customLabelValue.TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            customLabelValue.TabIndex = 4

            'Gestion de l'etat en plus du nombre
            If m = 0 Then

                customLabelValue.Text = "(" & sale & ")"
                customLabel.BackColor = Color.Red
                customLabelValue.BackColor = Color.Red
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)
                If sale > 0 Then
                    customLabel.Text = "Sales"
                Else
                    customLabel.Text = "Sale"
                End If

            ElseIf m = 3 Then
                customLabel.BackColor = Color.Green
                customLabelValue.BackColor = Color.Green
                customLabelValue.Text = "(" & propre & ")"
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)
                If propre > 0 Then
                    customLabel.Text = "Propres"
                Else
                    customLabel.Text = "Propre"
                End If

            ElseIf m = 2 Then
                customLabel.BackColor = Color.Orange
                customLabelValue.BackColor = Color.Orange
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)
                customLabelValue.Text = "(" & aInspecter & ")"
                If aInspecter > 0 Then
                    customLabel.Text = "A inspecters"
                Else
                    customLabel.Text = "A inspecter"
                End If

            ElseIf m = 1 Then
                customLabelValue.Text = "(" & enCours & ")"
                customLabel.BackColor = Color.OrangeRed
                customLabelValue.BackColor = Color.OrangeRed
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)
                If enCours > 0 Then
                    customLabel.Text = "En cours"
                Else
                    customLabel.Text = "En cours"
                End If

            ElseIf m = 4 Then
                customLabelValue.BackColor = Color.Black
                customLabel.BackColor = Color.Black
                customLabelValue.Text = "(" & horsService & ")"
                customLabel.Location = New System.Drawing.Point(xValueStatus + 40, yValueStatus + 5)
                'customLabelValue.Location = New System.Drawing.Point(xValueStatus, yValueStatus + 2)
                If horsService > 0 Then
                    customLabel.Text = "Hors services"
                Else
                    customLabel.Text = "Hors service"
                End If

            End If




            'customPanel.BringToFront()
            'GunaShadowPanel4.Controls.Add(customLabel)
            'GunaShadowPanel4.Controls.Add(customLabelValue)

            'GunaShadowPanel4.Controls.Add(customPanel)
            'GunaShadowPanel4.BringToFront()

            xValueStatus += 140

            If compteur Mod 2 = 0 Then

                xValueStatus = 420

                yValueStatus += 42

            End If
        Next


    End Sub


    Public Sub StatusDesChambres()

        Dim roomList As New Room()
        Dim rooms As DataTable = roomList.roomsOnly()

        Dim xValue As Integer = 0
        Dim yValue As Integer = 0

        If rooms.Rows.Count > 0 Then

            For i As Integer = 0 To rooms.Rows.Count - 1 Step 1

                Dim nomCLient As String = ""
                Dim emailCLient As String = ""

                Dim toolTip As New ToolTip()

                Dim buttonColor As Color
                Dim ClientInRoom As DataTable
                ' --------------------------------------------------------------------------------------------
                Dim customPanel As New Panel
                customPanel.Text = "Test" & i
                customPanel.Name = "a" & i
                customPanel.Location = New Point(50 + xValue, 37 + yValue)
                customPanel.BackColor = Color.White
                'customPanel.Size = New Size(75, 103)
                customPanel.Size = New Size(60, 75)
                customPanel.Anchor = AnchorStyles.None

                'Dim customPictureBox = New Guna.UI.WinForms.GunaCirclePictureBox
                Dim customPictureBox = New PictureBox

                'customPictureBox.BaseColor = System.Drawing.Color.White
                If rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Then
                    'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.ROOM_STATE_FREE
                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Then
                    'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.ROOM_STATE_FREE_SALE
                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Then
                    'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.ROOM_STATE_OCCUPIED
                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.RESERVEE

                    Dim reservationConfirmee As DataTable = Functions.GetAllElementsOnTwoConditions(rooms.Rows(i)("CODE_CHAMBRE"), "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION")

                    'La chambre étant occupé on va chercher sa réservation
                    If reservationConfirmee.Rows.Count > 0 Then
                        'On affiche le bouton du check out

                        If reservationConfirmee.Rows.Count > 0 Then

                            If reservationConfirmee.Rows(0)("DATE_ENTTRE") <= GlobalVariable.DateDeTravail Or reservationConfirmee.Rows(0)("DATE_SORTIE") >= GlobalVariable.DateDeTravail Then
                                If reservationConfirmee.Rows(0)("DATE_SORTIE") = GlobalVariable.DateDeTravail Then
                                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.CHECK_OUT
                                Else
                                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.OCCUPIED
                                End If
                            Else
                                customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                                'AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                            End If

                        End If

                    Else

                        Dim reservation As DataTable = Functions.GetAllElementsOnTwoConditions(rooms.Rows(i)("CODE_CHAMBRE"), "reservation", "CHAMBRE_ID", 0, "ETAT_RESERVATION")

                        If reservation.Rows.Count > 0 Then

                            If reservation.Rows(0)("DATE_ENTTRE") = GlobalVariable.DateDeTravail Then
                                customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.RESERVEE
                            Else
                                customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                                'AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                            End If

                        Else

                            customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                            AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick

                        End If


                        'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.OCCUPIED

                    End If

                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Then
                    'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.ROOM_STATE_OCCUPIED_SALE
                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.RESERVEE
                    'La chambre étant occupé on va chercher sa réservation
                    Dim reservationConfirmee As DataTable = Functions.GetAllElementsOnTwoConditions(rooms.Rows(i)("CODE_CHAMBRE"), "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION")

                    If reservationConfirmee.Rows.Count > 0 Then
                        'On affiche le bouton du check out
                        If reservationConfirmee.Rows(0)("DATE_ENTTRE") <= GlobalVariable.DateDeTravail Or reservationConfirmee.Rows(0)("DATE_SORTIE") >= GlobalVariable.DateDeTravail Then
                            If reservationConfirmee.Rows(0)("DATE_SORTIE") = GlobalVariable.DateDeTravail Then
                                customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.CHECK_OUT
                            Else
                                customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.OCCUPIED
                            End If
                        Else
                            customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                            'AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick
                        End If

                    End If

                    AddHandler customPictureBox.DoubleClick, AddressOf onDoubleClick

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Hors Service" Then
                    'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.ROOM_STATE_HORS
                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.MAINTENANCE
                Else
                    'customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.ROOM_STATE_FREE
                    customPictureBox.Image = Global.BarclesHSoft.My.Resources.Resources.FREE_ROOM
                End If

                'customPictureBox.Location = New System.Drawing.Point(3, 18)
                customPictureBox.Location = New System.Drawing.Point(3, 0)
                customPictureBox.Name = rooms.Rows(i)("CODE_CHAMBRE")
                customPictureBox.Size = New System.Drawing.Size(50, 50)
                customPictureBox.SizeMode = System.Windows.Forms.PictureBoxSizeMode.Zoom
                customPictureBox.TabIndex = 2
                customPictureBox.TabStop = False
                'customPictureBox.UseTransfarantBackground = False

                customPanel.Controls.Add(customPictureBox)

                If rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Then

                    buttonColor = Color.Green
                    toolTip.ToolTipTitle = rooms.Rows(i)("CODE_CHAMBRE")
                    toolTip.SetToolTip(customPictureBox, rooms.Rows(i)("ETAT_CHAMBRE_NOTE"))

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or rooms.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Then

                    buttonColor = Color.Orange
                    toolTip.ToolTipTitle = rooms.Rows(i)("CODE_CHAMBRE")
                    toolTip.SetToolTip(customPictureBox, rooms.Rows(i)("ETAT_CHAMBRE_NOTE"))

                ElseIf rooms.Rows(i)("ETAT_CHAMBRE") = 1 Or rooms.Rows(i)("ETAT_CHAMBRE") = 5 Then
                    buttonColor = Color.Red
                    toolTip.ToolTipTitle = rooms.Rows(i)("CODE_CHAMBRE")
                    toolTip.SetToolTip(customPictureBox, rooms.Rows(i)("ETAT_CHAMBRE_NOTE"))
                End If

                GunaGroupBoxRoomStatus.Controls.Add(customPanel)

                Dim customLabel As New Label

                customLabel.AutoSize = True
                customLabel.Font = New System.Drawing.Font("Segoe UI", 12.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(0, Byte))
                'customLabel.Location = New System.Drawing.Point(13, 0)
                customLabel.Location = New System.Drawing.Point(13, 48)
                customLabel.Name = "customLabel"
                customLabel.Size = New System.Drawing.Size(37, 21)
                customLabel.TabIndex = 4
                customLabel.Text = rooms.Rows(i)("CODE_CHAMBRE")

                customPanel.Controls.Add(customLabel)

                Dim customButton As New Guna.UI.WinForms.GunaCircleButton()

                customButton.AnimationHoverSpeed = 0.07!
                customButton.AnimationSpeed = 0.03!
                customButton.BaseColor = buttonColor
                customButton.BorderColor = System.Drawing.Color.Black
                customButton.DialogResult = System.Windows.Forms.DialogResult.None
                customButton.FocusedColor = System.Drawing.Color.Empty
                customButton.Font = New System.Drawing.Font("Segoe UI", 9.0!)
                customButton.ForeColor = System.Drawing.Color.White
                customButton.Image = Nothing
                customButton.ImageSize = New System.Drawing.Size(52, 52)
                customButton.Location = New System.Drawing.Point(29, 83)
                customButton.Name = "GunaCircleButton35" & i
                customButton.OnHoverBaseColor = buttonColor
                customButton.OnHoverBorderColor = buttonColor
                customButton.OnHoverForeColor = System.Drawing.Color.White
                customButton.OnHoverImage = Nothing
                customButton.OnPressedColor = System.Drawing.Color.Black
                customButton.Size = New System.Drawing.Size(15, 16)
                customButton.TabIndex = 3

                'customPanel.Controls.Add(customButton)

                toolTip.ShowAlways = True

                toolTip.UseFading = True
                toolTip.UseAnimation = True
                toolTip.IsBalloon = True
                toolTip.AutoPopDelay = 5000

                xValue = xValue + 70

                If (i + 1) Mod 9 = 0 Then
                    xValue = 0
                    yValue = yValue + 78
                End If

            Next

        End If

    End Sub

    'Gestion du bouton sur lequel on click pour afficher ses informations dans l
    Private Sub onDoubleClick(ByVal sender As Object, ByVal e As System.EventArgs)

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        VidageDesChampsPourNouvelleReservation()

        Dim customPictureBox = CType(sender, PictureBox)
        LabelNatureReservation.Visible = True
        'Affichage d'une réservaion depuis son icon du dashboard

        'GESTION DES EN CHAMBRES A PARTIR DES ICONS
        If Functions.GetAllElementsOnTwoConditions(customPictureBox.Name, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows.Count > 0 Or Functions.GetAllElementsOnTwoConditions(customPictureBox.Name, "reservation", "CHAMBRE_ID", 0, "ETAT_RESERVATION").Rows.Count > 0 Then

            If Functions.GetAllElementsOnTwoConditions(customPictureBox.Name, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows.Count > 0 Then
                GlobalVariable.codeReservationToUpdate = Functions.GetAllElementsOnTwoConditions(customPictureBox.Name, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows(0)("CODE_RESERVATION")
                LabelNatureReservation.Text = "EN CHAMBRE"
            ElseIf Functions.GetAllElementsOnTwoConditions(customPictureBox.Name, "reservation", "CHAMBRE_ID", 0, "ETAT_RESERVATION").Rows.Count > 0 Then
                GlobalVariable.codeReservationToUpdate = Functions.GetAllElementsOnTwoConditions(customPictureBox.Name, "reservation", "CHAMBRE_ID", 0, "ETAT_RESERVATION").Rows(0)("CODE_RESERVATION")
                LabelNatureReservation.Text = "EN COURS"
            End If

            'We first search in reservation 
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reservation", "CODE_RESERVATION")

            If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                'not found in reservation so, we search in reserve_conf
                GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

                If Not GlobalVariable.ReservationToUpdate.Rows.Count > 0 Then
                    GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_temp", "CODE_RESERVATION")
                End If

            End If

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")
            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate


            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            End If

            TabControlHbergement.SelectedIndex = 0

            'Affecting values mostly for calculations
            affectingValuesToFields()

            GunaDataGridViewRoomType.Visible = False

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

        Else

            'RESERVATION D'UNE CHAMBRE A PARTIR DES ICONS
            Dim infoChambrePourReservation As DataTable = Functions.getElementByCode(customPictureBox.Name, "chambre", "CODE_CHAMBRE")

            If infoChambrePourReservation.Rows.Count > 0 Then

                Dim infoTypeDeChambrePourReservation As DataTable = Functions.getElementByCode(infoChambrePourReservation.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                If infoTypeDeChambrePourReservation.Rows.Count > 0 Then

                    GunaTextBoxCodeTypeDeChambre.Text = infoChambrePourReservation.Rows(0)("CODE_TYPE_CHAMBRE")
                    GunaTextBoxLibelleTYpe.Text = infoTypeDeChambrePourReservation.Rows(0)("LIBELLE_TYPE_CHAMBRE")

                    Dim prix As Double = 0
                    Double.TryParse(infoTypeDeChambrePourReservation.Rows(0)("PRIX"), prix)
                    GunaTextBoxpPrixAffiche.Text = Format(prix, "#,##0")
                    GunaTextBoxMontantAccorde.Text = Format(prix, "#,##0")

                End If

                'On n'a le numéro de chambre alors seulement on pourra remplir les inforamtion de la chambre
                GunaTextBoxNumeroChambre.Text = infoChambrePourReservation.Rows(0)("CODE_CHAMBRE")
                GunaTextBoxLibelleChambre.Text = infoChambrePourReservation.Rows(0)("LOCALISATION")
                'GunaTextBoxLibelleChambre.Text = infoChambrePourReservation.Rows(0)("LIBELLE_CHAMBRE")



            End If

        End If

        GunaComboBoxHeureArrivee.selectedItem = "120000"
        GunaComboBoxHeureDepart.selectedItem = "120000"

        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

        TabControlHbergement.SelectedIndex = 0

        GunaDataGridViewRoomType.Visible = False
        GunaDataGridViewRoom.Visible = False


    End Sub

    'Rafraichissement du stauts des chambres
    Private Sub RafraichirToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles RafraichirToolStripMenuItem.Click
        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        elementsDesChambres()
        contenuStatistique()
        StatistiquesDesChambres()
        StatusDesChambres() 'Icon des chambres au niveau du dashboard
    End Sub

    '-------------------------------------- GESTION DE PANNEAU DE DROITE

    Public Sub elementsDesChambres()

        Dim room As New Room()

        Dim Total As Integer = Functions.getElementByCode("chambre", "chambre", "TYPE").Rows.Count

        GunaCircleProgressBar1.Maximum = Total

        GunaCircleProgressBar2.Maximum = Total
        GunaCircleProgressBar3.Maximum = Total
        GunaCircleProgressBar4.Maximum = Total

        Dim nombreDeChambreOccupeePropre As Integer = Functions.getElementByCode("Occupée propre", "chambre", "ETAT_CHAMBRE_NOTE").Rows.Count()
        Dim nombreDeChambreOccupeeSale As Integer = Functions.getElementByCode("Occupée sale", "chambre", "ETAT_CHAMBRE_NOTE").Rows.Count()

        Dim nombreDeChambreLibrePropre As Integer = Functions.getElementByCode("Libre propre", "chambre", "ETAT_CHAMBRE_NOTE").Rows.Count()
        Dim nombreDeChambreLibreSale As Integer = Functions.getElementByCode("Libre sale", "chambre", "ETAT_CHAMBRE_NOTE").Rows.Count()
        Dim nombreDeHorService As Integer = Functions.getElementByCode("Hors Service", "chambre", "ETAT_CHAMBRE_NOTE").Rows.Count()

        'Dim chambreTotalOccupee As Integer = Total - (nombreDeChambreLibrePropre + nombreDeChambreLibreSale + nombreDeHorService)
        Dim chambreTotalOccupee As Integer = nombreDeChambreOccupeePropre + nombreDeChambreOccupeeSale
        Dim chambreTotalLibree As Integer = nombreDeChambreLibrePropre + nombreDeChambreLibreSale

        'TauxOccupation 
        GunaCircleProgressBar1.Value = chambreTotalOccupee

        With RoomStatChart

            Dim dataSet As DataSet = New DataSet()
            Dim dt As DataTable = New DataTable()
            dt.Columns.Add("Text", GetType(String))
            dt.Columns.Add("Value", GetType(Integer))

            Dim rooms As DataTable = room.roomsOnly()
            Dim roomTypes As DataTable = Functions.GetAllElementsOnCondition("chambre", "type_chambre", "TYPE")

            For i = 0 To roomTypes.Rows.Count - 1

                Dim nombreDeChambreDUnCertainType As DataTable = Functions.getElementByCode(roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), "chambre", "CODE_TYPE_CHAMBRE")

                If nombreDeChambreDUnCertainType.Rows.Count > 0 Then
                    Total = nombreDeChambreDUnCertainType.Rows.Count
                End If

                Dim nombreDeChambreOccupeeSaleParType As Integer = Functions.GetAllElementsOnTwoConditions("Occupée sale", "chambre", "ETAT_CHAMBRE_NOTE", roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), "CODE_TYPE_CHAMBRE").Rows.Count()

                Dim nombreDeChambreOccupeePropreParType As Integer = Functions.GetAllElementsOnTwoConditions("Occupée propre", "chambre", "ETAT_CHAMBRE_NOTE", roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), "CODE_TYPE_CHAMBRE").Rows.Count()

                Dim Pourcetage As Double = Math.Round((nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType) * 100 / Total, 0)

                dt.Rows.Add(roomTypes.Rows(i)("CODE_TYPE_CHAMBRE"), Pourcetage)

                If i = 0 Then
                    GunaCircleProgressBar2.Maximum = Total
                    GunaCircleProgressBar2.Value = nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType
                    GunaTextBoxProgBar1.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                ElseIf i = 1 Then
                    GunaCircleProgressBar3.Maximum = Total
                    GunaCircleProgressBar3.Value = nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType
                    GunaTextBoxProgBar2.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                ElseIf i = 2 Then
                    GunaCircleProgressBar4.Maximum = Total
                    GunaCircleProgressBar4.Value = nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType
                    GunaTextBoxProgBar3.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                ElseIf i = 3 Then
                    GunaCircleProgressBar5.Visible = True
                    GunaCircleProgressBar5.Maximum = Total
                    GunaCircleProgressBar5.Value = nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType
                    GunaTextBox1.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                    GunaTextBox1.Visible = True
                ElseIf i = 4 Then
                    GunaCircleProgressBar6.Visible = True
                    GunaCircleProgressBar6.Maximum = Total
                    GunaCircleProgressBar6.Value = nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType
                    GunaTextBox2.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                    GunaTextBox2.Visible = True
                ElseIf i = 5 Then
                    GunaCircleProgressBar7.Visible = True
                    GunaCircleProgressBar7.Maximum = Total
                    GunaCircleProgressBar7.Value = nombreDeChambreOccupeeSaleParType + nombreDeChambreOccupeePropreParType
                    GunaTextBox3.Visible = True
                    GunaTextBox3.Text = roomTypes.Rows(i)("CODE_TYPE_CHAMBRE")
                End If



            Next

            dataSet.Tables.Add(dt)
            RoomStatChart.DataSource = dataSet.Tables(0)
            'ChartRevenuParFamille.Width = 380
            'ChartRevenuParFamille.Height = 209
            .Series("Series1").BorderColor = Color.FromArgb(164, 164, 164)
            '.Series("Series1").ChartType = SeriesChartType.Doughnut
            .Series("Series1").BorderDashStyle = ChartDashStyle.Solid
            .Series("Series1").BorderWidth = 1
            .Series("Series1").ShadowOffset = 1
            .Series("Series1").IsValueShownAsLabel = True
            .Series("Series1").XValueMember = "Text"
            .Series("Series1").YValueMembers = "Value"
            .Series("Series1").LabelFormat = "#,##0.0"
            '.Series("Series1").Font = New Font("Tahoma", 14.0F)
            .Series("Series1").BackSecondaryColor = Color.Transparent
            .Series("Series1").LabelForeColor = Color.Black
            .Series(0).Color = Color.Red
            .Series("Series1").LegendText = "#VALX (#PERCENT)"

            '.Series.Clear()
            '.ChartAreas(0).AxisX.MajorGrid.Enabled = False
            '.ChartAreas(0).AxisY.MajorGrid.Enabled = False
            '.DataSource = room.roomStatistics()
            '.Series("Series1").XValueMember = "TYPE CHAMBRE"
            '.Series("Series1").YValueMembers = "Total"
            '.Series("Series1").IsValueShownAsLabel = True
            '.Series("Series1").LegendText = "#VALX (#PERCENT)"
            '.Series("Series1")("PieLabelStyle") = "DISABLED"
            '.Series("Series1").LabelFormat = "#,##0.00"

        End With

        If GlobalVariable.societe.Rows(0)("CODE_MONNAIE") = "" Then

            Dim societe As DataTable = Functions.allTableFields("societe")

            If societe.Rows.Count > 0 Then
                GunaLabelSymboleMonnaie.Text = societe.Rows(0)("CODE_MONNAIE")
            End If

        End If




        GunaLabelSymboleMonnaie.Text = GlobalVariable.societe.Rows(0)("CODE_MONNAIE")
        'GunaLabelRevenuTotal.Text = "25 000"

        'On Affiche toute reservation dont la date d'entree figure entre les deux dates saisies
        Dim query As String = "SELECT * FROM main_courante_journaliere WHERE DATE_MAIN_COURANTE >= '" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "' AND DATE_MAIN_COURANTE <='" & GlobalVariable.DateDeTravail.ToString("yyyy-MM-dd") & "' AND ETAT_MAIN_COURANTE =@ETAT_MAIN_COURANTE"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
                command.Parameters.Add("@ETAT_MAIN_COURANTE", MySqlDbType.VarChar).Value = 0
                'command.Parameters.Add("@ETAT_RESERVATION", MySqlDbType.Int32).Value = 0

                Dim adapter As New MySqlDataAdapter(command)
                Dim table As New DataTable()
                adapter.Fill(table)

                Dim hebergement As Double = 0
                Dim barRestau As Double = 0
                Dim autre As Double = 0

                If table.Rows.Count > 0 Then

                    For i = 0 To table.Rows.Count - 1

                        hebergement += Double.Parse(table.Rows(i)("MONTANT_ACCORDE"))
                        barRestau += Double.Parse(table.Rows(i)("BAR_RESTAURANT"))
                        autre += Double.Parse(table.Rows(i)("SERVICES")) + Double.Parse(table.Rows(i)("BOUTIQE")) + Double.Parse(table.Rows(i)("CYBERCAFE")) + Double.Parse(table.Rows(i)("AUTRES"))

                    Next

                End If

        Dim grandTotal As Double = 0
        grandTotal = hebergement + barRestau + autre

        If Not grandTotal = 0 Then
            GunaGauge1.Value = Math.Round((hebergement / grandTotal) * 100, 0)
            GunaGauge2.Value = (barRestau / grandTotal) * 100
            GunaGauge3.Value = (autre / grandTotal) * 100
        Else
            GunaGauge1.Value = 0
            GunaGauge2.Value = 0
            GunaGauge3.Value = 0
        End If

        GunaLabelRevenuTotal.Text = Format(grandTotal, "#,##0")
        GunaTextBoxHebergement.Text = Format(hebergement, "#,##0")
        GunaTextBox8.Text = Format(barRestau, "#,##0")
        GunaTextBox9.Text = Format(autre, "#,##0")

        With ChartRevenuParFamille

            Dim dataSet As DataSet = New DataSet()
            Dim dt As DataTable = New DataTable()
            dt.Columns.Add("Text", GetType(String))
            dt.Columns.Add("Value", GetType(Integer))
            dt.Rows.Add("HEBERGEMENT", hebergement)
            dt.Rows.Add("BAR-RESTAURANT", barRestau)
            dt.Rows.Add("AUTRES", autre)
            dataSet.Tables.Add(dt)
            ChartRevenuParFamille.DataSource = dataSet.Tables(0)
            'ChartRevenuParFamille.Width = 380
            'ChartRevenuParFamille.Height = 209
            .Series("Series1").BorderColor = Color.FromArgb(164, 164, 164)
            .Series("Series1").ChartType = SeriesChartType.Doughnut
            .Series("Series1").BorderDashStyle = ChartDashStyle.Solid
            .Series("Series1").BorderWidth = 1
            .Series("Series1").ShadowOffset = 1
            .Series("Series1").IsValueShownAsLabel = True
            .Series("Series1").XValueMember = "Text"
            .Series("Series1").YValueMembers = "Value"
            .Series("Series1").LabelFormat = "#,##0.0"
            '.Series("Series1").Font = New Font("Tahoma", 14.0F)
            .Series("Series1").BackSecondaryColor = Color.Transparent
            .Series("Series1").LabelForeColor = Color.Black
            .Series(0).Color = Color.Red
            .Series("Series1").LegendText = "#VALX"

                End With

                Dim roomList As New Room()
                Dim RoomOnly As DataTable = roomList.roomsOnly()
                Dim nombreTotalDeChambre As Integer = RoomOnly.Rows.Count

                Dim sale As Integer = 0
                Dim propre As Integer = 0
                Dim horsService As Integer = 0
                Dim aInspecter As Integer = 0
                Dim enCours As Integer = 0

                If RoomOnly.Rows.Count > 0 Then

                    For i = 0 To RoomOnly.Rows.Count - 1

                        If RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée sale" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre sale" Then
                            'Chambre sale
                            sale += 1
                        ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Occupée propre" Or RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Libre propre" Then
                            propre += 1
                        ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Hors Service" Then
                            horsService += 1
                        ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Nettoyage" Then
                            'En cours de nettoyage
                            enCours += 1
                        ElseIf RoomOnly.Rows(i)("ETAT_CHAMBRE_NOTE") = "Attente" Then
                            'Chambre dont le nettoyage est termine et en attente de validation
                            aInspecter += 1
                        End If

                    Next

                End If

                GunaProgressBarSale.Maximum = nombreTotalDeChambre
                GunaProgressBarSale.Value = sale
                GunaLabelSale.Text = " Sale (" & sale & "/" & nombreTotalDeChambre & ")"

                GunaProgressBarEncours.Maximum = nombreTotalDeChambre
                GunaProgressBarEncours.Value = enCours
                GunaLabelEncours.Text = " En cours (" & enCours & "/" & nombreTotalDeChambre & ")"

                GunaProgressBarAinspecter.Maximum = nombreTotalDeChambre
                GunaProgressBarAinspecter.Value = aInspecter
                GunaLabelAinspecter.Text = "A inspecter (" & aInspecter & "/" & nombreTotalDeChambre & ")"

                GunaProgressBarPropre.Maximum = nombreTotalDeChambre
                GunaProgressBarPropre.Value = propre
                GunaLabelPropre.Text = "Propre (" & propre & "/" & nombreTotalDeChambre & ")"

                GunaProgressBarHorsService.Maximum = nombreTotalDeChambre
                GunaProgressBarHorsService.Value = horsService
                GunaLabelHorsService.Text = "Hor service (" & horsService & "/" & nombreTotalDeChambre & ")"

    End Sub

    '-------------------------------------END DASH BOARD -------------------------------------------

    '------------------------------------- MODULE RESERVATION --------------------------------------------------------
    'PANNEAU DU MODULE RESERVATION
    Private Sub BarRestaurationToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles BarRestaurationToolStripMenuItem.Click

        'FacturationForm.GunaLabelHeader.Text = "AU COMPTANT"
        'FacturationForm.TopMost = True
        'FacturationForm.Location = New System.Drawing.Point(10, 110)
        'FacturationForm.Show()

        MainWindowBarRestaurantForm.Show()

        Me.Hide()

    End Sub

    '------------------------------------- MODULE RECEPTION --------------------------------------------------------
    'PANNEAU DU MODULE RECEPTION
    Private Sub ReceptionToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ReceptionToolStripMenuItem.Click 'RECEPTION

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        GunaShadowPanelReception.Show()
        PanelTableauDeBords.Show()

        GunaShadowPanelReservation.Hide()
        PanelEnregistrement.Hide()

    End Sub

    'PANNEAU DU MODULE RESERVATION
    Private Sub RESERVATIONToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles RESERVATIONToolStripMenuItem.Click

        TabControlHbergement.SelectedIndex = 1

        GunaShadowPanelReservation.Show()
        PanelEnregistrement.Show()

        PanelTableauDeBords.Hide()
        GunaShadowPanelReception.Hide()

    End Sub

    'PANNEAU DU MODULE RECEPTION
    Private Sub SERVICEDETAGEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles SERVICEDETAGEToolStripMenuItem.Click

        GlobalVariable.typeChambreOuSalle = "chambre"

        'RoomForm.TopMost = True
        'RoomForm.Location = New System.Drawing.Point(10, 110)
        'RoomForm.Show()

        MainWindowServiceEtageForm.Visible = True

        Me.Visible = False

    End Sub

    'PANNEAU DU MODULE COMPTABILITE
    Private Sub ComptabilitéToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ComptabilitéToolStripMenuItem.Click

        MainWindowComptabiliteForm.Visible = True

        Me.Visible = False

    End Sub

    'PANNEAU DU MODULE ECONOMAT
    Private Sub ECONOMATToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ECONOMATToolStripMenuItem.Click

        MainWindowEconomat.Show()

        Me.Visible = False

    End Sub

    'GESTION DES BOUTONS DU MENU RECEPTION
    'EN CHAMBRE
    Private Sub GunaAdvenceButton13_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton13.Click
        TabControlHbergement.SelectedIndex = 3
        PanelTableauDeBords.Hide()
        PanelEnregistrement.BringToFront()
        PanelEnregistrement.Show()
        PanelPlanning.Hide()

    End Sub

    'FACTURATION
    Private Sub GunaAdvenceButton21_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton21.Click
        PanelTableauDeBords.Hide()
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
        PanelPlanning.Hide()
        TabControlHbergement.SelectedIndex = 0
        TabControlGestionReservation.SelectedIndex = 1
    End Sub

    'ARRIVEES
    Private Sub GunaAdvenceButton27_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton27.Click
        TabControlHbergement.SelectedIndex = 2
        PanelTableauDeBords.Hide()
        PanelEnregistrement.Show()
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()
        PanelPlanning.Hide()

    End Sub

    'ATTRIBUER CHAMBRE
    Private Sub GunaAdvenceButton14_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton14.Click

        TabControlHbergement.SelectedIndex = 2
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    ' MODULE DE RESERVATION 
    'CARDEX
    Private Sub GunaAdvenceButton6_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton6.Click
        ClientForm.Show()
    End Sub

    Public Sub VidageDesChampsPourNouvelleReservation()

        'REINISIALISATION DES BOUTONS DE GESTION DES RESERVATIONDE GROUPE
        If GunaCheckBoxReservationDeGroupe.Checked Then

            GunaCheckBoxReservationDeGroupe.Checked = False

            EtatDuBoutonDeGestionDesReservationDeGroupe()

            GunaLabelNumReservation.Text = ""

        End If

        'CHECK BOXE TAXE SEJOUR COLLECTE ET PETIT DEJEUENER
        GunaCheckBoxTaxeSejour.Checked = False
        GunaTextBoxTaxeSejour.Visible = False

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaTextBoxPetitDejeuner.Visible = False

        'Document du front desk
        GunaDataGridViewDesFactures.Columns.Clear()
        GunaDataGridViewListeDesReglement.Columns.Clear()

        'Instruction de routage
        GunaCheckBoxPetitDejRoutage.Checked = False
        GunaCheckBoxChambreRoutage.Checked = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False
        GunaTextBoxPrixChambreRoutage.Visible = False

        Functions.ClearTextBox(Me)
        GunaLabelSolde.Text = 0
        GunaLabelSolde.ForeColor = Color.Black

        GunaLabelNumReservation.Text = ""

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        ReinitialisationDesDates()

        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

        'Initialisation du nombre de personne
        GunaTextBoxNbreAdulte.Text = 1
        GunaTextBoxNbrePersonne.Text = GunaTextBoxNbreAdulte.Text
        GunaTextBoxNbreEnfant.Text = 0

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaCheckBoxTaxeSejour.Checked = False

    End Sub

    'NOUVELLE RESERVATION
    Private Sub GunaAdvenceButton5_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton5.Click

        TabControlHbergement.SelectedIndex = 0

        VidageDesChampsPourNouvelleReservation()

        TabControlHbergement.SelectedIndex = 0
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    'MODIFIER RESERVATION
    Private Sub GunaAdvenceButton4_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton4.Click

        TabControlHbergement.SelectedIndex = 1
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    'TOP LEVEL MENU
    Private Sub TarifsToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles TarifsToolStripMenuItem.Click
        TarifForm.Show()
    End Sub

    'SOCIETE
    Private Sub ToolStripMenuItem133_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem133.Click
        CompanyForm.Show()

    End Sub

    'AGENCE
    Private Sub ToolStripMenuItem134_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem134.Click
        AgencyForm.Show()
    End Sub

    'UTILISATEUR
    Private Sub ToolStripMenuItem136_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem136.Click
        UserForm.TopMost() = True
        UserForm.Show()
    End Sub

    'FACTURATIONDES EN CHAMBRES
    Private Sub GunaAdvenceButton3_Click(sender As Object, e As EventArgs)
        'FacturationForm.Close()
        'GlobalVariable.typeDeClientAFacturer = "en chambre"
        'Par défaut la facturation se fait dans le bar
        'GlobalVariable.ArticleFamily = "BAR"
        'FacturationForm.TopMost = True
        'FacturationForm.Location = New System.Drawing.Point(10, 104)
        'FacturationForm.Show()
    End Sub

    'FACTURATION DES¨PAYMASTER
    Private Sub GunaAdvenceButtonPayMaster_Click(sender As Object, e As EventArgs)
        'FacturationForm.Close()
        'GlobalVariable.typeDeClientAFacturer = "paymaster"
        'Par défaut la facturation se fait dans le bar
        'GlobalVariable.ArticleFamily = "BAR"
        'FacturationForm.TopMost = True
        'FacturationForm.Location = New System.Drawing.Point(10, 104)
        'FacturationForm.Show()

    End Sub

    'FACTURATION DES CLIENT COMPTOIRES
    Private Sub GunaAdvenceButtonAuComptant_Click(sender As Object, e As EventArgs)
        'FacturationForm.Close()
        'GlobalVariable.typeDeClientAFacturer = "comptoire"
        'Par défaut la facturation se fait dans le bar
        'GlobalVariable.ArticleFamily = "BAR"
        'FacturationForm.TopMost = True
        'FacturationForm.Location = New System.Drawing.Point(10, 104)
        'FacturationForm.Show()

    End Sub

    'LECTURE DE LA CARTE

    '--------------- GESTION D'ENCODAGES

    Private Declare Function StartSession Lib "LockDll.Dll" (ByVal Software As Integer, ByVal DBServer As String, ByVal LogUser As String, ByVal DBFlag As Integer) As Integer
    Private Declare Function EndSession Lib "LockDll.Dll" () As Integer
    Private Declare Function ChangeLogUser Lib "LockDll.Dll" (ByVal LogUser As String) As Integer

    Private Declare Function NewKey Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal breakfast As Integer, ByVal overflag As Integer, ByVal CardNo As Integer) As Integer
    Private Declare Function AddKey Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal breakfast As Integer, ByVal overflag As Integer, ByVal CardNo As Integer) As Integer
    Private Declare Function DupKey Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal breakfast As Integer, ByVal overflag As Integer, ByVal CardNo As Integer) As Integer

    'Private Declare Function ReadKeyCard Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Gate As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal CardNo As Integer, ByVal ByValCardStatus As Integer, ByVal breakfast As Integer) As Integer

    Private Declare Function ReadKeyCard Lib "LockDll.Dll" (ByVal Port As Integer, ByVal RoomNo As String, ByVal Door As String, ByVal Floor As String, ByVal TimeStr As String, ByVal Holder As String, ByVal IDNo As String, ByVal CardNo As Integer, ByVal ByValCardStatus As Integer, ByVal breakfast As Integer) As Integer

    Private Declare Function EraseKeyCard Lib "LockDll.Dll" (ByVal Port As Integer, ByVal cardno As Integer) As Integer
    Private Declare Function CheckOut Lib "LockDll.Dll" (ByVal RoomNo As String, ByVal CardNo As Integer) As Integer

    'Lecture de la carte du client pour un affichage directe de ses informations

    Public Sub LectureDeCarte()


        'Lecture de la carte du client pour un affichage directe de ses informations

        CB_Software.SelectedIndex = 0
        CB_Port.SelectedIndex = 0
        CB_Breakfast.SelectedIndex = 1
        CB_DB.SelectedIndex = 0
        tb_server.Text = GlobalVariable.AgenceActuelle.Rows(0)("CHEMIN_HOTEL_LOCK_SYSTEM")

        'Demarrage de session
        Dim server As String
        Dim user As String
        Dim LockSoftware As Integer
        Dim lStatus As Integer
        Dim db_flag As Long

        server = tb_server.Text
        user = "DllUser"
        LockSoftware = CB_Software.SelectedIndex + 1

        TB_Result.Text = "Executing..."
        db_flag = CB_DB.SelectedIndex
        TB_Result.Refresh()

        lStatus = StartSession(LockSoftware, server, user, CB_DB.SelectedIndex)
        'lStatus = StartSession(LockSoftware, server, user, db_flag)

        TB_Result.Text = lStatus.ToString("X")

        'Lecture de carte
        Dim lReadStatus As Integer
        Dim Port As Integer
        Dim CardNo As Integer
        Dim CardStatus As Integer
        Dim Breakfast As Integer

        Dim RoomNo As String
        Dim Holder As String
        Dim IDNo As String
        Dim TimeStr As String
        Dim Door As String
        Dim lift As String

        RoomNo = New String("", 64)
        Holder = New String("", 64)
        IDNo = New String("", 64)
        TimeStr = New String("", 64)
        Door = New String("", 128)
        lift = New String("", 128)

        Port = CB_Port.SelectedIndex

        CardNo = 0
        CardStatus = 0
        Breakfast = 0

        TB_Result.Text = "Executing..."
        TB_Result.Refresh()

        lReadStatus = ReadKeyCard(Port, RoomNo, Door, lift, TimeStr, Holder, IDNo, CardNo, CardStatus, Breakfast)

        'TB_Result.Text = Hex(lStatus)
        TB_Result.Text = lReadStatus.ToString("X")

        'lStatus = ReadKeyCard(Port, RoomNo, Door, lift, TimeStr, Holder, IDNo, CardNo, CardStatus, Breakfast)

        'TB_Result.Text = lStatus.ToString("X")

        If (lReadStatus = 0) Then
            TB_CardNo.Text = CardNo.ToString()
            TB_Status.Text = CardStatus.ToString()
            CB_Breakfast.SelectedIndex = Breakfast

            TB_RoomNo.Text = RoomNo.ToString()
            'TB_Holder.Text = Holder.ToString()
            'GunaTextBoxNom_Prenom.Text = Holder.ToString()
            TB_IDNo.Text = IDNo.ToString()
            TB_Time.Text = TimeStr.ToString()
        End If

        'Arret de la session
        Dim lEndStatus As Integer

        TB_Result.Text = "Executing..."

        TB_Result.Refresh()

        lEndStatus = EndSession()

        TB_Result.Text = lStatus.ToString("X")

        'On recherche le numéro de réservation du client en chambre

        If Functions.GetAllElementsOnTwoConditions(TB_RoomNo.Text, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows.Count > 0 Then

            GunaLabelNumReservation.Visible = True
            GunaLabelNumReservation.Text = TB_RoomNo.Text

            'On rempli le panel avant son affichage

            GunaLabelNumReservation.Text = Functions.GetAllElementsOnTwoConditions(TB_RoomNo.Text, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows(0)("CODE_RESERVATION")

            GlobalVariable.codeReservationToUpdate = GunaLabelNumReservation.Text
            GlobalVariable.codeChambreToUpdate = GunaLabelNumReservation.Text

            'We first search in reservation 

            'not found in reservation so, we search in reserve
            GlobalVariable.ReservationToUpdate = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reserve_conf", "CODE_RESERVATION")

            'Variable to print or not checkout button
            GlobalVariable.reserveConfCheckInState = GlobalVariable.ReservationToUpdate(0)("CHECKIN")

            GlobalVariable.codeClientToUpdate = GlobalVariable.ReservationToUpdate(0)("CLIENT_ID")
            GlobalVariable.ClientToUpdate = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "client", "CODE_CLIENT")

            'On selectionne code_main_courante
            Dim tableMainCourante As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante", "CODE_RESERVATION")

            If tableMainCourante.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteToUpdate = tableMainCourante.Rows(0)("CODE_MAIN_COURANTE")
                GlobalVariable.MainCouranteToUpdate = tableMainCourante
            End If

            'On selectionne code_main_courante_generale
            Dim tableMainCouranteGenerale As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_generale", "NUM_RESERVATION")
            If tableMainCouranteGenerale.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteGeneraleToUpdate = tableMainCouranteGenerale.Rows(0)("CODE_MAIN_COURANTE_GENERALE")
                GlobalVariable.MainCouranteGeneraleToUpdate = tableMainCouranteGenerale
            End If

            'On selectionne code_main_courante_journaliere
            Dim tableMainCouranteJournaliere As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "main_courante_journaliere", "NUM_RESERVATION")
            If tableMainCouranteJournaliere.Rows.Count > 0 Then
                GlobalVariable.codeMainCouranteJournaliereToUpdate = tableMainCouranteJournaliere.Rows(0)("CODE_MAIN_COURANTE_JOURNALIERE")
                GlobalVariable.MainCouranteJournaliereToUpdate = tableMainCouranteJournaliere
            End If

            'On selectionne NUM_REGLEMENT
            Dim tableReglement As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "reglement", "CODE_RESERVATION")

            If tableReglement.Rows.Count > 0 Then
                GlobalVariable.codeReglementToUpdate = tableReglement.Rows(0)("NUM_REGLEMENT")
                GlobalVariable.ReglementToUpdate = tableReglement
            End If

            'On selectionne CODE_OCCUPATION_CHAMBRE
            Dim tableOccupationChambre As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "occupation_chambre", "CODE_RESERVATION")
            If tableOccupationChambre.Rows.Count > 0 Then
                GlobalVariable.codeOccupationchambreToUpdate = tableOccupationChambre.Rows(0)("CODE_OCCUPATION_CHAMBRE")
                GlobalVariable.OccupationchambreToUpdate = tableOccupationChambre
            End If

            'On selectionne NUM_FACTURE
            Dim tableFacture As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "facture", "CODE_RESERVATION")

            If tableFacture.Rows.Count > 0 Then

                GlobalVariable.codeFactureToUpdate = tableFacture.Rows(0)("CODE_FACTURE")
                GlobalVariable.FactureToUpdate = tableFacture

            End If

            'On selectionne le compte du client using CODE_COMPTE
            Dim tableCompte As DataTable = Functions.getElementByCode(GlobalVariable.codeClientToUpdate, "compte", "CODE_CLIENT")

            If tableCompte.Rows.Count > 0 Then

                GlobalVariable.codeCompteToUpdate = tableCompte.Rows(0)("NUMERO_COMPTE")
                GlobalVariable.sensDuSoldeDuCompte = tableCompte.Rows(0)("SENS_DU_SOLDE")
                GlobalVariable.CompteToUpdate = tableCompte

            End If

            GlobalVariable.codeChambreToUpdate = GlobalVariable.ReservationToUpdate(0)("CHAMBRE_ID")

            GlobalVariable.ChambreToUpdate = Functions.getElementByCode(GlobalVariable.codeChambreToUpdate, "chambre", "CODE_CHAMBRE")

            'As the two values below can not more be updated when we come from maincouranteReception because of the event leave
            GlobalVariable.codeChambre = GlobalVariable.codeChambreToUpdate

            If GunaRadioButtonSalleFete.Checked Then

                Dim typeChambre As DataTable = Functions.getElementByCode(GlobalVariable.ChambreToUpdate.Rows(0)("CODE_TYPE_CHAMBRE"), "type_chambre", "CODE_TYPE_CHAMBRE")

                GunaTextBoxCapacite.Text = typeChambre.Rows(0)("CAPACITE")
                GunaTextBoxSuperficie.Text = typeChambre.Rows(0)("SUPERFICIE")

                'Gestion des Forfaits de la salle

                Dim Forfait As DataTable = Functions.getElementByCode(GlobalVariable.codeReservationToUpdate, "forfait_salle", "CODE_RESERVATION")

                If Forfait.Rows.Count > 0 Then

                    GunaTextBox35.Text = Forfait.Rows(0)("NBRE__CAFE")
                    GunaTextBoxForfaitCafe.Text = Forfait.Rows(0)("PU_CAFE")
                    GunaTextBox30.Text = Forfait.Rows(0)("NBRE_DEJEUNER")
                    GunaTextBoxForfatiDejeuner.Text = Forfait.Rows(0)("PU_DEJEUNER")
                    GunaTextBox25.Text = Forfait.Rows(0)("NBRE_DINER")
                    GunaTextBoxForfaitDiner.Text = Forfait.Rows(0)("PU_DINER")
                    GunaTextBox13.Text = Forfait.Rows(0)("NBRE_TRAITEUR")
                    GunaTextBoxForfaitTraiteur.Text = Forfait.Rows(0)("PU_TRAITEUR")
                    GunaTextBoxDecoration.Text = Forfait.Rows(0)("DECORATION")

                End If

            Else

            End If

            affectingValuesToFields()

            If Not GlobalVariable.codeReservationToUpdate = "" Then

                GunaLabelNumReservation.Visible = True
                GunaLabelNumReservation.Text = GlobalVariable.codeReservationToUpdate

            End If

            'We hide all the Datagrid used for custom filling

            GunaDataGridViewRoomType.Visible = False
            GunaDataGridViewClient.Visible = False
            GunaDataGridViewRoom.Visible = False
            GunaDataGridViewPhone.Visible = False

            PanelEnregistrement.Show()
            PanelEnregistrement.BringToFront()
            TabControlHbergement.SelectedIndex = 0

        End If

    End Sub

    Private Sub GunaAdvenceButton33_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton33.Click

        LectureDeCarte()

        'GunaTextBoxNomPrenomClient.Text = Functions.GetAllElementsOnTwoConditions(TB_RoomNo.Text, "reserve_conf", "CHAMBRE_ID", 1, "ETAT_RESERVATION").Rows(0)("CLIENT_ID")

    End Sub

    ' REGISTRE
    Private Sub ToolStripMenuItem137_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem137.Click
        RegisterForm.Show()
    End Sub

    'TAXE SEJOURS - CONFIGURATION DU NOMBRE D'HOTEL
    Private Sub ToolStripMenuItem112_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem112.Click
        TaxeSejourForm.Show()
    End Sub

    '--------------------------------------------- GESTION DU LEFT PANEL MENUSTRIP -------------------------------------------
    '-------------------------------------- SESSION
    'CHANGER MOT DE PASSE
    Private Sub ToolStripMenuItem117_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem117.Click
        ChangePasswordForm.Show()
    End Sub

    'QUITTER
    Private Sub ToolStripMenuItem119_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem119.Click

        Dim dialog As DialogResult
        dialog = MessageBox.Show("Voulez-vous vraiment fermer?", "Fermer BarclesHSoft", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        If dialog = DialogResult.No Then
            'e.Cancel = True
        Else

            Dim CODE_UTILISATEUR = GlobalVariable.ConnectedUser(0)("CODE_UTILISATEUR")

            Dim CODE_CAISSE As String = ""

            Dim CAISSE_UTILISATEUR As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

            If CAISSE_UTILISATEUR.Rows.Count > 0 Then

                CODE_CAISSE = CAISSE_UTILISATEUR.Rows(0)("CODE_CAISSE")

            End If

            Dim ETAT_CAISSE As Integer = 0
            Dim caissier As New Caisse()

            caissier.ouvertureFermetureDeCaisse(CODE_CAISSE, ETAT_CAISSE)

            AccueilForm.Show()

            Me.Close()

        End If

    End Sub


    '-------------------------------------- CONFIGURATION ------------------------------------------------------

    'SOURCE DE RESERVATION
    Private Sub ToolStripMenuItem111_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem111.Click
        SourceReservation.TopMost() = True
        SourceReservation.Show()
    End Sub

    'TYPE PERSONNEL
    Private Sub ToolStripMenuItem103_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem103.Click
        TypePersonnelForm.TopMost() = True
        TypePersonnelForm.Show()
    End Sub

    'PERSONNEL
    Private Sub ToolStripMenuItem104_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem104.Click
        PersonnelForm.TopMost() = True
        PersonnelForm.Show()
    End Sub

    'FAMILLE ARTICLE
    Private Sub ToolStripMenuItem82_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem82.Click
        GlobalVariable.typeFamilleOuSousFamille = "famille"
        ArticleFamilyForm.TopMost() = True
        ArticleFamilyForm.Show()
        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 1
        ArticleFamilyForm.Show()
    End Sub

    'SOUS FAMILLE ARTICLE
    Private Sub ToolStripMenuItem83_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem83.Click
        GlobalVariable.typeFamilleOuSousFamille = "sous famille"
        ArticleFamilyForm.TopMost() = True
        ArticleFamilyForm.Show()
        'ArticleGroupForm.Show()
    End Sub

    'ARTICLES
    Private Sub ToolStripMenuItem86_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem86.Click
        GlobalVariable.typeArticle = "article"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
    End Sub

    'MATIERES
    Private Sub MatièresToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles MatièresToolStripMenuItem.Click
        GlobalVariable.typeArticle = "matiere"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
    End Sub

    'CATEGORIE CLIENT
    Private Sub ToolStripMenuItem99_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem99.Click
        ClientCategoryForm.Show()
    End Sub

    'CLIENT
    Private Sub ToolStripMenuItem100_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem100.Click

    End Sub

    'TYPE CHAMBRE
    Private Sub ToolStripMenuItem107_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem107.Click
        GlobalVariable.typeChambreOuSalle = "chambre"
        RoomTypeForm.Show()
    End Sub

    'TYPE SALLE
    Private Sub ToolStripMenuItem109_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem109.Click
        GlobalVariable.typeChambreOuSalle = "salle"
        RoomTypeForm.Show()
    End Sub

    'CHAMBRE
    Private Sub ToolStripMenuItem108_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem108.Click
        GlobalVariable.typeChambreOuSalle = "chambre"
        RoomForm.Show()
    End Sub

    'SALLE
    Private Sub ToolStripMenuItem110_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem110.Click
        GlobalVariable.typeChambreOuSalle = "salle"
        RoomForm.Show()
    End Sub

    'CHECKBOX PERMETTAN LA GESTION DES RESERVATION DE GROUPE

    Private Sub EtatDuBoutonDeGestionDesReservationDeGroupe()

        'On affiche code du groupe selon si le bouton est cochet et 
        'ne doit être modifiable que si c'est une réservation n'étant pas liée a une entreprise

        If GunaCheckBoxReservationDeGroupe.Checked Then

            GunaTextBoxCodeDeGroupe.Visible = True

            If GlobalVariable.codeReservationToUpdate = "" Then
                GunaTextBoxCodeDeGroupe.Text = Functions.GeneratingRandomCode("reservation", "")
            Else
                GunaTextBoxCodeDeGroupe.Text = GlobalVariable.ReservationToUpdate.Rows(0)("GROUPE")
            End If

            GunaTextBoxCodeDeGroupe.Visible = True
        Else
            GunaTextBoxCodeDeGroupe.Clear()
            GunaTextBoxCodeDeGroupe.Visible = False
        End If

    End Sub

    'CLICK SUR LE BOUTON DE RESERVATION EN GROUPE
    Private Sub GunaCheckBoxReservationDeGroupe_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxReservationDeGroupe.Click

        EtatDuBoutonDeGestionDesReservationDeGroupe()

    End Sub

    'STATUS DS CHAMBRES
    Private Sub GunaAdvenceButton9_Click(sender As Object, e As EventArgs)
        'GlobalVariable.typeChambreOuSalle = "chambre"
        'RoomForm.Show()
    End Sub

    'SOUS FAMILLE D'ARTICLE
    Private Sub GunaButtonSousFamilleArticle_Click(sender As Object, e As EventArgs) Handles GunaButtonSousFamilleArticle.Click
        GlobalVariable.typeFamilleOuSousFamille = "sous famille"

        Dim MainWindow As New MainWindow()
        MainWindow.TabControlHbergement.SelectedIndex = 1
        ArticleFamilyForm.Show()


    End Sub

    '------------------------------------------------- GESTION DES MENUS CONTEXTUEL DUPLIQUER - DELETE

    'Duplication de reservation
    Private Sub ToolStripMenuItem5_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem5.Click

        If GunaDataGridViewReservationList.Rows.Count > 0 Then

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation?", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If Not dialog = DialogResult.No Then

                Dim myValue As String = InputBox("Nombre de Duplication", "Duplication", "")
                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    'On doit determiner si la reseravtion est dans reservation ou dans reserve_conf
                    Dim reservation As DataTable = Functions.getElementByCode(GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString, "reservation", "CODE_RESERVATION")

                    If reservation.Rows.Count > 0 Then

                        For i = 1 To nombreDeDuplication
                            Functions.DuplicateRowFromDataGrid(GunaDataGridViewReservationList, GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString, "reservation", "ID_RESERVATION")
                        Next

                    Else

                        For i = 1 To nombreDeDuplication
                            Functions.DuplicateRowFromDataGrid(GunaDataGridViewReservationList, GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString, "reserve_conf", "ID_RESERVATION")
                        Next

                    End If



                    GunaDataGridViewReservationList.Columns.Clear()

                    ReservationList("all", "none")

                    MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

            End If
        Else

            MessageBox.Show("Aucune ligne à Dupliquer!", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    'SUpressions des réservations
    Private Sub ToolStripMenuItem7_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem7.Click

        If GunaDataGridViewReservationList.Rows.Count > 0 Then

            Dim DeleteRow As Boolean = False
            Dim rowToDelete As String = GunaDataGridViewReservationList.CurrentRow.Cells("Reservation").Value.ToString

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation?", "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If dialog = DialogResult.No Then
                'e.Cancel = True
            Else

                DeleteRow = True

            End If

            If DeleteRow Then

                Functions.DeleteRowFromDataGrid(GunaDataGridViewReservationList, rowToDelete, "reserve_conf", "CODE_RESERVATION")

                Functions.DeleteRowFromDataGrid(GunaDataGridViewReservationList, rowToDelete, "reservation", "CODE_RESERVATION")

                GunaDataGridViewReservationList.Columns.Clear()

                ReservationList("all", "none")

                MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        Else

            MessageBox.Show("Aucune ligne à suprimer!", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    'Supression d'une réservation attendue
    ' ATTENDU TAB DELETE
    Private Sub ToolStripMenuItemSupprimer_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItemSupprimer.Click

        If DataGridViewAttenduPanel.Rows.Count > 0 Then

            Dim DeleteRow As Boolean = False

            Dim rowToDelete As String = ""

            If rowToDelete = "" Then
                rowToDelete = DataGridViewAttenduPanel.CurrentRow.Cells("Reservation").Value.ToString
            End If

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation?", "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If dialog = DialogResult.No Then
                'e.Cancel = True
            Else
                DeleteRow = True
            End If

            If DeleteRow Then

                Functions.DeleteRowFromDataGrid(DataGridViewAttenduPanel, rowToDelete, "reservation", "CODE_RESERVATION")

                DataGridViewAttenduPanel.Columns.Clear()

                ListeDesAttendues()

                MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        Else

            MessageBox.Show("Aucune ligne à suprimer!", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    'Duplication d'une réservation attendu
    ' ATTENDU TAB DUPILCATION
    Private Sub ToolStripMenuItemDupliquer_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItemDupliquer.Click

        If DataGridViewAttenduPanel.Rows.Count > 0 Then

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation?", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If Not dialog = DialogResult.No Then

                Dim myValue As String = InputBox("Nombre de Duplication", "Duplication", "")
                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    For i = 1 To nombreDeDuplication
                        Functions.DuplicateRowFromDataGrid(DataGridViewAttenduPanel, DataGridViewAttenduPanel.CurrentRow.Cells("Reservation").Value.ToString, "reservation", "ID_RESERVATION")
                    Next

                    DataGridViewAttenduPanel.Columns.Clear()

                    ListeDesAttendues()

                    MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

            End If
        Else

            MessageBox.Show("Aucune ligne à Dupliquer!", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    ' EN CHAMBRE TAB DUPILCATION

    Private Sub ToolStripMenuItem1_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem1.Click

        If DataGridViewEnChambre.Rows.Count > 0 Then

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation?", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If Not dialog = DialogResult.No Then

                Dim myValue As String = InputBox("Nombre de Duplication", "Duplication", "")
                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    For i = 1 To nombreDeDuplication
                        Functions.DuplicateRowFromDataGrid(DataGridViewEnChambre, DataGridViewEnChambre.CurrentRow.Cells("Reservation").Value.ToString, "reserve_conf", "ID_RESERVATION")
                    Next

                    DataGridViewEnChambre.Columns.Clear()

                    ListeDesEnChambres()

                    MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

            End If

        Else

            MessageBox.Show("Aucune ligne à Dupliquer!", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    Dim compteur As Integer = 0

    'EN CHAMBRE SUPRESSION
    Private Sub ToolStripMenuItem3_Click_1(sender As Object, e As EventArgs) Handles ToolStripMenuItem3.Click

        If DataGridViewEnChambre.Rows.Count > 0 Then

            Dim DeleteRow As Boolean = False

            Dim rowToDelete As String = ""

            If rowToDelete = "" Then
                rowToDelete = DataGridViewEnChambre.CurrentRow.Cells("Reservation").Value.ToString
            End If

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation?", "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If dialog = DialogResult.No Then
                'e.Cancel = True
            Else
                DeleteRow = True
            End If

            If DeleteRow Then

                Functions.DeleteRowFromDataGrid(DataGridViewEnChambre, rowToDelete, "reserve_conf", "CODE_RESERVATION")

                DataGridViewEnChambre.Columns.Clear()

                ListeDesEnChambres()

                MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If

        Else

            MessageBox.Show("Aucune ligne à suprimer!", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    Private Sub ToolStripMenuItem4_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem4.Click

        If DataGridViewDepartTab.Rows.Count > 0 Then

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Dupliquer cette Réservation?", "Duplication", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If Not dialog = DialogResult.No Then

                Dim myValue As String = InputBox("Nombre de Duplication", "Duplication", "")
                Dim nombreDeDuplication As Integer = 0

                Integer.TryParse(myValue, nombreDeDuplication)

                If nombreDeDuplication > 0 Then

                    For i = 1 To nombreDeDuplication
                        Functions.DuplicateRowFromDataGrid(DataGridViewDepartTab, DataGridViewDepartTab.CurrentRow.Cells("Reservation").Value.ToString, "reserve_conf", "ID_RESERVATION")
                    Next

                    DataGridViewDepartTab.Columns.Clear()

                    ListeDesDeparts()

                    MessageBox.Show("Réservation dupliquée avec succès", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

                End If

            End If
        Else

            MessageBox.Show("Aucune ligne à Dupliquer!", "Duplication", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    Private Sub ToolStripMenuItem6_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem6.Click

        If DataGridViewDepartTab.Rows.Count > 0 Then

            Dim dialog As DialogResult
            dialog = MessageBox.Show("Voulez-vous vraiment Supprimer cette Réservation?", "Demande de suppression", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

            If dialog = DialogResult.No Then
                'e.Cancel = True
            Else
                Functions.DeleteRowFromDataGrid(DataGridViewDepartTab, DataGridViewDepartTab.CurrentRow.Cells("Reservation").Value.ToString, "reserve_conf", "CODE_RESERVATION")

                DataGridViewDepartTab.Columns.Clear()

                ListeDesDeparts()

                MessageBox.Show("Vous avez supprimé avec succès", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

            End If


        Else

            MessageBox.Show("Aucune ligne à suprimer!", "Supression", MessageBoxButtons.OK, MessageBoxIcon.Information)

        End If

    End Sub

    '----------------------------------------GESTION DU PENNEAU DISPONIBILITE ET TARIFS -----------------------------------------
    Private Sub DisponibiliteEtTarifs()

        GunaDataGridViewDispo1.Columns.Clear()

        Dim existQuery As String = "SELECT * From type_chambre WHERE TYPE=@TYPE ORDER BY CODE_TYPE_CHAMBRE ASC"

        Dim command As New MySqlCommand(existQuery, GlobalVariable.connect)

        command.Parameters.Add("@TYPE", MySqlDbType.VarChar).Value = "chambre"

        Dim adapter As New MySqlDataAdapter(command)
        Dim typeChambre As New DataTable()
        adapter.Fill(typeChambre)

        Dim TauxTotal As Double = 0

        If typeChambre.Rows.Count > 0 Then

            GunaDataGridViewDispo1.Columns.Add("CODE_CHAMBRE", "CODE CHAMBRE")

            For k = 1 To 14
                GunaDataGridViewDispo1.Columns.Add("jour", k)
            Next

            For i = 0 To typeChambre.Rows.Count - 1

                Dim existQuery1 As String = "SELECT * From chambre WHERE CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE ORDER BY CODE_CHAMBRE ASC"

                Dim command1 As New MySqlCommand(existQuery1, GlobalVariable.connect)

                command1.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")
                Dim adapter1 As New MySqlDataAdapter(command1)
                Dim chambre As New DataTable()

                adapter1.Fill(chambre)

                If chambre.Rows.Count > 0 Then

                    Dim existQuery2 As String = "SELECT * From chambre WHERE CODE_TYPE_CHAMBRE=@CODE_TYPE_CHAMBRE AND CODE_CHAMBRE=@CODE_CHAMBRE AND ETAT_CHAMBRE_NOTE = 'Libre propre' OR ETAT_CHAMBRE_NOTE='Libre sale'"

                    Dim command2 As New MySqlCommand(existQuery2, GlobalVariable.connect)

                    command2.Parameters.Add("@CODE_TYPE_CHAMBRE", MySqlDbType.VarChar).Value = typeChambre.Rows(i)("CODE_TYPE_CHAMBRE")
                    command2.Parameters.Add("@CODE_CHAMBRE", MySqlDbType.VarChar).Value = chambre.Rows(i)("CODE_CHAMBRE")
                    'command2.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
                    Dim adapter2 As New MySqlDataAdapter(command2)
                    Dim chambreLibre As New DataTable()
                    adapter2.Fill(chambreLibre)

                    GunaDataGridViewDispo1.Rows.Add(typeChambre.Rows(i)("LIBELLE_TYPE_CHAMBRE"))

                    Dim NobreDeChambreLibre As Integer = chambreLibre.Rows.Count
                    Dim NobreDeChambreTotal As Integer = chambre.Rows.Count
                    Dim NobreDeChambreOccupee As Integer = chambre.Rows.Count - chambreLibre.Rows.Count


                    GunaDataGridViewDispo1.Rows.Add("Nombre total: ", NobreDeChambreTotal)
                    GunaDataGridViewDispo1.Rows.Add("Occupée: ", NobreDeChambreTotal - NobreDeChambreLibre)
                    GunaDataGridViewDispo1.Rows.Add("Libre: ", chambreLibre.Rows.Count)
                    GunaDataGridViewDispo1.Rows.Add("Taux d'occupation: ", Math.Round((NobreDeChambreOccupee / NobreDeChambreTotal) * 100, 1) & "%")
                    GunaDataGridViewDispo1.Columns("CODE_CHAMBRE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight
                    GunaDataGridViewDispo1.Rows.Add("", "")

                    'GunaDataGridViewDispo1.Rows(i).DefaultCellStyle.ForeColor = Color.White
                End If

            Next

        End If

    End Sub

    Private Sub GunaAdvenceButton23_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton23.Click
        GunaPanelDisponibilite.BringToFront()
        DisponibiliteEtTarifs()
    End Sub

    Private Sub GunaButton1_Click(sender As Object, e As EventArgs) Handles GunaButtonQuitter.Click

        LabelNatureReservation.Visible = False

        'Chaque fois qu'on sort de la fenêtre de reservation on vide le formulaire
        VidageDesChampsPourNouvelleReservation()

        LabelNatureReservation.Visible = False
        PanelTableauDeBords.Show()
        PanelTableauDeBords.BringToFront()

    End Sub

    'Fermer DashBoard
    Private Sub Quitter_Click(sender As Object, e As EventArgs) Handles Quitter.Click
        HomeForm.Show()
        Me.Close()
    End Sub

    '------------------------------ GESTION DES IMPRESSION DES FACTURES ET REGLEMENT DU CLIENT -----------------------------------------------

    Dim TotalFacture As Double = 0

    Private Sub ImprimerToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ImprimerToolStripMenuItem.Click

        GlobalVariable.DocumentToGenerate = "facture"

        If GunaDataGridViewDesFactures.Rows.Count > 0 Then

            Functions.DocumentToPrint(GunaDataGridViewDesFactures.CurrentRow.Cells("CODE").Value.ToString, "lign_facture", "CODE_FACTURE", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)

        End If

    End Sub

    Private Sub ToolStripMenuItem2_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem2.Click

        GlobalVariable.DocumentToGenerate = "reglement"

        If GunaDataGridViewListeDesReglement.Rows.Count > 0 Then

            Functions.DocumentToPrint(GunaDataGridViewListeDesReglement.CurrentRow.Cells("CODE").Value.ToString, "reglement", "NUM_REGLEMENT", GlobalVariable.codeClientToUpdate, GunaLabelNumReservation.Text)

        End If

    End Sub

    'RECHERCHER BOUTON - RESERVATION
    Private Sub GunaAdvenceButton22_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton22.Click

        TabControlHbergement.SelectedIndex = 1
        PanelEnregistrement.Show()
        PanelEnregistrement.BringToFront()

    End Sub

    'ANNULATION DE RESERVATION
    Private Sub GunaButtonAnnulerReservation_Click(sender As Object, e As EventArgs) Handles GunaButtonAnnulerReservation.Click


        '-------------------------------- OCCUPATION CHAMBRE ------------------------------

        Dim CODE_OCCUPATION_CHAMBRE = Functions.GeneratingRandomCode("occupation_chambre", "")
        Dim MONTANT_HT As Double = GlobalVariable.MONTANT_ACCORDE
        Dim TAXE As Double = 0
        Dim MONTANT_TTC As Double = 0
        Dim DATE_OCCUPATION As Date = GunaDateTimePickerArrivee.Value.ToShortDateString()
        'Dim OBSERVATIONS As String =""
        Dim COMMENTAIRE1 As String = ""
        Dim COMMENTAIRE2 As String = ""
        Dim COMMENTAIRE3 As String = ""
        Dim COMMENTAIRE4 As String = ""
        Dim DATE_LIBERATION As Date = GunaDateTimePickerDepart.Value.ToShortDateString()
        Dim CODE_UTILISATEUR_CREA As String = GlobalVariable.ConnectedUser.Rows(0)("CODE_UTILISATEUR")
        Dim DATE_PREMIERE_ARRIVEE As Date = GlobalVariable.DateDeTravail
        Dim TYPE_RESERVATION As String = GlobalVariable.typeChambreOuSalle
        Dim PDJ_INCLUS As String = ""
        Dim TAXE_SEJOURS_INCLUS As String = ""
        Dim TVA_INCLUS As String = ""
        Dim CODE_CLIENT_REEL As String = GunaTextBoxRefClient.Text
        Dim OBSERVATIONS As String = ""
        Dim CODE_CHAMBRE = GunaTextBoxNumeroChambre.Text
        Dim CODE_AGENCE As String = GlobalVariable.AgenceActuelle.Rows(0)("CODE_AGENCE")
        Dim STATUT_RESERVATION As String = "Annulée"

        Dim Reservation As New Reservation
        Dim occupationChambre As New OccupationChambre()
        Dim CODE_RESERVATION As String = GlobalVariable.codeReservationToUpdate
        Dim dialog As DialogResult

        dialog = MessageBox.Show("Voulez vous vraiment Annuler cette réservation ", "Annulation de réservation", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        If dialog = DialogResult.No Then

        Else

            'MOTIF ANNULATION
            '----------------------------------------------
            Dim motifDelogement As String = InputBox("ANNULATION ", "Motif de l'annulation", "")

            OBSERVATIONS = motifDelogement

            '------------------------------------------------

            'ANNULATION DE LA RESERVATION 
            Dim reservationToUpdateInReservation As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reservation", "CODE_RESERVATION")

            'SOIT DANS RESERVATION
            If reservationToUpdateInReservation.Rows.Count > 0 Then

                'ANNULATION DE LA RESERVATION
                Dim ETAT_RESERVATION As Integer = 2 'RESERVATION ANNULEE
                Reservation.AnnulationDeReservation(CODE_RESERVATION, "reservation", ETAT_RESERVATION, STATUT_RESERVATION)

            Else

                'OU DANS RESERVATION
                Dim reservationToUpdateInReserve_conf As DataTable = Functions.getElementByCode(CODE_RESERVATION, "reserve_conf", "CODE_RESERVATION")

                If reservationToUpdateInReserve_conf.Rows.Count > 0 Then

                    Dim ETAT_RESERVATION As Integer = 2 '2 = RESERVATION ANNULEE; 1 = RESERVATION ABOUTI ; 0 RESERVATION ANNULEE NORMALEMENT VIA UN CHECK OUT A LA BONNE DATE DE DEPART
                    'Reservation.AnnulationDeReservation(CODE_RESERVATION, "reserve_conf", ETAT_RESERVATION)

                End If

            End If

            'UPDATE THE ROOM
            Dim updateQuery1 As String = "UPDATE `chambre` SET `ETAT_CHAMBRE`=@ETAT_CHAMBRE, ETAT_CHAMBRE_NOTE=@ETAT_CHAMBRE_NOTE WHERE CODE_CHAMBRE=@code"

            Dim command1 As New MySqlCommand(updateQuery1, GlobalVariable.connect)

            command1.Parameters.Add("@ETAT_CHAMBRE", MySqlDbType.Int32).Value = 0
            command1.Parameters.Add("@code", MySqlDbType.VarChar).Value = GlobalVariable.codeChambre
            command1.Parameters.Add("@ETAT_CHAMBRE_NOTE", MySqlDbType.VarChar).Value = "Libre sale"

            'Opening the connection
            'connect.openConnection()

            'Excuting the command and testing if everything went on well
            If (command1.ExecuteNonQuery() = 1) Then
                'connect.closeConnection()
            End If

            'trace de l'annulation de reservation 
            Dim ETAT_CHAMBRE As Integer = 1

            If occupationChambre.insertOccupationChambre(CODE_OCCUPATION_CHAMBRE, CODE_RESERVATION, CODE_CHAMBRE, MONTANT_HT, TAXE, MONTANT_TTC, DATE_OCCUPATION, ETAT_CHAMBRE, OBSERVATIONS, COMMENTAIRE1, COMMENTAIRE2, COMMENTAIRE3, COMMENTAIRE4, DATE_LIBERATION, CODE_UTILISATEUR_CREA, DATE_PREMIERE_ARRIVEE, TYPE_RESERVATION, PDJ_INCLUS, TAXE_SEJOURS_INCLUS, TVA_INCLUS, CODE_CLIENT_REEL, CODE_AGENCE) Then

            End If
        End If

        'RSERVATION NORMALE

        'Clearing all the informations found in the the reseravtion field
        emtptyRegistrationFields()

        'We set all the global variables used for update to their original values
        Functions.EmtyGlobalVariablesContainingCodeToUpdate()

        'Renitialisation des dates en plus de la date de travail après avoir vidé les variables globales
        ReinitialisationDesDates()

        Functions.SiplifiedClearTextBox(Me)

        'On masque les tarifs associés au client si existe 
        GunaComboBoxCodeTarif.Visible = False
        GunaLabelCodeTarif.Visible = False

        'Desactivation du bouton de gestion de groupe
        GunaCheckBoxReservationDeGroupe.Checked = False

        ReservationList("all", "none")

        'Used to know which button to display among enregistrer, checkin, checkout, annuler
        reservationButtonToDisplay()

        GunaCheckBoxPetitDejeuenerInclus.Checked = False
        GunaCheckBoxTaxeSejour.Checked = False
        GunaTextBoxPetitDejeuner.Visible = False
        GunaTextBoxPetitDejeunerRoutage.Visible = False

        MessageBox.Show("Réservation annulée avec succès", "Annulation de Réservation", MessageBoxButtons.OK, MessageBoxIcon.Information)

    End Sub

    ' ----------------------------------------------- LIVE SEARCH NEW MODEL --------------------------------------------------

    Private Sub GunaTextBoxClient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxClient.TextChanged

        If Trim(GunaTextBoxClient.Text) = "" Then
            GunaDataGridViewNameSearch.Visible = False
        Else
            Recherche.RechercherClient(GunaDataGridViewNameSearch, GunaTextBoxClient.Text, "NOM_PRENOM")
        End If

    End Sub

    Private Sub GunaTextBoxNumResa_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNumResa.TextChanged

        If Trim(GunaTextBoxNumResa.Text) = "" Then
            GunaDataGridViewNumRea.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewNumRea, GunaTextBoxNumResa.Text, "CODE_RESERVATION")
        End If

    End Sub

    Private Sub GunaTextBoxParEntreprise_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxParEntreprise.TextChanged

        If Trim(GunaTextBoxParEntreprise.Text) = "" Then
            GunaDataGridViewEntrepriseSearch.Visible = False
        Else
            Recherche.RechercherClient(GunaDataGridViewEntrepriseSearch, GunaTextBoxParEntreprise.Text, "NOM_PRENOM", "ENTREPRISE")
        End If

    End Sub

    Private Sub SupprimerFiltreToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles SupprimerFiltreToolStripMenuItem.Click
        'ReservationList()
    End Sub

    Private Sub GunaTextBoxNumGroupe_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxNumGroupe.TextChanged

        If Trim(GunaTextBoxNumGroupe.Text) = "" Then
            GunaDataGridViewGroupe.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewGroupe, GunaTextBoxNumGroupe.Text, "GROUPE")
        End If

    End Sub

    Private Sub GunaTextBoxTypeChambre_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxTypeChambre.TextChanged

        If Trim(GunaTextBoxTypeChambre.Text) = "" Then
            GunaDataGridViewTypeChambre.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewTypeChambre, GunaTextBoxTypeChambre.Text, "CHAMBRE_ID")
        End If

    End Sub

    Private Sub GunaTextBoxSourceResa_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxSourceResa.TextChanged

        If Trim(GunaTextBoxSourceResa.Text) = "" Then
            GunaDataGridViewSourceRea.Visible = False
        Else
            Recherche.RechercherParText(GunaDataGridViewSourceRea, GunaTextBoxSourceResa.Text, "SOURCE_RESERVATION")
        End If

    End Sub

    Private Sub GunaDateTimePickerParDateArrivee_ValueChanged(sender As Object, e As EventArgs) Handles GunaDateTimePickerParDateArrivee.ValueChanged
        'Recherche.RechercherParDateArrivee(GunaDataGridViewReservationList, GunaDateTimePickerParDateArrivee.Value, "DATE_ENTTRE")
    End Sub

    Private Sub GunaDateTimePickerParDateDepart_Validated(sender As Object, e As EventArgs) Handles GunaDateTimePickerParDateDepart.ValueChanged
        'Recherche.RechercherParDateDepart(GunaDataGridViewReservationList, GunaDateTimePickerParDateDepart.Value, "DATE_SORTIE")
    End Sub

    'RAFRICHISSEMENT DES LISTES DES TABS RESERVATION - ARRIVEES - EN CHAMBRES - DEPARTS
    Private Sub TabControlHbergement_Click(sender As Object, e As EventArgs) Handles TabControlHbergement.Click
        'Permet de supprimer tous filtre existant
        'ReservationList()
    End Sub

    'GESTION DES PANNES
    Private Sub FamilleDePannesToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FamilleDePannesToolStripMenuItem.Click
        GlobalVariable.TypePanne = "famille"
        PannesForm.Show()
    End Sub

    Private Sub SousFamillesDePannesToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles SousFamillesDePannesToolStripMenuItem.Click
        GlobalVariable.TypePanne = "sous famille"
        PannesForm.Show()
    End Sub

    'DEMANDE D'INTERVENTION
    Private Sub ToolStripMenuItem123_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem123.Click
        DemandeInterventionForm.Show()
    End Sub

    'BON D'INTERVENTION OU INTERVENTION
    Private Sub ToolStripMenuItem128_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem128.Click
        BonInterventionForm.Show()
    End Sub

    'PANNEAU TECHNIQUE
    Private Sub TECHNIQUEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles TECHNIQUEToolStripMenuItem.Click

        MainWindowTechnique.Show()

        Me.Visible = False

    End Sub

    'DEMANDE D'INTERVENTION
    Private Sub GunaAdvenceButton35_Click(sender As Object, e As EventArgs)

        'BonInterventionForm.Hide()

        'DemandeInterventionForm.TopMost = True
        'DemandeInterventionForm.Location = New System.Drawing.Point(10, 104)
        'DemandeInterventionForm.Show()

        'FacturationForm.Close()
        'RoomForm.Close()

    End Sub

    'BON INTERVENTION
    Private Sub GunaAdvenceButton34_Click(sender As Object, e As EventArgs)

        'DemandeInterventionForm.Hide()

        'BonInterventionForm.TopMost = True
        'BonInterventionForm.Location = New System.Drawing.Point(10, 104)

        'BonInterventionForm.Show()

        'FacturationForm.Close()
        'RoomForm.Close()

    End Sub

    'Rapport de la Reception 
    Private Sub GunaAdvenceButton28_Click(sender As Object, e As EventArgs) Handles GunaAdvenceRapports.Click

        GunaDateTimePickerRapportReception.Value = GlobalVariable.DateDeTravail

        PanelRapports.BringToFront()
        PanelRapports.Show()

        'Raports de la réception
        TabControlRapport.SelectedIndex = 0

    End Sub

    'Affichage des elements de la liste destinees a la DST dans un datatgrid
    Private Sub GunaButton2_Click(sender As Object, e As EventArgs) Handles GunaButtonAfficherDst.Click

        Functions.EmtyGlobalVariablesContainingCodeToUpdate()
        'ReinitialisationDesDates()

        GunaDataGridViewRapportDST.Columns.Clear()

        'ListeDesAttenduesRapportDST(GunaDateTimePickerRapportReception.Value.ToString("yyyy-MM-dd"))
        ListeDesAttenduesRapportDST(GunaDateTimePickerRapportReception.Value.ToString("yyyy-MM-dd"))

    End Sub

    'Impression de la liste pour la DST
    Private Sub GunaButton3_Click(sender As Object, e As EventArgs) Handles GunaButtonImpressionPourDST.Click

        GlobalVariable.DocumentToGenerate = "DST"
        Functions.DocumentToPrintDST(GunaDataGridViewRapportDST, GunaDateTimePickerRapportReception.Value.ToShortDateString())

    End Sub

    'PANNEAU DE RESERVATION 
    Public Sub tarifToDisplay(ByVal CODE_ENTREPRISE As String, ByVal CODE_TYPE_CEHAMBRE As String)

        Dim prixParNuitee As Double = 0

        If (Not CODE_ENTREPRISE = "") And (Not CODE_TYPE_CEHAMBRE = "") Then

            Dim tarif As New Tarifs

            'ON SELECTIONNE L'ENSEMBLE DES TARIFS
            Dim ListOftarif As DataTable = tarif.SelectDistinctTarif()

            GunaComboBoxCodeTarif.DataSource = ListOftarif
            GunaComboBoxCodeTarif.ValueMember = "CODE_TARIF"
            GunaComboBoxCodeTarif.DisplayMember = "LIBELLE_TARIF"

            Dim TarifDuclientActuel As DataTable

            'L'entreprise existe et est associée a un tarif
            Dim FillingListquery As String = "SELECT PRIX_TARIF1,LIBELLE_TARIF, PRIX_TARIF_ENCOURS, CODE_CLIENT,CODE_TARIF FROM tarif_client INNER JOIN tarif_prix WHERE tarif_client.ID_TARIF_PRIX = tarif_prix.ID_TARIF AND CODE_CLIENT=@CODE_CLIENT AND CODE_TYPE=@CODE_TYPE"


            Dim command As New MySqlCommand(FillingListquery, GlobalVariable.connect)
            command.Parameters.Add("@CODE_CLIENT", MySqlDbType.VarChar).Value = Trim(CODE_ENTREPRISE)
            command.Parameters.Add("@CODE_TYPE", MySqlDbType.VarChar).Value = Trim(CODE_TYPE_CEHAMBRE)

            Dim adapter As New MySqlDataAdapter(command)
            Dim table As New DataTable()

            adapter.Fill(table)

            TarifDuclientActuel = table

            Dim prixDuTarif As Double = 0

            If TarifDuclientActuel.Rows.Count > 0 Then

                If TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS") = 0 Then

                    prixDuTarif = TarifDuclientActuel.Rows(0)("TARIF_PRIX1")

                Else

                    prixDuTarif = TarifDuclientActuel.Rows(0)("PRIX_TARIF_ENCOURS")

                End If

            End If

            If TarifDuclientActuel.Rows.Count > 0 Then

                If GunaRadioButtonChambre.Checked Then

                    GunaTextBoxMontantAccorde.Text = Format(prixDuTarif, "#,##0")
                    prixParNuitee = GunaTextBoxMontantAccorde.Text

                    GunaComboBoxCodeTarif.Visible = True
                    GunaLabelCodeTarif.Visible = True

                    GunaComboBoxCodeTarif.SelectedValue = TarifDuclientActuel.Rows(0)("CODE_TARIF")
                End If

                If GunaRadioButtonSalleFete.Checked Then
                    GunaTextBoxMontantReelSalle.Text = Format(prixDuTarif, "#,##0")


                    GunaComboBoxCodeTarif.Visible = False
                    GunaLabelCodeTarif.Visible = False
                End If

            Else


            End If

        End If

    End Sub

    Private Sub GunaTextBoxEntrepriseDuclient_TextChanged(sender As Object, e As EventArgs) Handles GunaTextBoxEntrepriseDuclient.TextChanged

        GunaDataGridViewEntrepriseDuClient.Visible = True

        Dim TYPE_CLIENT = "ENTREPRISE"

        Dim query As String = "Select NOM_CLIENT From client WHERE NOM_CLIENT Like '%" & GunaTextBoxEntrepriseDuclient.Text & "%' AND CODE_AGENCE=@CODE_AGENCE AND TYPE_CLIENT=@TYPE_CLIENT"

        Dim command As New MySqlCommand(query, GlobalVariable.connect)
        command.Parameters.Add("@CODE_AGENCE", MySqlDbType.VarChar).Value = GlobalVariable.codeAgence
        command.Parameters.Add("@TYPE_CLIENT", MySqlDbType.VarChar).Value = TYPE_CLIENT

        Dim adapter As New MySqlDataAdapter(command)
        Dim table As New DataTable()

        adapter.Fill(table)

        If (table.Rows.Count > 0) Then

            GunaDataGridViewEntrepriseDuClient.DataSource = table

        Else
            GunaDataGridViewEntrepriseDuClient.Columns.Clear()
            GunaDataGridViewEntrepriseDuClient.Visible = False
        End If


        If Trim(GunaTextBoxEntrepriseDuclient.Text).Equals("") Then

            GunaTextBoxCodeEntrepriseDuClient.Clear()
            GunaLabelCodeTarif.Visible = False
            GunaComboBoxCodeTarif.Visible = False
            GunaDataGridViewEntrepriseDuClient.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewEntrepriseDuClient_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewEntrepriseDuClient.CellClick

        GunaDataGridViewEntrepriseDuClient.Visible = False

        If e.RowIndex >= 0 Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewEntrepriseDuClient.Rows(e.RowIndex)
            Dim company As DataTable = Functions.getElementByCode(Trim(row.Cells("NOM_CLIENT").Value.ToString), "client", "NOM_CLIENT")

            If company.Rows.Count > 0 Then

                GunaTextBoxEntrepriseDuclient.Text = Trim(company.Rows(0)("NOM_PRENOM"))
                GunaTextBoxCodeEntrepriseDuClient.Text = Trim(company.Rows(0)("CODE_CLIENT"))

                GunaDataGridViewEntrepriseDuClient.Visible = False

            End If

            'connect.closeConnection()

            Dim CODE_ENTREPRISE As String = Trim(GunaTextBoxCodeEntrepriseDuClient.Text)
            Dim CODE_TYPE_CEHAMBRE As String = Trim(GunaTextBoxCodeTypeDeChambre.Text)

            'On recherche si l'entreprise associé au client a une tarification
            tarifToDisplay(CODE_ENTREPRISE, CODE_TYPE_CEHAMBRE)

        End If

    End Sub

    'GESTION DES CHAMPS DE RECHERCHE
    Private Sub GunaButton7_Click(sender As Object, e As EventArgs) Handles GunaButtonArricherReservation.Click

        If GunaCheckBoxToutes.Checked Then

            ReservationList("all", "none")

        ElseIf Not Trim(GunaTextBoxClient.Text).Equals("") Then

            ReservationList("NOM_CLIENT", Trim(GunaTextBoxClient.Text))

        ElseIf Not Trim(GunaTextBoxClient.Text).Equals("") Then

            ReservationList("CODE_RESERVATION", Trim(GunaTextBoxClient.Text))

        ElseIf Not Trim(GunaTextBoxParEntreprise.Text).Equals("") Then

            ReservationList("NOM_CLIENT", Trim(GunaTextBoxParEntreprise.Text))

        ElseIf Not Trim(GunaTextBoxSourceResa.Text).Equals("") Then

            ReservationList("SOURCE_RESERVATION", Trim(GunaTextBoxSourceResa.Text))

        ElseIf Not Trim(GunaTextBoxNumGroupe.Text).Equals("") Then

            ReservationList("GROUPE", Trim(GunaTextBoxNumGroupe.Text))

        ElseIf Not Trim(GunaTextBoxTypeChambre.Text).Equals("") Then

            ReservationList("CHAMBRE_ID", Trim(GunaTextBoxTypeChambre.Text))

        Else

            Recherche.RechercherParDate(GunaDataGridViewReservationList, GunaDateTimePickerParDateArrivee.Value, GunaDateTimePickerParDateDepart.Value)

        End If

        'We empty the search field field after reservation 
        emptySearchFieldReservation()

    End Sub

    'Nom de client
    Private Sub GunaDataGridViewNameSearch_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewNameSearch.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewNameSearch.Rows(e.RowIndex)

            GunaTextBoxClient.Text = Trim(row.Cells("NOM_PRENOM").Value.ToString())

            GunaDataGridViewNameSearch.Visible = False

        End If

    End Sub

    'Num Rea
    Private Sub GunaDataGridViewNumRea_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewNumRea.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewNumRea.Rows(e.RowIndex)

            GunaTextBoxNumResa.Text = Trim(row.Cells("CODE_RESERVATION").Value.ToString())

            GunaDataGridViewNumRea.Visible = False

        End If

    End Sub

    'Entreprise
    Private Sub GunaDataGridViewEntrepriseSearch_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewEntrepriseSearch.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewEntrepriseSearch.Rows(e.RowIndex)

            GunaTextBoxParEntreprise.Text = Trim(row.Cells("NOM_PRENOM").Value.ToString())

            GunaDataGridViewEntrepriseSearch.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewSourceRea_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewSourceRea.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewSourceRea.Rows(e.RowIndex)

            GunaTextBoxSourceResa.Text = Trim(row.Cells("SOURCE_RESERVATION").Value.ToString())

            GunaDataGridViewSourceRea.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewGroupe_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewGroupe.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewGroupe.Rows(e.RowIndex)

            GunaTextBoxNumGroupe.Text = Trim(row.Cells("GROUPE").Value.ToString())

            GunaDataGridViewGroupe.Visible = False

        End If

    End Sub

    Private Sub GunaDataGridViewTypeChambre_CellClick(sender As Object, e As DataGridViewCellEventArgs) Handles GunaDataGridViewTypeChambre.CellClick

        If (e.RowIndex >= 0) Then

            Dim row As DataGridViewRow

            row = Me.GunaDataGridViewTypeChambre.Rows(e.RowIndex)

            GunaTextBoxTypeChambre.Text = Trim(row.Cells("CHAMBRE_ID").Value.ToString())

            GunaDataGridViewTypeChambre.Visible = False

        End If

    End Sub

    'Zenlock form from front desk
    Private Sub GunaButtonLectureDeCarte_Click(sender As Object, e As EventArgs) Handles GunaButtonLectureDeCarte.Click

        GlobalVariable.zenlockForm = "frontdesk"

        ZenoLockForm.Show()

    End Sub

    Private Sub GunaAdvenceButton8_Click(sender As Object, e As EventArgs)

    End Sub

    Private Sub TabControlHbergement_Enter(sender As Object, e As EventArgs) Handles TabControlHbergement.Enter
        'AutoLoad Room for routing
        AutoLoadRoomForRouting()

        'Auload room source
        AutoLoadRoomReservationSource()

        GunaComboBoxSourceRéservation.SelectedValue = "COMPTOIRE"

    End Sub

    'Affichage des documents
    Private Sub GunaButton3_Click_2(sender As Object, e As EventArgs) Handles GunaButtonAffichageDesDocuments.Click

        ListeDesFacturesEtReglementPourUneReservation()

    End Sub

    Private Sub TabControlGestionReservation_SelectedIndexChanged(sender As Object, e As EventArgs) Handles TabControlGestionReservation.SelectedIndexChanged
        GunaDataGridViewDesFactures.Columns.Clear()
        'GunaGroupBoxStatistiques
        GunaDataGridViewListeDesReglement.Columns.Clear()
    End Sub

    'Gestion de la clôture
    Private Sub ClôturerToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ClôturerToolStripMenuItem.Click
        CloturerForm.Show()
    End Sub

    Private Sub ToolStripMenuItem105_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem105.Click
        FournisseurForm.Show()
    End Sub

    'Affichage du statuts des chambres du dashboard
    Private Sub GunaAdvenceButton1_Click(sender As Object, e As EventArgs) Handles GunaAdvenceButton1.Click
        GunaGroupBoxRoomStatus.Controls.Clear()
        'PanelGraphiques.Controls.Clear()
        GunaGroupBoxStatistiques.Controls.Clear()
        elementsDesChambres()
        contenuStatistique()
        StatistiquesDesChambres()
        StatusDesChambres()
    End Sub

    Private Sub ToolStripMenuItem92_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem92.Click
        MAgasinForm.Show()
    End Sub


    'Gestion du switch button icons-graphiques
    Private Sub GunaWinSwitch1_CheckedChanged(sender As Object, e As EventArgs) Handles GunaWinSwitch1.CheckedChanged

        If GunaWinSwitch1.Checked Then
            PanelGraphiques.Visible = False
        Else
            PanelGraphiques.BringToFront()
            PanelGraphiques.Visible = True
        End If

    End Sub

    ' ------------------ --------------GESTION DES SIESTES ----------------------------------------------

    'ACTIVATION DU LOGICIEL
    Private Sub LicenceToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles LicenceToolStripMenuItem.Click
        ActivationForm.Show()
    End Sub

    'Gestion des siestes et nuites
    Private Sub GunaCheckBoxDayUse_Click(sender As Object, e As EventArgs) Handles GunaCheckBoxDayUse.Click

        If GunaCheckBoxDayUse.Checked Then
            GunaLabelTempsAFaire.Text = "Total Heure(s)"
            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail
            GunaLabelTypeDeSejour.Text = "DAY USE"

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

        Else
            GunaLabelTypeDeSejour.Text = "COURT SEJOURS"
            GunaLabelTempsAFaire.Text = "Total nuitées"
            GunaDateTimePickerDepart.Value = GlobalVariable.DateDeTravail.AddDays(1)
            GunaTextBoxTempsAFaire.Visible = True

        End If

    End Sub

    Private Sub GunaComboBoxHeureDepart_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxHeureDepart.SelectedIndexChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

            '-----------------------------

        End If

    End Sub

    Private Sub GunaComboBoxHeureArrivee_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GunaComboBoxHeureArrivee.SelectedIndexChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureArrivee.SelectedItem

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") + " " + GunaComboBoxHeureDepart.SelectedItem

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

            '-----------------------------

        End If

    End Sub

    ' ------------------ END GESTION DES SIESTE-----------------------------------

    Public Sub ActivationOuDesactivationDeToutLesBoutonsApresUnCheckOUt()

        If Trim(LabelNatureReservation.Text) = "CHECKOUT" Then

            GunaDateTimePickerArrivee.Enabled = False
            GunaComboBoxHeureArrivee.Enabled = False
            GunaDateTimePickerDepart.Enabled = False
            GunaComboBoxHeureDepart.Enabled = False
            GunaCheckBoxDayUse.Enabled = False
            GunaTextBoxTempsAFaire.Enabled = False
            GunaTextBoxCodeTypeDeChambre.Enabled = False
            GunaButtonListeDesCategorieDeChambre.Enabled = False
            GunaTextBoxNomPrenom.Enabled = False
            GunaTextBoxEntrepriseDuclient.Enabled = False
            GunaTextBoxCodeDeGroupe.Enabled = False
            GunaCheckBoxReservationDeGroupe.Enabled = False
            GunaButtonReservation.Enabled = False
            GunaTextBoxNumeroChambre.Enabled = False
            GunaButtonRoomSearchButton.Enabled = False


        Else

            GunaDateTimePickerArrivee.Enabled = True
            GunaComboBoxHeureArrivee.Enabled = True
            GunaDateTimePickerDepart.Enabled = True
            GunaComboBoxHeureDepart.Enabled = True
            GunaCheckBoxDayUse.Enabled = True
            GunaTextBoxTempsAFaire.Enabled = True
            GunaTextBoxCodeTypeDeChambre.Enabled = True
            GunaButtonListeDesCategorieDeChambre.Enabled = True
            GunaTextBoxNomPrenom.Enabled = True
            GunaTextBoxEntrepriseDuclient.Enabled = True
            GunaTextBoxCodeDeGroupe.Enabled = True
            GunaCheckBoxReservationDeGroupe.Enabled = True
            GunaButtonReservation.Enabled = True
            GunaTextBoxNumeroChambre.Enabled = True
            GunaButtonRoomSearchButton.Enabled = True


        End If


    End Sub

    'ENSEMBLE DES RAPPORTS DE LA RECEPTION

    Private Sub GunaButtonPromoteur_Click(sender As Object, e As EventArgs) Handles GunaButtonPromoteur.Click

        Functions.RapportDuPromoteur()

    End Sub

    'ARRIVEE
    Private Sub GunaButton10_Click(sender As Object, e As EventArgs) Handles GunaButton10.Click

        ListeDesAttenduesRapportDST(GlobalVariable.DateDeTravail)
        GlobalVariable.DocumentToGenerate = "DST"
        Functions.DocumentToPrintDST(GunaDataGridViewRapportDST, GunaDateTimePickerRapportReception.Value.ToShortDateString())

    End Sub

    'MAINCOURANTE JOURNALIERE
    Private Sub GunaButtonMainCouranteJOurnaliere_Click(sender As Object, e As EventArgs) Handles GunaButtonMainCouranteJOurnaliere.Click

        GlobalVariable.AncienneMainCourante = False
        'MainCouranteReceptionForm.Show()
        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub GunaButton4_Click(sender As Object, e As EventArgs) Handles GunaButton4.Click

        GlobalVariable.AncienneMainCourante = True
        MainCouranteReceptionForm.Show()

    End Sub

    Private Sub GunaButton8_Click_1(sender As Object, e As EventArgs) Handles GunaButton8.Click

        GlobalVariable.DocumentToGenerate = "facture"

        RapportFacturesForm.Show()

        'Functions.RapportFacture()

    End Sub

    Private Sub GunaButton1_Click_1(sender As Object, e As EventArgs) Handles GunaButton1.Click

        GlobalVariable.DocumentToGenerate = "reglement"

        RapportFacturesForm.Show()

    End Sub

    Private Sub GunaButton19_Click(sender As Object, e As EventArgs) Handles GunaButton19.Click
        Functions.rapportDesReservationAnnulees()
    End Sub

    Private Sub GunaButton7_Click_1(sender As Object, e As EventArgs) Handles GunaButton7.Click
        Functions.rapportDesArrivees()
    End Sub

    Private Sub GunaButton17_Click(sender As Object, e As EventArgs) Handles GunaButton17.Click
        Functions.rapportDesSejoursClotures()
    End Sub

    Private Sub GunaButtonEtatDesChambres_Click(sender As Object, e As EventArgs) Handles GunaButtonEtatDesChambres.Click
        Functions.rapportEtatsDesChambres()
    End Sub

    Private Sub GunaButton11_Click(sender As Object, e As EventArgs) Handles GunaButton11.Click
        Functions.rapportDesCaisses()
    End Sub

    Private Sub GunaAdvenceButton3_Click_1(sender As Object, e As EventArgs)
        NotificationsForm.TopMost = True
        NotificationsForm.Show()
    End Sub

    Private Sub GunaLabel12_Click(sender As Object, e As EventArgs) Handles GunaLabelNotification.Click

        NotificationsForm.GunaLabelNomDuNettoyeur.Text = "BOITE DE RECEPTION : MESSAGES NON LUS"

        NotificationsForm.TopMost = True
        NotificationsForm.Show()

        Dim notifications As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR"), "notification", "CODE_PROFIL", 0, "ETAT_NOTIFCATION")

        If notifications.Rows.Count > 0 Then

            NotificationsForm.GunaDataGridViewNotification.Columns.Clear()

            NotificationsForm.GunaDataGridViewNotification.DataSource = notifications

            NotificationsForm.GunaDataGridViewNotification.Columns("ID_NOTIFICATION").Visible = False
            NotificationsForm.GunaDataGridViewNotification.Columns("CODE_PROFIL").Visible = False
            NotificationsForm.GunaDataGridViewNotification.Columns("CODE_AGENCE").Visible = False
            NotificationsForm.GunaDataGridViewNotification.Columns("ETAT_NOTIFCATION").Visible = False

        Else

        End If

    End Sub

    'Ouvrir fenetre des UNITE DE COMTAGE
    Private Sub ToolStripMenuItem93_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem93.Click
        UniteDeComptageForm.TopMost() = True
        UniteDeComptageForm.Show()
    End Sub

    'gestion des fiches techniques
    Private Sub TicheTechniqueToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles TicheTechniqueToolStripMenuItem.Click
        GlobalVariable.ficheTechnique = "fiche"
        ArticleForm.TopMost() = True
        ArticleForm.Show()
    End Sub

    'NOUVELLE DGESTION DU TEMPS

    Private Sub NumericUpDownHeureArrivee_ValueChanged(sender As Object, e As EventArgs) Handles NumericUpDownHeureArrivee.ValueChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim ArriveeMinutes As String = ""
            Dim ArriveeHeure As String = ""

            Dim departMinutes As String = ""
            Dim departHeure As String = ""

            If NumericUpDownArriveeMin.Value = 0 Then
                ArriveeMinutes = ":00:00"
            ElseIf NumericUpDownArriveeMin.Value < 10 Then
                ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
            Else
                ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
            End If

            If NumericUpDownHeureArrivee.Value >= 10 Then
                ArriveeHeure = NumericUpDownHeureArrivee.Value
            Else
                ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
            End If

            If NumericUpDownDepartMin.Value = 0 Then
                departMinutes = ":00:00"
            ElseIf NumericUpDownDepartMin.Value < 10 Then
                departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
            Else
                departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
            End If

            If NumericUpDownDepartHeure.Value >= 10 Then
                departHeure = NumericUpDownDepartHeure.Value
            Else
                departHeure = ":0" & NumericUpDownDepartHeure.Value
            End If

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes
            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

            'MessageBox.Show(DateTimeDepart & "-" & DateTimeArrivee, "dates")
            '-----------------------------

        End If

    End Sub

    Private Sub NumericUpDownArriveeMin_ValueChanged(sender As Object, e As EventArgs) Handles NumericUpDownArriveeMin.ValueChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim ArriveeMinutes As String = ""
            Dim ArriveeHeure As String = ""

            Dim departMinutes As String = ""
            Dim departHeure As String = ""

            If NumericUpDownArriveeMin.Value = 0 Then
                ArriveeMinutes = ":00:00"
            ElseIf NumericUpDownArriveeMin.Value < 10 Then
                ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
            Else
                ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
            End If

            If NumericUpDownHeureArrivee.Value >= 10 Then
                ArriveeHeure = NumericUpDownHeureArrivee.Value
            Else
                ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
            End If

            If NumericUpDownDepartMin.Value = 0 Then
                departMinutes = ":00:00"
            ElseIf NumericUpDownDepartMin.Value < 10 Then
                departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
            Else
                departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
            End If

            If NumericUpDownDepartHeure.Value >= 10 Then
                departHeure = NumericUpDownDepartHeure.Value
            Else
                departHeure = ":0" & NumericUpDownDepartHeure.Value
            End If

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

        End If

    End Sub

    Private Sub NumericUpDownDepartHeure_ValueChanged(sender As Object, e As EventArgs) Handles NumericUpDownDepartHeure.ValueChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim ArriveeMinutes As String = ""
            Dim ArriveeHeure As String = ""

            Dim departMinutes As String = ""
            Dim departHeure As String = ""

            If NumericUpDownArriveeMin.Value = 0 Then
                ArriveeMinutes = ":00:00"
            ElseIf NumericUpDownArriveeMin.Value < 10 Then
                ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
            Else
                ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
            End If

            If NumericUpDownHeureArrivee.Value >= 10 Then
                ArriveeHeure = NumericUpDownHeureArrivee.Value
            Else
                ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
            End If

            If NumericUpDownDepartMin.Value = 0 Then
                departMinutes = ":00:00"
            ElseIf NumericUpDownDepartMin.Value < 10 Then
                departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
            Else
                departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
            End If

            If NumericUpDownDepartHeure.Value >= 10 Then
                departHeure = NumericUpDownDepartHeure.Value
            Else
                departHeure = ":0" & NumericUpDownDepartHeure.Value
            End If

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

        End If

    End Sub

    Private Sub NumericUpDownDepartMin_ValueChanged(sender As Object, e As EventArgs) Handles NumericUpDownDepartMin.ValueChanged

        If GunaCheckBoxDayUse.Checked Then

            Dim ArriveeMinutes As String = ""
            Dim ArriveeHeure As String = ""

            Dim departMinutes As String = ""
            Dim departHeure As String = ""

            If NumericUpDownArriveeMin.Value = 0 Then
                ArriveeMinutes = ":00:00"
            ElseIf NumericUpDownArriveeMin.Value < 10 Then
                ArriveeMinutes = ":0" & NumericUpDownArriveeMin.Value & ":00"
            Else
                ArriveeMinutes = ":" & NumericUpDownArriveeMin.Value & ":00"
            End If

            If NumericUpDownHeureArrivee.Value >= 10 Then
                ArriveeHeure = NumericUpDownHeureArrivee.Value
            Else
                ArriveeHeure = "0" & NumericUpDownHeureArrivee.Value
            End If

            If NumericUpDownDepartMin.Value = 0 Then
                departMinutes = ":00:00"
            ElseIf NumericUpDownDepartMin.Value < 10 Then
                departMinutes = ":0" & NumericUpDownDepartMin.Value & ":00"
            Else
                departMinutes = ":" & NumericUpDownDepartMin.Value & ":00"
            End If

            If NumericUpDownDepartHeure.Value >= 10 Then
                departHeure = NumericUpDownDepartHeure.Value
            Else
                departHeure = ":0" & NumericUpDownDepartHeure.Value
            End If

            Dim DateTimeArriveeStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & ArriveeHeure & ArriveeMinutes

            Dim DateTimeDepartStringFormat As String = Format(GlobalVariable.DateDeTravail, "yyyy-MM-dd") & " " & departHeure & departMinutes

            Dim DateTimeArrivee As DateTime = DateTime.ParseExact(DateTimeArriveeStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)
            Dim DateTimeDepart As DateTime = DateTime.ParseExact(DateTimeDepartStringFormat, "yyyy-MM-dd HH:mm:ss", Nothing)

            Dim numberOfHoursToSpend As Integer = 0
            numberOfHoursToSpend = CType((DateTimeDepart - DateTimeArrivee).TotalHours, Int32)

            If numberOfHoursToSpend > 0 Then
                GunaTextBoxTempsAFaire.Text = numberOfHoursToSpend
            Else
                GunaTextBoxTempsAFaire.Text = 0
            End If

        End If
    End Sub

    'Fermeture de caisse
    Private Sub FermerCaisseToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles FermerCaisseToolStripMenuItem.Click

        Dim CODE_UTILISATEUR = GlobalVariable.ConnectedUser(0)("CODE_UTILISATEUR")

        Dim CODE_CAISSE As String = ""

        Dim CAISSE_UTILISATEUR As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

        If CAISSE_UTILISATEUR.Rows.Count > 0 Then

            CODE_CAISSE = CAISSE_UTILISATEUR.Rows(0)("CODE_CAISSE")

            FermerCaisseToolStripMenuItem.Visible = False

            OuvrirCaisseToolStripMenuItem.Visible = True

        End If

        Dim ETAT_CAISSE As Integer = 0
        Dim caissier As New Caisse()

        caissier.ouvertureFermetureDeCaisse(CODE_CAISSE, ETAT_CAISSE)

        MessageBox.Show("Caisse fermée avec succès", "Gestion de caisse", MessageBoxButtons.OK, MessageBoxIcon.Information)



    End Sub

    'Ouverture de caisse
    Private Sub OuvrirCaisseToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles OuvrirCaisseToolStripMenuItem.Click

        Dim CODE_UTILISATEUR = GlobalVariable.ConnectedUser(0)("CODE_UTILISATEUR")

        Dim CODE_CAISSE As String = ""
        Dim CAISSE_UTILISATEUR As DataTable = Functions.getElementByCode(CODE_UTILISATEUR, "caisse", "CODE_UTILISATEUR")

        If CAISSE_UTILISATEUR.Rows.Count > 0 Then

            CODE_CAISSE = CAISSE_UTILISATEUR.Rows(0)("CODE_CAISSE")

            OuvrirCaisseToolStripMenuItem.Visible = False

            FermerCaisseToolStripMenuItem.Visible = True

        End If

        Dim ETAT_CAISSE As Integer = 1
        Dim caissier As New Caisse()

        caissier.ouvertureFermetureDeCaisse(CODE_CAISSE, ETAT_CAISSE)

        MessageBox.Show("Caisse ouverte avec succès", "Gestion de caisse", MessageBoxButtons.OK, MessageBoxIcon.Information)

    End Sub

    'GESTION DES PETITES CAISSES
    Private Sub PetiteCaisseToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles PetiteCaisseToolStripMenuItem.Click

        PetiteCaisseForm.Show()

    End Sub

    Private Sub PETITEToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles PETITEToolStripMenuItem.Click
        PetiteCaisseForm.Show()
    End Sub

    Private Sub TimerToRefreshClock_Tick(sender As Object, e As EventArgs) Handles TimerToRefreshClock.Tick

        Dim notifications As DataTable = Functions.GetAllElementsOnTwoConditions(GlobalVariable.ConnectedUser.Rows(0)("CATEG_UTILISATEUR"), "notification", "CODE_PROFIL", 0, "ETAT_NOTIFCATION")

        If notifications.Rows.Count > 0 Then
            GunaLabelNotification.Text = "(" & notifications.Rows.Count & ")"
        Else

        End If

    End Sub

End Class

